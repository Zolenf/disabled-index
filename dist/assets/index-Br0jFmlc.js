(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var Vn=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return r=>{for(var s=r.length,n=new Uint8Array((s-(r[s-1]=="=")-(r[s-2]=="="))*3/4|0),i=0,o=0;i<s;){var u=t[r.charCodeAt(i++)],l=t[r.charCodeAt(i++)],a=t[r.charCodeAt(i++)],d=t[r.charCodeAt(i++)];n[o++]=u<<2|l>>4,n[o++]=l<<4|a>>2,n[o++]=a<<6|d}return n}})(),Zn={version:"3001.0.19"};function Fe(t,e,r){return e>r?Fe(t,r,e):Math.min(Math.max(t,e),r)}var X=class ie{r=255;g=255;b=255;constructor(e,r,s){this.r=Fe(e,0,255),this.g=Fe(r,0,255),this.b=Fe(s,0,255)}static fromArray(e){return new ie(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new ie(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!r)throw new Error("Invalid hex color format");return new ie(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,r,s){if(r==0)return new ie(255*s,255*s,255*s);let n=(d,m,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<1/6?d+(m-d)*6*c:c<1/2?m:c<2/3?d+(m-d)*(2/3-c)*6:d),i=s<.5?s*(1+r):s+r-s*r,o=2*s-i,u=n(o,i,e+1/3),l=n(o,i,e),a=n(o,i,e-1/3);return new ie(Math.round(u*255),Math.round(l*255),Math.round(a*255))}static RED=new ie(255,0,0);static GREEN=new ie(0,255,0);static BLUE=new ie(0,0,255);static YELLOW=new ie(255,255,0);static MAGENTA=new ie(255,0,255);static CYAN=new ie(0,255,255);static WHITE=new ie(255,255,255);static BLACK=new ie(0,0,0);clone(){return new ie(this.r,this.g,this.b)}lighten(e){return new ie(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new ie(255-this.r,255-this.g,255-this.b)}mult(e){return new ie(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,r){return new ie(ve(this.r,e.r,r),ve(this.g,e.g,r),ve(this.b,e.b,r))}toHSL(){let e=this.r/255,r=this.g/255,s=this.b/255,n=Math.max(e,r,s),i=Math.min(e,r,s),o=(n+i)/2,u=o,l=o;if(n==i)o=u=0;else{let a=n-i;switch(u=l>.5?a/(2-n-i):a/(n+i),n){case e:o=(r-s)/a+(r<s?6:0);break;case r:o=(s-e)/a+2;break;case s:o=(e-r)/a+4;break}o/=6}return[o,u,l]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function J(...t){if(t.length===0)return new X(255,255,255);if(t.length===1){if(t[0]instanceof X)return t[0].clone();if(typeof t[0]=="string")return X.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return X.fromArray(t[0])}else if(t.length===2){if(t[0]instanceof X)return t[0].clone()}else if(t.length===3||t.length===4)return new X(t[0],t[1],t[2]);throw new Error("Invalid color arguments")}var Jn=(t,e,r)=>X.fromHSL(t,e,r);function ae(t){return t*Math.PI/180}function rt(t){return t*180/Math.PI}function ve(t,e,r){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*r;if(t instanceof P&&e instanceof P||t instanceof X&&e instanceof X)return t.lerp(e,r);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}function ke(t,e,r,s,n){return s+(t-e)/(r-e)*(n-s)}function Qn(t,e,r,s,n){return Fe(ke(t,e,r,s,n),s,n)}var P=class ce{x=0;y=0;constructor(e=0,r=e){this.x=e,this.y=r}static fromAngle(e){let r=ae(e);return new ce(Math.cos(r),Math.sin(r))}static fromArray(e){return new ce(e[0],e[1])}static ZERO=new ce(0,0);static ONE=new ce(1,1);static LEFT=new ce(-1,0);static RIGHT=new ce(1,0);static UP=new ce(0,-1);static DOWN=new ce(0,1);clone(){return new ce(this.x,this.y)}add(...e){let r=E(...e);return new ce(this.x+r.x,this.y+r.y)}sub(...e){let r=E(...e);return new ce(this.x-r.x,this.y-r.y)}scale(...e){let r=E(...e);return new ce(this.x*r.x,this.y*r.y)}dist(...e){let r=E(...e);return this.sub(r).len()}sdist(...e){let r=E(...e);return this.sub(r).slen()}static sdist(e,r){let s=e.x-r.x,n=e.y-r.y;return s*s+n*n}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new ce(0):this.scale(1/e)}normal(){return new ce(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}static dot(e,r){return e.x*r.x+e.y*r.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,r){return e.x*r.y-e.y*r.x}angle(...e){let r=E(...e);return rt(Math.atan2(this.y-r.y,this.x-r.x))}angleBetween(...e){let r=E(...e);return rt(Math.atan2(this.cross(r),this.dot(r)))}lerp(e,r){return new ce(ve(this.x,e.x,r),ve(this.y,e.y,r))}slerp(e,r){let s=this.dot(e),n=this.cross(e),i=Math.atan2(n,s);return this.scale(Math.sin((1-r)*i)).add(e.scale(Math.sin(r*i))).scale(1/n)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new ce(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new ee(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}};function E(...t){if(t.length===1){if(t[0]instanceof P)return new P(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new P(...t[0])}return new P(...t)}var se=class Cr{x=0;y=0;w=1;h=1;constructor(e,r,s,n){this.x=e,this.y=r,this.w=s,this.h=n}scale(e){return new Cr(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new P(this.x,this.y)}clone(){return new Cr(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function oe(t,e,r,s){return new se(t,e,r,s)}var er=class ft{a;b;c;d;constructor(e,r,s,n){this.a=e,this.b=r,this.c=s,this.d=n}mul(e){return new ft(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return E(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new ft(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new ft(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,r=this.det,s=e+Math.sqrt(e*e-r),n=e-Math.sqrt(e*e-r);return[s,n]}eigenvectors(e,r){return this.c!=0?[[e-this.d,this.c],[r-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,r-this.a]]:Math.abs(this.transform(E(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let r=Math.cos(e),s=Math.sin(e);return new ft(r,s,-s,r)}static scale(e,r){return new ft(e,0,0,r)}},St=class Mt{m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,r,s,n,i,o,u,l,a){this.m11=e,this.m12=r,this.m13=s,this.m21=n,this.m22=i,this.m23=o,this.m31=u,this.m32=l,this.m33=a}static fromMat2(e){return new Mt(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new er(this.m11,this.m12,this.m21,this.m22)}mul(e){return new Mt(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let r=Math.cos(e),s=Math.sin(e),n=this.m11,i=this.m12;return this.m11=r*this.m11+s*this.m21,this.m12=r*this.m12+s*this.m22,this.m21=r*this.m21-s*n,this.m22=r*this.m22-s*i,this}scale(e,r){return this.m11*=e,this.m12*=e,this.m21*=r,this.m22*=r,this}get inverse(){let e=this.det;return new Mt((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new Mt(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},Ne=class Ke{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new Ke([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new Ke([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=ae(-e);let r=Math.cos(e),s=Math.sin(e);return new Ke([1,0,0,0,0,r,-s,0,0,s,r,0,0,0,0,1])}static rotateY(e){e=ae(-e);let r=Math.cos(e),s=Math.sin(e);return new Ke([r,0,s,0,0,1,0,0,-s,0,r,0,0,0,0,1])}static rotateZ(e){e=ae(-e);let r=Math.cos(e),s=Math.sin(e);return new Ke([r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=ae(-e);let r=Math.cos(e),s=Math.sin(e),n=this.m[0],i=this.m[1],o=this.m[4],u=this.m[5];return this.m[0]=n*r+i*s,this.m[1]=-n*s+i*r,this.m[4]=o*r+u*s,this.m[5]=-o*s+u*r,this}mult(e){let r=[];for(let s=0;s<4;s++)for(let n=0;n<4;n++)r[s*4+n]=this.m[0+n]*e.m[s*4+0]+this.m[4+n]*e.m[s*4+1]+this.m[8+n]*e.m[s*4+2]+this.m[12+n]*e.m[s*4+3];return new Ke(r)}multVec2(e){return new P(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new P(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new P(r,e/r)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new P(e/r,r)}else return new P(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return rt(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return rt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new P(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new P(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new P(0,0)}invert(){let e=[],r=this.m[10]*this.m[15]-this.m[14]*this.m[11],s=this.m[9]*this.m[15]-this.m[13]*this.m[11],n=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],u=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],a=this.m[5]*this.m[15]-this.m[13]*this.m[7],d=this.m[5]*this.m[14]-this.m[13]*this.m[6],m=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[4]*this.m[13]-this.m[12]*this.m[5],y=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],x=this.m[5]*this.m[10]-this.m[9]*this.m[6],S=this.m[4]*this.m[11]-this.m[8]*this.m[7],C=this.m[4]*this.m[10]-this.m[8]*this.m[6],D=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*r-this.m[6]*s+this.m[7]*n,e[4]=-(this.m[4]*r-this.m[6]*i+this.m[7]*o),e[8]=this.m[4]*s-this.m[5]*i+this.m[7]*u,e[12]=-(this.m[4]*n-this.m[5]*o+this.m[6]*u),e[1]=-(this.m[1]*r-this.m[2]*s+this.m[3]*n),e[5]=this.m[0]*r-this.m[2]*i+this.m[3]*o,e[9]=-(this.m[0]*s-this.m[1]*i+this.m[3]*u),e[13]=this.m[0]*n-this.m[1]*o+this.m[2]*u,e[2]=this.m[1]*l-this.m[2]*a+this.m[3]*d,e[6]=-(this.m[0]*l-this.m[2]*m+this.m[3]*c),e[10]=this.m[0]*f-this.m[1]*m+this.m[3]*p,e[14]=-(this.m[0]*d-this.m[1]*c+this.m[2]*p),e[3]=-(this.m[1]*y-this.m[2]*g+this.m[3]*x),e[7]=this.m[0]*y-this.m[2]*S+this.m[3]*C,e[11]=-(this.m[0]*g-this.m[1]*S+this.m[3]*D),e[15]=this.m[0]*x-this.m[1]*C+this.m[2]*D;let b=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let A=0;A<4;A++)for(let v=0;v<4;v++)e[A*4+v]*=1/b;return new Ke(e)}clone(){return new Ke([...this.m])}toString(){return this.m.toString()}};function Is(t,e,r,s=n=>-Math.cos(n)){return t+(s(r)+1)/2*(e-t)}var _n=1103515245,$n=12345,fs=2147483648,Rs=class{seed;constructor(t){this.seed=t}gen(){return this.seed=(_n*this.seed+$n)%fs,this.seed/fs}genNumber(t,e){return t+this.gen()*(e-t)}genVec2(t,e){return new P(this.genNumber(t.x,e.x),this.genNumber(t.y,e.y))}genColor(t,e){return new X(this.genNumber(t.r,e.r),this.genNumber(t.g,e.g),this.genNumber(t.b,e.b))}genAny(...t){if(t.length===0)return this.gen();if(t.length===1){if(typeof t[0]=="number")return this.genNumber(0,t[0]);if(t[0]instanceof P)return this.genVec2(E(0,0),t[0]);if(t[0]instanceof X)return this.genColor(J(0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.genNumber(t[0],t[1]);if(t[0]instanceof P&&t[1]instanceof P)return this.genVec2(t[0],t[1]);if(t[0]instanceof X&&t[1]instanceof X)return this.genColor(t[0],t[1])}throw new Error("More than 2 arguments not supported")}},qr=new Rs(Date.now());function ei(t){return t!=null&&(qr.seed=t),qr.seed}function ue(...t){return qr.genAny(...t)}function Ts(...t){return Math.floor(ue(...t.length>0?t:[2]))}function ti(t){return ue()<=t}function Os(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}function ri(t,e){return t.length<=e?t.slice():Os(t.slice()).slice(0,e)}function si(t){return t[Ts(t.length)]}function Ds(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}function ni(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let r=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(r===0)return null;let s=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/r,n=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/r;return s<0||s>1||n<0||n>1?null:s}function Wr(t,e){let r=ni(t,e);return r?E(t.p1.x+r*(t.p2.x-t.p1.x),t.p1.y+r*(t.p2.y-t.p1.y)):null}function Xr(t,e){let r=e.p2.sub(e.p1),s=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;if(r.x!=0){let i=(t.pos.x-e.p1.x)/r.x,o=(t.pos.x+t.width-e.p1.x)/r.x;s=Math.max(s,Math.min(i,o)),n=Math.min(n,Math.max(i,o))}if(r.y!=0){let i=(t.pos.y-e.p1.y)/r.y,o=(t.pos.y+t.height-e.p1.y)/r.y;s=Math.max(s,Math.min(i,o)),n=Math.min(n,Math.max(i,o))}return n>=s&&n>=0&&s<=1}function cr(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}function Bs(t,e){let r=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),s=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return E(r,s).sdist(e.center)<=e.radius*e.radius}function ks(t,e){return Fs(e,new ye(t.points()))}function Vr(t,e){let r=e.sub(t.p1),s=t.p2.sub(t.p1);if(Math.abs(r.cross(s))>Number.EPSILON)return!1;let n=r.dot(s)/s.dot(s);return n>=0&&n<=1}function Lt(t,e){let r=t.p2.sub(t.p1),s=r.dot(r),n=t.p1.sub(e.center),i=2*r.dot(n),o=n.dot(n)-e.radius*e.radius,u=i*i-4*s*o;if(s<=Number.EPSILON||u<0)return!1;if(u==0){let l=-i/(2*s);if(l>=0&&l<=1)return!0}else{let l=(-i+Math.sqrt(u))/(2*s),a=(-i-Math.sqrt(u))/(2*s);if(l>=0&&l<=1||a>=0&&a<=1)return!0}return ur(e,t.p1)}function Zr(t,e){if(Ve(e,t.p1)||Ve(e,t.p2))return!0;for(let r=0;r<e.pts.length;r++){let s=e.pts[r],n=e.pts[(r+1)%e.pts.length];if(Wr(t,new Ee(s,n)))return!0}return!1}function ur(t,e){return t.center.sdist(e)<t.radius*t.radius}function ii(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}function hr(t,e){let r=e.pts[e.pts.length-1];for(let s of e.pts){if(Lt(new Ee(r,s),t))return!0;r=s}return ur(t,e.pts[0])?!0:Ve(e,t.center)}function Fs(t,e){for(let r=0;r<t.pts.length;r++)if(Zr(new Ee(t.pts[r],t.pts[(r+1)%t.pts.length]),e))return!0;return!!(t.pts.some(r=>Ve(e,r))||e.pts.some(r=>Ve(t,r)))}function Ve(t,e){let r=!1,s=t.pts;for(let n=0,i=s.length-1;n<s.length;i=n++)s[n].y>e.y!=s[i].y>e.y&&e.x<(s[i].x-s[n].x)*(e.y-s[n].y)/(s[i].y-s[n].y)+s[n].x&&(r=!r);return r}function Jr(t,e){e=e.sub(t.center);let r=ae(t.angle),s=Math.cos(r),n=Math.sin(r),i=e.x*s+e.y*n,o=-e.x*n+e.y*s;return i*i/(t.radiusX*t.radiusX)+o*o/(t.radiusY*t.radiusY)<1}function tr(t,e){let r=e.center.sub(t.center),s=ae(t.angle),n=Math.cos(s),i=Math.sin(s),o=r.x*n+r.y*i,u=-r.x*i+r.y*n;return Jr(new Ge(E(),t.radiusX+e.radius,t.radiusY+e.radius,0),E(o,u))}function Ns(t,e){let r=t.toMat2().inverse;return e=new Ee(r.transform(e.p1.sub(t.center)),r.transform(e.p2.sub(t.center))),Lt(e,new be(E(),1))}function oi(t,e){if(t.radiusX===t.radiusY)return tr(e,new be(t.center,t.radiusX));if(e.radiusX===e.radiusY)return tr(t,new be(e.center,e.radiusX));let r=new St(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),s=new St(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),n=t.center.x,i=t.center.y,o=e.center.x,u=e.center.y,l=ae(t.angle),a=ae(e.angle),d=new St(Math.cos(l),-Math.sin(l),n,Math.sin(l),Math.cos(l),i,0,0,1),m=new St(Math.cos(a),-Math.sin(a),o,Math.sin(a),Math.cos(a),u,0,0,1),c=d.inverse,f=m.inverse,p=c.transpose.mul(r).mul(c),y=f.transpose.mul(s).mul(f),g=p.m11,x=p.m12,S=p.m13,C=p.m21,D=p.m22,b=p.m23,A=p.m31,v=p.m32,q=p.m33,T=y.m11,R=y.m12,O=y.m13,N=y.m21,L=y.m22,K=y.m23,Y=y.m31,k=y.m32,F=y.m33,_=g*D*q-g*b*v-x*C*q+x*b*A+S*C*v-S*D*A,W=(g*D*F-g*b*k-g*v*K+g*q*L-x*C*F+x*b*Y+x*A*K-x*q*N+S*C*k-S*D*Y-S*A*L+S*v*N+C*v*O-C*q*R-D*A*O+D*q*T+b*A*R-b*v*T)/_,Q=(g*L*F-g*K*k-x*N*F+x*K*Y+S*N*k-S*L*Y-C*R*F+C*O*k+D*T*F-D*O*Y-b*T*k+b*R*Y+A*R*K-A*O*L-v*T*K+v*O*N+q*T*L-q*R*N)/_,de=(T*L*F-T*K*k-R*N*F+R*K*Y+O*N*k-O*L*Y)/_;if(W>=0){let G=-3*Q+W**2,Qe=3*W*de+Q*W**2-4*Q**2,ct=-27*de**2+18*de*W*Q+W**2*Q**2-4*W**3*de-4*Q**3;return!(G>0&&Qe<0&&ct>0)}else{let G=-3*Q+W**2,Qe=-27*de**2+18*de*W*Q+W**2*Q**2-4*W**3*de-4*Q**3;return!(G>0&&Qe>0)}}function Us(t,e){return Qr(t,new ye(e.points()))}function Qr(t,e){let r=t.toMat2().inverse;return e=new ye(e.pts.map(s=>r.transform(s.sub(t.center)))),hr(new be(E(),1),e)}function ai(t,e){return t.x===e.x&&t.y===e.y}function li(t,e){return e instanceof P?ai(e,t.pt):e instanceof be?ur(e,t.pt):e instanceof Ee?Vr(e,t.pt):e instanceof ee?cr(e,t.pt):e instanceof ye?Ve(e,t.pt):e instanceof Ge?Jr(e,t.pt):!1}function ci(t,e){return e instanceof P?Vr(t,e):e instanceof be?Lt(t,e):e instanceof Ee?Wr(t,e)!=null:e instanceof ee?Xr(e,t):e instanceof ye?Zr(t,e):e instanceof Ge?Ns(e,t):!1}function ui(t,e){return e instanceof P?ur(t,e):e instanceof be?ii(t,e):e instanceof Ee?Lt(e,t):e instanceof ee?Bs(e,t):e instanceof ye?hr(t,e):e instanceof Ge?tr(e,t):!1}function hi(t,e){return e instanceof P?cr(t,e):e instanceof be?Bs(t,e):e instanceof Ee?Xr(t,e):e instanceof ee?Ds(t,e):e instanceof ye?ks(t,e):e instanceof Ge?Us(e,t):!1}function di(t,e){return e instanceof P?Ve(t,e):e instanceof be?hr(e,t):e instanceof Ee?Zr(e,t):e instanceof ee?ks(e,t):e instanceof ye?Fs(e,t):e instanceof Ge?Qr(e,t):!1}function pi(t,e){return e instanceof P?Jr(t,e):e instanceof be?tr(t,e):e instanceof Ee?Ns(t,e):e instanceof ee?Us(t,e):e instanceof ye?Qr(t,e):e instanceof Ge?oi(e,t):!1}function Ls(t,e,r){let s=t,n=r.p1,i=r.p2,o=e,u=i.sub(n),l=o.cross(u);if(Math.abs(l)<Number.EPSILON)return null;let a=n.sub(s),d=a.cross(u)/l;if(d<=0||d>=1)return null;let m=a.cross(o)/l;if(m<=0||m>=1)return null;let c=u.normal().unit();return e.dot(c)>0&&(c.x*=-1,c.y*=-1),{point:s.add(o.scale(d)),normal:c,fraction:d}}function fi(t,e,r){let s=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,i;if(t.x!=0){let o=(r.pos.x-t.x)/e.x,u=(r.pos.x+r.width-t.x)/e.x;i=E(-Math.sign(e.x),0),s=Math.max(s,Math.min(o,u)),n=Math.min(n,Math.max(o,u))}if(t.y!=0){let o=(r.pos.y-t.y)/e.y,u=(r.pos.y+r.height-t.y)/e.y;Math.min(o,u)>s&&(i=E(0,-Math.sign(e.y))),s=Math.max(s,Math.min(o,u)),n=Math.min(n,Math.max(o,u))}return n>=s&&s>=0&&s<=1?{point:t.add(e.scale(s)),normal:i,fraction:s}:null}function zs(t,e,r){let s=t,n=r.center,i=e,o=i.dot(i),u=s.sub(n),l=2*i.dot(u),a=u.dot(u)-r.radius*r.radius,d=l*l-4*o*a;if(o<=Number.EPSILON||d<0)return null;if(d==0){let m=-l/(2*o);if(m>=0&&m<=1){let c=s.add(i.scale(m));return{point:c,normal:c.sub(n),fraction:m}}}else{let m=(-l+Math.sqrt(d))/(2*o),c=(-l-Math.sqrt(d))/(2*o),f=null;if(m>=0&&m<=1&&(f=m),c>=0&&c<=1&&(f=Math.min(c,f??c)),f!=null){let p=s.add(i.scale(f));return{point:p,normal:p.sub(n).unit(),fraction:f}}}return null}function gi(t,e,r){let s=r.pts,n=null,i=s[s.length-1];for(let o=0;o<s.length;o++){let u=s[o],l=Ls(t,e,new Ee(i,u));l&&(!n||n.fraction>l.fraction)&&(n=l),i=u}return n}function mi(t,e,r){let s=r.toMat2(),n=s.inverse,i=n.transform(t.sub(r.center)),o=n.transform(e),u=zs(i,o,new be(E(),1));if(u){let l=er.rotation(ae(-r.angle)),a=er.scale(r.radiusX,r.radiusY).transform(u.point),d=s.transform(u.point).add(r.center),m=d.dist(t)/e.len();return{point:d,normal:l.transform(E(r.radiusY**2*a.x,r.radiusX**2*a.y)).unit(),fraction:m}}return u}function yi(t,e,r,s=64){let n=t,i=e.len(),o=e.scale(1/i),u=0,l=E(Math.floor(t.x),Math.floor(t.y)),a=E(o.x>0?1:-1,o.y>0?1:-1),d=E(Math.abs(1/o.x),Math.abs(1/o.y)),m=E(a.x>0?l.x+1-t.x:t.x-l.x,a.y>0?l.y+1-t.y:t.y-l.y),c=E(d.x<1/0?d.x*m.x:1/0,d.y<1/0?d.y*m.y:1/0),f=-1;for(;u<=s;){let p=r(l);if(p===!0)return{point:n.add(o.scale(u)),normal:E(f===0?-a.x:0,f===1?-a.y:0),fraction:u/i,gridPos:l};if(p)return p;c.x<c.y?(l.x+=a.x,u=c.x,c.x+=d.x,f=0):(l.y+=a.y,u=c.y,c.y+=d.y,f=1)}return null}var wi=class Ir{pt;constructor(e){this.pt=e.clone()}transform(e){return new Ir(e.multVec2(this.pt))}bbox(){return new ee(this.pt,0,0)}area(){return 0}clone(){return new Ir(this.pt)}collides(e){return li(this,e)}contains(e){return this.pt.eq(e)}raycast(e,r){return null}random(){return this.pt.clone()}},Ee=class Rr{p1;p2;constructor(e,r){this.p1=e.clone(),this.p2=r.clone()}transform(e){return new Rr(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return ee.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Rr(this.p1,this.p2)}collides(e){return ci(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Ls(e,r,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(ue(1)))}},ee=class Tr{pos;width;height;constructor(e,r,s){this.pos=e.clone(),this.width=r,this.height=s}static fromPoints(e,r){return new Tr(e.clone(),r.x-e.x,r.y-e.y)}center(){return new P(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new ye(this.points().map(r=>e.multVec2(r)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new Tr(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let r=this.pos,s=this.pos.add(this.width,this.height),n=Math.max(r.x-e.x,0,e.x-s.x),i=Math.max(r.y-e.y,0,e.y-s.y);return n*n+i*i}collides(e){return hi(this,e)}contains(e){return this.collides(e)}raycast(e,r){return fi(e,r,this)}random(){return this.pos.add(ue(this.width),ue(this.height))}},be=class Ks{center;radius;constructor(e,r){this.center=e.clone(),this.radius=r}transform(e){return new Ge(this.center,this.radius,this.radius).transform(e)}bbox(){return ee.fromPoints(this.center.sub(E(this.radius)),this.center.add(E(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Ks(this.center,this.radius)}collides(e){return ui(this,e)}contains(e){return this.collides(e)}raycast(e,r){return zs(e,r,this)}random(){return this.center.add(P.fromAngle(ue(360)).scale(ue(this.radius)))}},Ge=class gt{center;radiusX;radiusY;angle;constructor(e,r,s,n=0){this.center=e.clone(),this.radiusX=r,this.radiusY=s,this.angle=n}static fromMat2(e){let r=e.inverse,s=r.transpose.mul(r),[n,i]=s.eigenvalues,[o,u]=s.eigenvectors(n,i),[l,a]=[1/Math.sqrt(n),1/Math.sqrt(i)];return l>a?new gt(E(),l,a,rt(Math.atan2(-o[1],o[0]))):new gt(E(),a,l,rt(Math.atan2(-u[1],u[0])))}toMat2(){let e=ae(this.angle),r=Math.cos(e),s=Math.sin(e);return new er(r*this.radiusX,-s*this.radiusY,s*this.radiusX,r*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new gt(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let r=this.toMat2(),s=e.getRotation(),n=e.getScale();r=St.fromMat2(r).scale(n.x,n.y).rotate(s).toMat2();let i=gt.fromMat2(r);return i.center=e.multVec2(this.center),i}}bbox(){if(this.angle==0)return ee.fromPoints(this.center.sub(E(this.radiusX,this.radiusY)),this.center.add(E(this.radiusX,this.radiusY)));{let e=ae(this.angle),r=Math.cos(e),s=Math.sin(e),n=this.radiusX*r,i=this.radiusX*s,o=this.radiusY*s,u=this.radiusY*r,l=Math.sqrt(n*n+o*o),a=Math.sqrt(i*i+u*u);return ee.fromPoints(this.center.sub(E(l,a)),this.center.add(E(l,a)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new gt(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return pi(this,e)}contains(e){e=e.sub(this.center);let r=ae(this.angle),s=Math.cos(r),n=Math.sin(r),i=e.x*s+e.y*n,o=-e.x*n+e.y*s;return i*i/(this.radiusX*this.radiusX)+o*o/(this.radiusY*this.radiusY)<1}raycast(e,r){return mi(e,r,this)}random(){return this.center}};function Ai(t,e,r,s){let n=e.sub(t),i=s.sub(r),o=n.cross(i);return o<1e-5&&o>-1e-5||(o=r.sub(t).cross(i)/o,o<0||o>1)?null:t.add(n.scale(o))}var ye=class Pt{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new Pt(this.pts.map(r=>e.multVec2(r)))}bbox(){let e=E(Number.MAX_VALUE),r=E(-Number.MAX_VALUE);for(let s of this.pts)e.x=Math.min(e.x,s.x),r.x=Math.max(r.x,s.x),e.y=Math.min(e.y,s.y),r.y=Math.max(r.y,s.y);return ee.fromPoints(e,r)}area(){let e=0,r=this.pts.length;for(let s=0;s<r;s++){let n=this.pts[s],i=this.pts[(s+1)%r];e+=n.x*i.y*.5,e-=i.x*n.y*.5}return Math.abs(e)}clone(){return new Pt(this.pts.map(e=>e.clone()))}collides(e){return di(this,e)}contains(e){return this.collides(e)}raycast(e,r){return gi(e,r,this)}random(){return E()}cut(e,r){new Ee(e,r);let s=[],n=[],i=r.sub(e),o=this.pts[this.pts.length-1],u=o.sub(e),l=i.cross(u)>0;return this.pts.forEach(a=>{u=a.sub(e);let d=i.cross(u)>0;if(l!=d){let m=Ai(o,a,e,r);s.push(m),n.push(m),l=d}(d?s:n).push(a),o=a}),[s.length?new Pt(s):null,n.length?new Pt(n):null]}};function xi(t,e,r,s){let n=s*s,i=1-s,o=i*i;return t.scale(o).add(e.scale(2*i*s)).add(r.scale(n))}function vi(t,e,r,s){let n=1-s;return e.sub(t).scale(2*n).add(r.sub(e).scale(2*s))}function bi(t,e,r,s){return r.sub(e.scale(2)).add(t).scale(2)}function _r(t,e,r,s,n){let i=n*n,o=i*n,u=1-n,l=u*u,a=l*u;return t.scale(a).add(e.scale(3*l*n)).add(r.scale(3*u*i)).add(s.scale(o))}function Ei(t,e,r,s,n){let i=n*n,o=1-n,u=o*o;return e.sub(t).scale(3*u).add(r.sub(e).scale(6*o*n)).add(s.sub(r).scale(3*i))}function Si(t,e,r,s,n){let i=1-n;return r.sub(e.scale(2)).add(t).scale(6*i).add(s.sub(r.scale(2)).add(e).scale(6*n))}function Mi(t,e,r,s,n){let i=.5*(((-n+2)*n-1)*n),o=.5*((3*n-5)*n*n+2),u=.5*(((-3*n+4)*n+1)*n),l=.5*((n-1)*n*n);return t.scale(i).add(e.scale(o)).add(r.scale(u)).add(s.scale(l))}function Pi(t,e,r,s,n){let i=.5*((-3*n+4)*n-1),o=.5*((9*n-10)*n),u=.5*((-9*n+8)*n+1),l=.5*((3*n-2)*n);return t.scale(i).add(e.scale(o)).add(r.scale(u)).add(s.scale(l))}function Ci(t){let e=Gs(t),r=e(1);return s=>{let n=s*r,i=e(n,!0);return t(i)}}function Gs(t,e=10,r=10){let s=[0],n=[0],i=1/(e-1)/r,o=0,u=t(0),l=0;for(let a=1;a<e;a++){for(let d=0;d<r;d++){l+=i;let m=t(l),c=m.dist(u);o+=c,u=m}s[a]=o,n[a]=l}return n[e-1]=1,(a,d=!1)=>{if(d){let m=a;if(m<=0)return 0;if(m>=o)return 1;let c=0;for(;s[c+1]<m;)c++;let f=n[c],p=n[c+1],y=s[c],g=s[c+1],x=(m-y)/(g-y);return f+(p-f)*x}else{if(a<=0)return 0;if(a>=1)return s[e-1];let m=0;for(;n[m+1]<a;)m++;let c=n[m],f=n[m+1],p=s[m],y=s[m+1],g=(a-c)/(f-c);return p+(y-p)*g}}}function zt(t,e,r,s){let n=2*t+e-2*s+r,i=-3*t+3*s-2*e-r,o=e,u=t;return l=>{let a=l*l,d=a*l;return n*d+i*a+o*l+u}}function Hs(t,e,r,s,n,i=zt){let o=i(e.x,(1-n)*(r.x-t.x),(1-n)*(s.x-e.x),r.x),u=i(e.y,(1-n)*(r.y-t.y),(1-n)*(s.y-e.y),r.y);return l=>new P(o(l),u(l))}function rr(t,e,r,s,n=zt){return Hs(t,e,r,s,.5,n)}function qi(t,e,r,s,n=zt){return rr(s.add(t.sub(e).scale(6)),t,s,t.add(s.sub(r).scale(6)),n)}function Ii(t,e,r,s,n,i,o,u=zt){let l=u(e.x,.5*(1-n)*(1+o)*(1+i)*(e.x-t.x)+.5*(1-n)*(1-o)*(1-i)*(r.x-e.x),.5*(1-n)*(1+o)*(1-i)*(r.x-e.x)+.5*(1-n)*(1-o)*(1+i)*(s.x-r.x),r.x),a=u(e.y,.5*(1-n)*(1+o)*(1+i)*(e.y-t.y)+.5*(1-n)*(1-o)*(1-i)*(r.y-e.y),.5*(1-n)*(1+o)*(1-i)*(r.y-e.y)+.5*(1-n)*(1-o)*(1+i)*(s.y-r.y),r.y);return d=>new P(l(d),a(d))}function Ri(t,e,r,s){let n=2*t+e-2*s+r,i=-3*t+3*s-2*e+r,o=e;return u=>{let l=u*u;return 3*n*l+2*i*u+o}}function bt(t){return 0<=t&&t<=1}function Sr(t,e){return Math.abs(t-e)<=Number.EPSILON}function Et(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function Ti(t,e,r,s){let n=3*t-6*e+3*r,i=-3*t+3*e,o=t,u=-t+3*e-3*r+s;if(Sr(u,0)){if(Sr(n,0))return Sr(i,0)?[]:[-o/i].filter(bt);let g=Math.sqrt(i*i-4*n*o),x=2*n;return[(g-i)/x,(-i-g)/x].filter(bt)}n/=u,i/=u,o/=u;let l=(3*i-n*n)/3,a=l/3,d=(2*n*n*n-9*n*i+27*o)/27,m=d/2,c=m*m+a*a*a;if(c<0){let g=-l/3,x=g*g*g,S=Math.sqrt(x),C=-d/(2*S),D=C<-1?-1:C>1?1:C,b=Math.acos(D),A=2*Et(S),v=A*Math.cos(b/3)-n/3,q=A*Math.cos((b+2*Math.PI)/3)-n/3,T=A*Math.cos((b+4*Math.PI)/3)-n/3;return[v,q,T].filter(bt)}if(c===0){let g=m<0?Et(-m):-Et(m),x=2*g-n/3,S=-g-n/3;return[x,S].filter(bt)}let f=Math.sqrt(c),p=Et(f-m),y=Et(f+m);return[p-y-n/3].filter(bt)}function Oi(t,e,r,s,n){let i=Ti(t.x-n,e.x-n,r.x-n,s.x-n);return i.length>0?_r(t,e,r,s,i[0]).y:NaN}function Di(t){if(!t||t.length==0)throw new Error("Need at least one point for easingLinear.");let e=t.length;return r=>{if(r<=0||t.length==1||r<=t[0].x)return t[0].y;for(let s=0;s<e;s++)if(t[s].x>=r)return ke(r,t[s-1].x,t[s].x,t[s-1].y,t[s].y);return t[t.length-1].y}}function Bi(t,e){return r=>Oi(E(0,0),t,e,E(1,1),r)}function ki(t,e="jump-end"){let r=1/t,s=e=="jump-start"||e=="jump-both",n=e=="jump-end"||e=="jump-both",i=1/(t+(n?1:0)),o=s?i:0;return u=>{let l=Math.floor(u/r);return o+l*i}}function Fi(t,e){let r=Number.MAX_VALUE,s={normal:E(0),distance:0};for(let n of[t,e])for(let i=0;i<n.pts.length;i++){let o=n.pts[i],u=n.pts[(i+1)%n.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let f=0;f<t.pts.length;f++){let p=t.pts[f].dot(u);l=Math.min(l,p),a=Math.max(a,p)}let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let f=0;f<e.pts.length;f++){let p=e.pts[f].dot(u);d=Math.min(d,p),m=Math.max(m,p)}let c=Math.min(a,m)-Math.max(l,d);if(c<0)return null;if(c<Math.abs(r)){let f=m-l,p=d-a;r=Math.abs(f)<Math.abs(p)?f:p,s.normal=u,s.distance=r}}return s}function Ys(t,e,r){return(e.x-t.x)*(r.y-t.y)-(e.y-t.y)*(r.x-t.x)>=0}function Ni(t){let e=0,r=t[t.length-1];for(let s=0;s<t.length;s++)e+=(t[s].x-r.x)*(t[s].y+r.y),r=t[s];return e<0}function Mr(t,e,r,s){let n=s.x-r.x,i=s.y-r.y,o=n*(t.y-r.y)-i*(t.x-r.x),u=n*(e.y-r.y)-i*(e.x-r.x);return o*u>=0}function Ui(t,e,r,s){return Mr(t,e,r,s)&&Mr(t,r,e,s)&&Mr(t,s,e,r)}function Li(t,e,r,s){for(let n of t)if(n!==e&&n!==r&&n!==s&&Ui(n,e,r,s))return!0;return!1}function zi(t,e,r,s){return Ys(t,e,r)&&!Li(s,t,e,r)}function js(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],r=[],s=0;for(let m=0;m<t.length;m++){let c=t[s],f=t[m];(f.x<c.x||f.x==c.x&&f.y<c.y)&&(s=s),e[m]=m+1,r[m]=m-1}e[e.length-1]=0,r[0]=r.length-1,Ni(t)||([e,r]=[r,e]);let n=[];for(let m=0;m<t.length;++m)Ys(t[r[m]],t[m],t[e[m]])||n.push(t[m]);let i=[],o=t.length,u=1,l=0,a,d;for(;o>3;){a=e[u],d=r[u];let m=t[d],c=t[u],f=t[a];if(zi(m,c,f,n))i.push([m,c,f]),e[d]=a,r[a]=d,n.splice(n.indexOf(c),1),--o,l=0;else if(++l>o)return[];u=a}return a=e[u],d=r[u],i.push([t[d],t[u],t[a]]),i}function Ki(t){if(t.length<3)return!1;let e=t.length-2,r=t.length-1,s=0,n=t[r].sub(t[e]),i=t[s].sub(t[r]),o=n.cross(i);for(;s+1<t.length;)if(e=r,r=s,s++,n=t[r].sub(t[e]),i=t[s].sub(t[r]),n.cross(i)*o<0)return!1;return!0}var Ws=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",dr="topleft",Gi="monospace",sr="monospace",Or="linear",$r=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Hi=$r.reduce((t,e)=>t+e.size,0),Xs=2048,Yi=Xs*4*Hi,ji=Xs*6,Wi=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Xi=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	vec4 texColor = texture2D(u_tex, v_uv);
	return vec4((v_color.rgb * texColor.rgb), texColor.a) * v_color.a;
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Dr=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Br=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Vi=new Set(["id","require"]),Zi=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),gs=200,Ji=640,Qi=65536,Vs=Symbol.for("kaplay.cancel"),Zs=class extends Map{lastID=0;push(t){let e=this.lastID;return this.set(e,t),this.lastID++,e}pushd(t){let e=this.push(t);return()=>this.delete(e)}},at=class Js{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let r=new Js(()=>e.forEach(s=>s.cancel()));return Object.defineProperty(r,"paused",{get:()=>e[0].paused,set:s=>e.forEach(n=>n.paused=s)}),r.paused=!1,r}static replace(e,r){return e.cancel=()=>r.cancel(),r.paused=e.paused,Object.defineProperty(e,"paused",{get:()=>r.paused,set:s=>r.paused=s}),e}},me=class{cancellers=new WeakMap;handlers=new Zs;add(t){function e(...n){if(!s.paused)return t(...n)}let r=this.handlers.pushd(e),s=new at(r);return this.cancellers.set(e,r),s}addOnce(t){let e=this.add((...r)=>{e.cancel(),t(...r)});return e}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(e=>{let r=e(...t),s;r===Vs&&(s=this.cancellers.get(e))&&s()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},Bt=class{handlers={};registers={};on(t,e){return this.handlers[t]||(this.handlers[t]=new me),this.handlers[t].add(e)}onOnce(t,e){let r=this.on(t,(...s)=>{r.cancel(),e(...s)});return r}next(t){return new Promise(e=>{this.onOnce(t,(...r)=>e(r[0]))})}trigger(t,...e){this.handlers[t]&&this.handlers[t].trigger(...e)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){return this.handlers[t]?.numListeners()??0}},_i=t=>t[0]instanceof X,$i=t=>t[0]instanceof P,eo=t=>typeof t[0]=="number",Qs=class{_items;_compareFn;constructor(t=(e,r)=>e<r){this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let t=this._items[0],e=this._items.pop();return this._items.length!==0&&(this._items[0]=e,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let e=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[e])&&this._items[t]>=this._items[e])break;this.swap(t,e),t=e}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let e=2*t+1;if(e<this._items.length-1&&!this._compareFn(this._items[e],this._items[e+1])&&++e,this._compareFn(this._items[t],this._items[e]))break;this.swap(t,e),t=e}}swap(t,e){[this._items[t],this._items[e]]=[this._items[e],this._items[t]]}get length(){return this._items.length}};function to(t){let e=window.atob(t),r=e.length,s=new Uint8Array(r);for(let n=0;n<r;n++)s[n]=e.charCodeAt(n);return s.buffer}function ro(t){return to(t.split(",")[1])}function es(t,e){let r=document.createElement("a");r.href=e,r.download=t,r.click()}function _s(t,e){es(t,"data:text/plain;charset=utf-8,"+e)}function so(t,e){_s(t,JSON.stringify(e))}function ms(t,e){let r=URL.createObjectURL(e);es(t,r),URL.revokeObjectURL(r)}var $s=t=>t.match(/^data:\w+\/\w+;base64,.+/),no=t=>t.split(".").slice(0,-1).join(".");function ts(t,e){if(t===e)return!0;let r=typeof t,s=typeof e;if(r!==s)return!1;if(r==="object"&&s==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(let o of n){let u=t[o],l=e[o];if(!ts(u,l))return!1}return!0}return!1}var ys=new Set,io=t=>t instanceof Error?t.message:String(t);function oo(t){ys.has(t)||(ys.add(t),console.warn(t))}function yt(t,e){oo(`${t} is deprecated. Use ${e} instead.`)}function kr(t,e){return Number(t.toFixed(e))}function te(t,e){return(...r)=>{let s=r.length;if(s===t.length)return t(...r);if(s===e.length)return e(...r)}}var ao=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function lo(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],r=0,s=0;for(;r<t.length;){if(s+=co(r+s,t),wo(t[r+s])&&s++,fo(t[r+s])&&s++,mo(t[r+s])&&s++,Ao(t[r+s])){s++;continue}e.push(t.substring(r,r+s)),r+=s,s=0}return e}function co(t,e){let r=e[t];if(!uo(r)||t===e.length-1)return 1;let s=r+e[t+1],n=e.substring(t+2,t+5);return ws(s)&&ws(n)?4:ho(s)&&yo(n)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:po(n)?4:2}function uo(t){return t&&lt(t[0].charCodeAt(0),55296,56319)}function ws(t){return lt(rs(t),127462,127487)}function ho(t){return lt(rs(t),127988,127988)}function po(t){return lt(rs(t),127995,127999)}function fo(t){return typeof t=="string"&&lt(t.charCodeAt(0),65024,65039)}function mo(t){return typeof t=="string"&&lt(t.charCodeAt(0),8400,8447)}function yo(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&lt(e,917504,917631)}function wo(t){return typeof t=="string"&&ao.includes(t.charCodeAt(0))}function Ao(t){return typeof t=="string"&&t.charCodeAt(0)===8205}function rs(t){let e=t.charCodeAt(0)-55296,r=t.charCodeAt(1)-56320;return(e<<10)+r+65536}function lt(t,e,r){return t>=e&&t<=r}var Pe=(t,e)=>Array.isArray(t)?t?.includes(e):t===e,Be=(t,e)=>Array.isArray(e)?e.some(r=>t.has(r)):t.has(e),Vt=(t,e,r)=>{t.has(e)?t.get(e)?.push(r):t.set(e,[r])},xo=(()=>{let t=0;return()=>t++})(),vo={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};function en(){let t=h.globalOpt.pixelDensity??1,e=h.globalOpt.width,r=h.globalOpt.height,s=h.gfx.ggl.gl.drawingBufferWidth,n=h.gfx.ggl.gl.drawingBufferHeight,i=s/t,o=n/t,u=0,l=0,a=i,d=o;if(h.globalOpt.letterbox){if(!e||!r)throw new Error("Letterboxing requires width and height defined.");let m=i/o,c=e/r;if(m>c){let f=o*c;u=(i-f)/2,a=f}else{let f=i/c;d=f,l=(o-f)/2}}if(h.globalOpt.stretch&&(!h.globalOpt.width||!h.globalOpt.height))throw new Error("Stretching requires width and height defined.");h.gfx.viewport={x:u,y:l,width:a,height:d,scale:(h.gfx.viewport.width+h.gfx.viewport.height)/(h.gfx.width+h.gfx.height)}}function bo(t){return new P(t.x*h.gfx.viewport.width/h.gfx.width,t.y*h.gfx.viewport.height/h.gfx.height)}function ze(t){return new P((t.x-h.gfx.viewport.x)*h.gfx.width/h.gfx.viewport.width,(t.y-h.gfx.viewport.y)*h.gfx.height/h.gfx.viewport.height)}var Eo=()=>et.lastInputDevice,So=()=>{let t=et.buttons;for(let e in t){let r=t[e].keyboard&&[t[e].keyboard].flat(),s=t[e].keyboardCode&&[t[e].keyboardCode].flat(),n=t[e].gamepad&&[t[e].gamepad].flat(),i=t[e].mouse&&[t[e].mouse].flat();r&&r.forEach(o=>{Vt(et.buttonsByKey,o,e)}),s&&s.forEach(o=>{Vt(et.buttonsByKeyCode,o,e)}),n&&n.forEach(o=>{Vt(et.buttonsByGamepad,o,e)}),i&&i.forEach(o=>{Vt(et.buttonsByMouse,o,e)})}},Rt=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},Mo=class{buttonState=new Rt;stickState=new Map},Po=class{dts=[];timer=0;fps=0;tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,r)=>e+r)/this.dts.length)),this.dts=[])}},et,As=vo,Co=t=>{let e=t.buttons??{};return{canvas:t.canvas,buttons:e,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Po,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new P(0),mouseDeltaPos:new P(0),keyState:new Rt,mouseState:new Rt,mergedGamepadState:new Mo,gamepadStates:new Map,lastInputDevice:null,buttonState:new Rt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new Bt}},qo=t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e=Co(t);et=e,So();function r(){return e.dt*e.timeScale}function s(){return e.fixedDt*e.timeScale}function n(){return e.restDt*e.timeScale}function i(){return e.isHidden}function o(){return e.time}function u(){return e.fpsCounter.fps}function l(){return e.numFrames}function a(){return e.canvas.toDataURL()}function d(w){e.canvas.style.cursor=w}function m(){return e.canvas.style.cursor}function c(w){if(w)try{let M=e.canvas.requestPointerLock();M?.catch&&M.catch(I=>console.error(I))}catch(M){console.error(M)}else document.exitPointerLock()}function f(){return!!document.pointerLockElement}function p(w){w.requestFullscreen?w.requestFullscreen():w.webkitRequestFullscreen&&w.webkitRequestFullscreen()}function y(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function g(w=!0){w?p(e.canvas):y()}function x(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}function S(){e.stopped=!0;let w=Object.entries(Ae),M=Object.entries(br),I=Object.entries(Xt);for(let[B,Z]of w)e.canvas.removeEventListener(B,Z);for(let[B,Z]of M)document.removeEventListener(B,Z);for(let[B,Z]of I)window.removeEventListener(B,Z);ps.disconnect()}function C(w,M){e.loopID!==null&&cancelAnimationFrame(e.loopID);let I=0,B=0,Z=re=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(Z);return}let Me=re/1e3,ht=Math.min(Me-e.realTime,.25),Le=t.maxFPS?1/t.maxFPS:0;if(e.realTime=Me,B+=ht,B>Le){if(!e.skipTime){for(I+=B,e.dt=e.fixedDt,e.restDt=0;I>e.fixedDt;)I-=e.fixedDt,I<e.fixedDt&&(e.restDt=I),w();e.restDt=I,e.dt=B,e.time+=r(),e.fpsCounter.tick(e.dt)}B=0,e.skipTime=!1,e.numFrames++,M(Hn,Yn)}e.loopID=requestAnimationFrame(Z)};Z(0)}function D(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function b(){return e.mousePos.clone()}function A(){return e.mouseDeltaPos.clone()}function v(w="left"){return e.mouseState.pressed.has(w)}function q(w="left"){return e.mouseState.down.has(w)}function T(w="left"){return e.mouseState.released.has(w)}function R(){return e.isMouseMoved}function O(w){return w===void 0?e.keyState.pressed.size>0:Be(e.keyState.pressed,w)}function N(w){return w===void 0?e.keyState.pressedRepeat.size>0:Be(e.keyState.pressedRepeat,w)}function L(w){return w===void 0?e.keyState.down.size>0:Be(e.keyState.down,w)}function K(w){return w===void 0?e.keyState.released.size>0:Be(e.keyState.released,w)}function Y(w){return w===void 0?e.mergedGamepadState.buttonState.pressed.size>0:Be(e.mergedGamepadState.buttonState.pressed,w)}function k(w){return w===void 0?e.mergedGamepadState.buttonState.down.size>0:Be(e.mergedGamepadState.buttonState.down,w)}function F(w){return w===void 0?e.mergedGamepadState.buttonState.released.size>0:Be(e.mergedGamepadState.buttonState.released,w)}function _(w){return w===void 0?e.buttonState.pressed.size>0:Be(e.buttonState.pressed,w)}function W(w){return w===void 0?e.buttonState.down.size>0:Be(e.buttonState.down,w)}function Q(w){return w===void 0?e.buttonState.released.size>0:Be(e.buttonState.released,w)}function de(w){return e.buttons?.[w]}function G(w,M){e.buttons[w]={...e.buttons[w],...M}}function Qe(w){e.buttonState.press(w),e.events.trigger("buttonPress",w)}function ct(w){e.buttonState.release(w),e.events.trigger("buttonRelease",w)}function xt(w){return e.events.on("resize",w)}let Kt=te(w=>e.events.on("keyDown",w),(w,M)=>e.events.on("keyDown",I=>Pe(w,I)&&M(I))),Gt=te(w=>e.events.on("keyPress",M=>w(M)),(w,M)=>e.events.on("keyPress",I=>Pe(w,I)&&M(I))),mr=te(w=>e.events.on("keyPressRepeat",w),(w,M)=>e.events.on("keyPressRepeat",I=>Pe(w,I)&&M(I))),yr=te(w=>e.events.on("keyRelease",w),(w,M)=>e.events.on("keyRelease",I=>Pe(w,I)&&M(I))),ut=te(w=>e.events.on("mouseDown",M=>w(M)),(w,M)=>e.events.on("mouseDown",I=>Pe(w,I)&&M(I))),Oe=te(w=>e.events.on("mousePress",M=>w(M)),(w,M)=>e.events.on("mousePress",I=>Pe(w,I)&&M(I))),Ht=te(w=>e.events.on("mouseRelease",M=>w(M)),(w,M)=>e.events.on("mouseRelease",I=>I===w&&M(I)));function U(w){return e.events.on("mouseMove",()=>w(b(),A()))}function H(w){return e.events.on("charInput",w)}function j(w){return e.events.on("touchStart",w)}function $(w){return e.events.on("touchMove",w)}function le(w){return e.events.on("touchEnd",w)}function V(w){return e.events.on("scroll",w)}function ge(w){return e.events.on("hide",w)}function He(w){return e.events.on("show",w)}let wr=te(w=>e.events.on("gamepadButtonPress",(M,I)=>w(M,I)),(w,M)=>e.events.on("gamepadButtonPress",(I,B)=>Pe(w,I)&&M(I,B))),Ar=te(w=>e.events.on("gamepadButtonDown",(M,I)=>w(M,I)),(w,M)=>e.events.on("gamepadButtonDown",(I,B)=>Pe(w,I)&&M(I,B))),xr=te(w=>e.events.on("gamepadButtonRelease",(M,I)=>w(M,I)),(w,M)=>e.events.on("gamepadButtonRelease",(I,B)=>Pe(w,I)&&M(I,B)));function vr(w,M){return e.events.on("gamepadStick",(I,B,Z)=>I===w&&M(B,Z))}function Yt(w){e.events.on("gamepadConnect",w)}function De(w){e.events.on("gamepadDisconnect",w)}function Ye(w){return e.mergedGamepadState.stickState.get(w)||new P(0)}function jt(){return[...e.charInputted]}function we(){return[...e.gamepads]}let vt=te(w=>e.events.on("buttonPress",M=>w(M)),(w,M)=>e.events.on("buttonPress",I=>Pe(w,I)&&M(I))),Ue=te(w=>e.events.on("buttonDown",M=>w(M)),(w,M)=>e.events.on("buttonDown",I=>Pe(w,I)&&M(I))),Wt=te(w=>e.events.on("buttonRelease",M=>w(M)),(w,M)=>e.events.on("buttonRelease",I=>Pe(w,I)&&M(I)));function Hn(){e.events.trigger("input"),e.keyState.down.forEach(w=>e.events.trigger("keyDown",w)),e.mouseState.down.forEach(w=>e.events.trigger("mouseDown",w)),e.buttonState.down.forEach(w=>{e.events.trigger("buttonDown",w)}),Wn()}function Yn(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((w,M)=>{e.mergedGamepadState.stickState.set(M,new P(0))}),e.charInputted=[],e.isMouseMoved=!1,e.mouseDeltaPos=new P(0),e.gamepadStates.forEach(w=>{w.buttonState.update(),w.stickState.forEach((M,I)=>{w.stickState.set(I,new P(0))})})}function cs(w){let M={index:w.index,isPressed:I=>e.gamepadStates.get(w.index)?.buttonState.pressed.has(I)||!1,isDown:I=>e.gamepadStates.get(w.index)?.buttonState.down.has(I)||!1,isReleased:I=>e.gamepadStates.get(w.index)?.buttonState.released.has(I)||!1,getStick:I=>e.gamepadStates.get(w.index)?.stickState.get(I)||E()};return e.gamepads.push(M),e.gamepadStates.set(w.index,{buttonState:new Rt,stickState:new Map([["left",new P(0)],["right",new P(0)]])}),M}function jn(w){e.gamepads=e.gamepads.filter(M=>M.index!==w.index),e.gamepadStates.delete(w.index)}function Wn(){for(let w of navigator.getGamepads())w&&!e.gamepadStates.has(w.index)&&cs(w);for(let w of e.gamepads){let M=navigator.getGamepads()[w.index];if(!M)continue;let I=(t.gamepads??{})[M.id]||As[M.id]||As.default,B=e.gamepadStates.get(w.index);if(B){for(let Z=0;Z<M.buttons.length;Z++){let re=I.buttons[Z],Me=M.buttons[Z],ht=e.buttonsByGamepad.has(re);if(Me.pressed){if(B.buttonState.down.has(re)){e.events.trigger("gamepadButtonDown",re,w);continue}e.lastInputDevice="gamepad",ht&&e.buttonsByGamepad.get(re)?.forEach(Le=>{e.buttonState.press(Le),e.events.trigger("buttonPress",Le)}),e.mergedGamepadState.buttonState.press(re),B.buttonState.press(re),e.events.trigger("gamepadButtonPress",re,w)}else B.buttonState.down.has(re)&&(ht&&e.buttonsByGamepad.get(re)?.forEach(Le=>{e.buttonState.release(Le),e.events.trigger("buttonRelease",Le)}),e.mergedGamepadState.buttonState.release(re),B.buttonState.release(re),e.events.trigger("gamepadButtonRelease",re,w))}for(let Z in I.sticks){let re=I.sticks[Z];if(!re)continue;let Me=new P(M.axes[re.x],M.axes[re.y]);B.stickState.set(Z,Me),e.mergedGamepadState.stickState.set(Z,Me),e.events.trigger("gamepadStick",Z,Me,w)}}}}let Ae={},br={},Xt={},us=t.pixelDensity||1;Ae.mousemove=w=>{let M=ze(new P(w.offsetX,w.offsetY)),I=new P(w.movementX,w.movementY);if(x()){let B=e.canvas.width/us,Z=e.canvas.height/us,re=window.innerWidth,Me=window.innerHeight,ht=re/Me,Le=B/Z;if(ht>Le){let _e=Me/Z,Er=(re-B*_e)/2;M.x=ke(w.offsetX-Er,0,B*_e,0,B),M.y=ke(w.offsetY,0,Z*_e,0,Z)}else{let _e=re/B,Er=(Me-Z*_e)/2;M.x=ke(w.offsetX,0,B*_e,0,B),M.y=ke(w.offsetY-Er,0,Z*_e,0,Z)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=M,e.mouseDeltaPos=I,e.events.trigger("mouseMove")})};let hs=["left","middle","right","back","forward"];Ae.mousedown=w=>{e.events.onOnce("input",()=>{let M=hs[w.button];M&&(e.lastInputDevice="mouse",e.buttonsByMouse.has(M)&&e.buttonsByMouse.get(M)?.forEach(I=>{e.buttonState.press(I),e.events.trigger("buttonPress",I)}),e.mouseState.press(M),e.events.trigger("mousePress",M))})},Ae.mouseup=w=>{e.events.onOnce("input",()=>{let M=hs[w.button];M&&(e.buttonsByMouse.has(M)&&e.buttonsByMouse.get(M)?.forEach(I=>{e.buttonState.release(I),e.events.trigger("buttonRelease",I)}),e.mouseState.release(M),e.events.trigger("mouseRelease",M))})};let Xn=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),ds={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};Ae.keydown=w=>{Xn.has(w.key)&&w.preventDefault(),e.events.onOnce("input",()=>{let M=ds[w.key]||w.key.toLowerCase(),I=w.code;if(M===void 0)throw new Error(`Unknown key: ${w.key}`);M.length===1?(e.events.trigger("charInput",M),e.charInputted.push(M)):M==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),w.repeat?(e.keyState.pressRepeat(M),e.events.trigger("keyPressRepeat",M)):(e.lastInputDevice="keyboard",e.buttonsByKey.has(M)&&e.buttonsByKey.get(M)?.forEach(B=>{e.buttonState.press(B),e.events.trigger("buttonPress",B)}),e.buttonsByKeyCode.has(I)&&e.buttonsByKeyCode.get(I)?.forEach(B=>{e.buttonState.press(B),e.events.trigger("buttonPress",B)}),e.keyState.press(M),e.events.trigger("keyPressRepeat",M),e.events.trigger("keyPress",M))})},Ae.keyup=w=>{e.events.onOnce("input",()=>{let M=ds[w.key]||w.key.toLowerCase(),I=w.code;e.buttonsByKey.has(M)&&e.buttonsByKey.get(M)?.forEach(B=>{e.buttonState.release(B),e.events.trigger("buttonRelease",B)}),e.buttonsByKeyCode.has(I)&&e.buttonsByKeyCode.get(I)?.forEach(B=>{e.buttonState.release(B),e.events.trigger("buttonRelease",B)}),e.keyState.release(M),e.events.trigger("keyRelease",M)})},Ae.touchstart=w=>{w.preventDefault(),e.events.onOnce("input",()=>{let M=[...w.changedTouches],I=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=ze(new P(M[0].clientX-I.x,M[0].clientY-I.y)),e.lastInputDevice="mouse",e.buttonsByMouse.has("left")&&e.buttonsByMouse.get("left")?.forEach(B=>{e.buttonState.press(B),e.events.trigger("buttonPress",B)}),e.mouseState.press("left"),e.events.trigger("mousePress","left")),M.forEach(B=>{e.events.trigger("touchStart",ze(new P(B.clientX-I.x,B.clientY-I.y)),B)})})},Ae.touchmove=w=>{w.preventDefault(),e.events.onOnce("input",()=>{let M=[...w.changedTouches],I=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let B=e.mousePos;e.mousePos=ze(new P(M[0].clientX-I.x,M[0].clientY-I.y)),e.mouseDeltaPos=e.mousePos.sub(B),e.events.trigger("mouseMove")}M.forEach(B=>{e.events.trigger("touchMove",ze(new P(B.clientX-I.x,B.clientY-I.y)),B)})})},Ae.touchend=w=>{e.events.onOnce("input",()=>{let M=[...w.changedTouches],I=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=ze(new P(M[0].clientX-I.x,M[0].clientY-I.y)),e.mouseDeltaPos=new P(0,0),e.buttonsByMouse.has("left")&&e.buttonsByMouse.get("left")?.forEach(B=>{e.buttonState.release(B),e.events.trigger("buttonRelease",B)}),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),M.forEach(B=>{e.events.trigger("touchEnd",ze(new P(B.clientX-I.x,B.clientY-I.y)),B)})})},Ae.touchcancel=w=>{e.events.onOnce("input",()=>{let M=[...w.changedTouches],I=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=ze(new P(M[0].clientX-I.x,M[0].clientY-I.y)),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),M.forEach(B=>{e.events.trigger("touchEnd",ze(new P(B.clientX-I.x,B.clientY-I.y)),B)})})},Ae.wheel=w=>{w.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new P(w.deltaX,w.deltaY))})},Ae.contextmenu=w=>w.preventDefault(),br.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger("show")):(e.isHidden=!0,e.events.trigger("hide"))},Xt.gamepadconnected=w=>{let M=cs(w.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",M)})},Xt.gamepaddisconnected=w=>{let M=we().filter(I=>I.index===w.gamepad.index)[0];jn(w.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",M)})};for(let[w,M]of Object.entries(Ae))e.canvas.addEventListener(w,M);for(let[w,M]of Object.entries(br))document.addEventListener(w,M);for(let[w,M]of Object.entries(Xt))window.addEventListener(w,M);let ps=new ResizeObserver(w=>{for(let M of w)if(M.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return ps.observe(e.canvas),{state:e,dt:r,fixedDt:s,restDt:n,time:o,run:C,canvas:e.canvas,fps:u,numFrames:l,quit:S,isHidden:i,setFullscreen:g,isFullscreen:x,setCursor:d,screenshot:a,getGamepads:we,getCursor:m,setCursorLocked:c,isCursorLocked:f,isTouchscreen:D,mousePos:b,mouseDeltaPos:A,isKeyDown:L,isKeyPressed:O,isKeyPressedRepeat:N,isKeyReleased:K,isMouseDown:q,isMousePressed:v,isMouseReleased:T,isMouseMoved:R,isGamepadButtonPressed:Y,isGamepadButtonDown:k,isGamepadButtonReleased:F,getGamepadStick:Ye,isButtonPressed:_,isButtonDown:W,isButtonReleased:Q,setButton:G,getButton:de,pressButton:Qe,releaseButton:ct,charInputted:jt,onResize:xt,onKeyDown:Kt,onKeyPress:Gt,onKeyPressRepeat:mr,onKeyRelease:yr,onMouseDown:ut,onMousePress:Oe,onMouseRelease:Ht,onMouseMove:U,onCharInput:H,onTouchStart:j,onTouchMove:$,onTouchEnd:le,onScroll:V,onHide:ge,onShow:He,onGamepadButtonDown:Ar,onGamepadButtonPress:wr,onGamepadButtonRelease:xr,onGamepadStick:vr,onGamepadConnect:Yt,onGamepadDisconnect:De,onButtonPress:vt,onButtonDown:Ue,onButtonRelease:Wt,getLastInputDeviceType:Eo,events:e.events}};function he(){return h.app.dt()}function Fr(){return h.app.fixedDt()}function Nr(){return h.app.restDt()}var Io=new P(-1,-1),Ro=new P(0,-1),To=new P(1,-1),Oo=new P(-1,0),Do=new P(0,0),Bo=new P(1,0),ko=new P(-1,1),Fo=new P(0,1),No=new P(1,1);function wt(t){switch(t){case"topleft":return Io;case"top":return Ro;case"topright":return To;case"left":return Oo;case"center":return Do;case"right":return Bo;case"botleft":return ko;case"bot":return Fo;case"botright":return No;default:return t}}function Uo(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}function Lo(t){return t.createBuffer(1,1,44100)}var Zt=2.5949095,xs=1.70158+1,vs=2*Math.PI/3,bs=2*Math.PI/4.5,Jt={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>xs*t*t*t-1.70158*t*t,easeOutBack:t=>1+xs*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((Zt+1)*2*t-Zt)/2:(Math.pow(2*t-2,2)*((Zt+1)*(t*2-2)+Zt)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*vs),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*vs)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*bs))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*bs)/2+1,easeInBounce:t=>1-Jt.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-Jt.easeOutBounce(1-2*t))/2:(1+Jt.easeOutBounce(2*t-1))/2},kt=Jt;function zo(t,e,r){let s=[],n=e;for(s.push(n);n!==t;){if(n=r.get(n),n==null)return null;s.push(n)}return s.reverse()}function Ko(t,e,r){let s=new Qs((o,u)=>o.cost<u.cost);s.insert({cost:0,node:e});let n=new Map;n.set(e,e);let i=new Map;for(i.set(e,0);s.length!==0;){let o=s.remove()?.node;if(o===r)break;let u=t.getNeighbours(o);for(let l of u){let a=(i.get(o)||0)+t.getCost(o,l)+t.getHeuristic(l,r);(!i.has(l)||a<i.get(l))&&(i.set(l,a),s.insert({cost:a,node:l}),n.set(l,o))}}return zo(e,r,n)}var Go=class{a;b;polygon;constructor(t,e,r){this.a=t,this.b=e,this.polygon=new WeakRef(r)}isLeft(t,e){return(this.b.x-this.a.x)*(e-this.a.y)-(t-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},Ho=class{_edges;_centroid;_id;constructor(t){this._id=t}get id(){return this._id}set edges(t){this._edges=t;let e=0,r=0,s=0;for(let n of this._edges){n.polygon=new WeakRef(this);let i=n.a.x*n.b.y-n.a.y*n.b.x;e+=(n.a.x+n.b.x)*i,r+=(n.a.y+n.b.y)*i,s+=i}s/=2,this._centroid=E(e/(6*s),r/(6*s))}get edges(){return this._edges}get centroid(){return this._centroid}contains(t){let e=!1;for(let r of this.edges)r.b.y>t.y!=r.a.y>t.y&&t.x<(r.a.x-r.b.x)*(t.y-r.b.y)/(r.a.y-r.b.y)+r.b.x&&(e=!e);return e}},Yo=class{_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(t){let e=this._pointCache[`${t.x}_${t.y}`];return e||(e=t.clone(),this._pointCache[`${t.x}_${t.y}`]=e,e)}_addEdge(t){let e=`${t.a.x}_${t.a.y}-${t.b.x}_${t.b.y}`;return this._edgeCache[e]=t,t}_findEdge(t,e){let r=`${t.x}_${t.y}-${e.x}_${e.y}`;return this._edgeCache[r]}_findCommonEdge(t,e){for(let r of t.edges){let s=this._findEdge(r.b,r.a);if(s&&s.polygon.deref().id===e.id)return s}return null}addPolygon(t){let e=new Ho(this._polygons.length),r=t.map((s,n)=>new Go(s,t[(n+1)%t.length],e));e.edges=r,this._polygons.push(e);for(let s of e.edges)this._addEdge(s);return e}addRect(t,e){let r=this._addPoint(t),s=this._addPoint(t.add(e.x,0)),n=this._addPoint(t.add(e)),i=this._addPoint(t.add(0,e.y));return this.addPolygon([r,s,n,i])}_getLocation(t){for(let e of this._polygons)if(e.contains(t))return e;return null}getNeighbours(t){let e=[];for(let r of this._polygons[t].edges){let s=this._findEdge(r.b,r.a);if(s){let n=s.polygon.deref();n&&e.push(n.id)}}return e}getCost(t,e){return 1}getHeuristic(t,e){let r=this._polygons[t],s=this._polygons[e],n=r.centroid.x-s.centroid.x,i=r.centroid.y-s.centroid.y;return Math.sqrt(n*n+i*i)}getPath(t,e){return t===void 0||e===void 0?[]:t===e?[t,e]:Ko(this,t,e)}getWaypointPath(t,e,r){let s=r?.type||"centroids",n=this._getLocation(t),i=this._getLocation(e);if(n===void 0||i===void 0)return[];let o=this.getPath(n.id,i.id);if(!o)return[];if(s==="edges"){let u=[];for(let l=1;l<o.length;l++){let a=this._polygons[o[l-1]],d=this._polygons[o[l]],m=this._findCommonEdge(a,d);u.push(m.middle.add(d.centroid.sub(m.middle).unit().scale(4)))}return[t,...u,e]}else return[t,...o.slice(1,-1).map(u=>this._polygons[u].centroid),e]}};function Tt(t){let e=new Ne;return t.pos&&e.translate(t.pos),t.scale&&e.scale(t.scale),t.angle&&e.rotate(t.angle),t.parent?e.mult(t.parent.transform):e}function jo(t){return new P(t.x/pe()*2-1,-t.y/fe()*2+1)}function Ct(t,e,r,s,n,i=1){s=ae(s%360),n=ae(n%360),n<=s&&(n+=Math.PI*2);let o=[],u=Math.ceil((n-s)/ae(8)*i),l=(n-s)/u,a=E(Math.cos(s),Math.sin(s)),d=E(Math.cos(l),Math.sin(l));for(let m=0;m<=u;m++)o.push(t.add(e*a.x,r*a.y)),a=E(a.x*d.x-a.y*d.y,a.x*d.y+a.y*d.x);return o}function Wo(...t){let e=J(...t),r=t[3]??1;h.gfx.bgColor=e,h.gfx.bgAlpha=r,h.gfx.ggl.gl.clearColor(e.r/255,e.g/255,e.b/255,r)}function Xo(){return h.gfx.bgColor?.clone?.()??null}function ne(...t){if(t[0]===void 0)return;let e=E(...t);e.x===0&&e.y===0||h.gfx.transform.translate(e)}function Ce(){h.gfx.transformStack.push(h.gfx.transform.clone())}function Vo(t){h.gfx.transform=t.clone()}function Ft(...t){if(t[0]===void 0)return;let e=E(...t);e.x===1&&e.y===1||h.gfx.transform.scale(e)}function mt(t){t&&h.gfx.transform.rotate(t)}function xe(){h.gfx.transformStack.length>0&&(h.gfx.transform=h.gfx.transformStack.pop())}function qe(){h.gfx.renderer.flush()}function pe(){return h.gfx.width}function fe(){return h.gfx.height}function tn(){return(h.gfx.viewport.width+h.gfx.viewport.height)/(h.gfx.width+h.gfx.height)}function nr(){return E(pe()/2,fe()/2)}var Zo=class{lastTextureId=0;textures=[];bigTextures=[];texturesPosition=new Map;canvas;c2d;x=0;y=0;curHeight=0;gfx;padding;constructor(t,e,r,s){this.gfx=t,this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=r,this.textures=[Xe.fromImage(t,this.canvas)],this.bigTextures=[],this.padding=s;let n=this.canvas.getContext("2d");if(!n)throw new Error("Failed to get 2d context");this.c2d=n}addSingle(t){let e=Xe.fromImage(this.gfx,t);return this.bigTextures.push(e),[e,new se(0,0,1,1),0]}add(t){let e=t.width+this.padding*2,r=t.height+this.padding*2;if(e>this.canvas.width||r>this.canvas.height)return this.addSingle(t);this.x+e>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+r>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Xe.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let s=this.textures[this.textures.length-1],n=new P(this.x+this.padding,this.y+this.padding);return this.x+=e,r>this.curHeight&&(this.curHeight=r),t instanceof ImageData?this.c2d.putImageData(t,n.x,n.y):this.c2d.drawImage(t,n.x,n.y),s.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:n,size:new P(t.width,t.height),texture:s}),this.lastTextureId++,[s,new se(n.x/this.canvas.width,n.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height),this.lastTextureId-1]}free(){for(let t of this.textures)t.free();for(let t of this.bigTextures)t.free()}};function Re(t){return typeof t!="string"||$s(t)?t:h.assets.urlPrefix+t}var Te=class rn{loaded=!1;data=null;error=null;onLoadEvents=new me;onErrorEvents=new me;onFinishEvents=new me;constructor(e){e.then(r=>{this.loaded=!0,this.data=r,this.onLoadEvents.trigger(r)}).catch(r=>{if(this.error=r,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(r);else throw r}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let r=new rn(Promise.resolve(e));return r.data=e,r.loaded=!0,r}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},pt=class{assets=new Map;lastUID=0;add(t,e){let r=t??this.lastUID+++"",s=new Te(e);return this.assets.set(r,s),s}addLoaded(t,e){let r=t??this.lastUID+++"",s=Te.loaded(e);return this.assets.set(r,s),s}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(e=>{e.loaded&&t++}),t/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(t=>this.assets.get(t).error!==null).map(t=>[t,this.assets.get(t)])}};function ss(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}function pr(t){return ss(t).then(e=>e.json())}function Jo(t){return ss(t).then(e=>e.text())}function Qo(t){return ss(t).then(e=>e.arrayBuffer())}function _o(t){return t!==void 0&&(h.assets.urlPrefix=t),h.assets.urlPrefix}function $o(t,e){return h.assets.custom.add(t,pr(Re(e)))}function fr(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((r,s)=>{e.onload=()=>r(e),e.onerror=()=>s(new Error(`Failed to load image from "${t}"`))})}function st(){let t=[h.assets.sprites,h.assets.sounds,h.assets.shaders,h.assets.fonts,h.assets.bitmapFonts,h.assets.custom];return t.reduce((e,r)=>e+r.progress(),0)/t.length}function sn(){return[h.assets.sprites,h.assets.sounds,h.assets.shaders,h.assets.fonts,h.assets.bitmapFonts,h.assets.custom].reduce((t,e)=>t.concat(e.getFailedAssets()),[])}function ea(t){return h.assets.custom.get(t)??null}function Ur(t){return h.assets.custom.add(null,t)}var ta=(t,e)=>({urlPrefix:"",sprites:new pt,fonts:new pt,bitmapFonts:new pt,sounds:new pt,shaders:new pt,custom:new pt,music:{},packer:new Zo(t,2048,2048,e),loaded:!1}),ra="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Ze=class qt{tex;frames=[new se(0,0,1,1)];anims={};slice9=null;constructor(e,r,s={},n=null){this.tex=e,r&&(this.frames=r),this.anims=s,this.slice9=n}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,r={}){return typeof e=="string"?qt.fromURL(e,r):Promise.resolve(qt.fromImage(e,r))}static fromImage(e,r={}){let[s,n]=r.singular?h.assets.packer.addSingle(e):h.assets.packer.add(e),i=r.frames?r.frames.map(o=>new se(n.x+o.x*n.w,n.y+o.y*n.h,o.w*n.w,o.h*n.h)):on(r.sliceX||1,r.sliceY||1,n.x,n.y,n.w,n.h);return new qt(s,i,r.anims,r.slice9)}static fromURL(e,r={}){return fr(e).then(s=>qt.fromImage(s,r))}};function Qt(t){if(typeof t=="string"){let e=nn(t);if(e)return e;if(st()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof Ze)return Te.loaded(t);if(t instanceof Te)return t;throw new Error(`Invalid sprite: ${t}`)}}function nn(t){return h.assets.sprites.get(t)??null}function Ot(t,e,r={sliceX:1,sliceY:1,anims:{}}){return e=Re(e),Array.isArray(e)?e.some(s=>typeof s=="string")?h.assets.sprites.add(t,Promise.all(e.map(s=>typeof s=="string"?fr(s):Promise.resolve(s))).then(s=>Es(s,r))):h.assets.sprites.addLoaded(t,Es(e,r)):typeof e=="string"?h.assets.sprites.add(t,Ze.from(e,r)):h.assets.sprites.addLoaded(t,Ze.fromImage(e,r))}function on(t=1,e=1,r=0,s=0,n=1,i=1){let o=[],u=n/t,l=i/e;for(let a=0;a<e;a++)for(let d=0;d<t;d++)o.push(new se(r+d*u,s+a*l,u,l));return o}function Es(t,e={}){let r=document.createElement("canvas"),s=t[0].width,n=t[0].height;r.width=s*t.length,r.height=n;let i=r.getContext("2d");if(!i)throw new Error("Failed to create canvas context");t.forEach((u,l)=>{u instanceof ImageData?i.putImageData(u,l*s,0):i.drawImage(u,l*s,0)});let o=i.getImageData(0,0,t.length*s,n);return Ze.fromImage(o,{...e,sliceX:t.length,sliceY:1})}function sa(t="bean"){return Ot(t,ra)}function na(t,e,r){e=Re(e),r=Re(r),typeof e=="string"&&!r&&(r=no(e)+".json");let s=typeof r=="string"?pr(r):Promise.resolve(r);return h.assets.sprites.add(t,s.then(n=>{let i=n.meta.size,o=n.frames.map(l=>new se(l.frame.x/i.w,l.frame.y/i.h,l.frame.w/i.w,l.frame.h/i.h)),u={};for(let l of n.meta.frameTags)l.from===l.to?u[l.name]=l.from:u[l.name]={from:l.from,to:l.to,speed:10,loop:!0,pingpong:l.direction==="pingpong"};return Ze.from(e,{frames:o,anims:u})}))}var _t=class{fontface;filter=Or;outline=null;size=64;constructor(t,e={}){if(this.fontface=t,this.filter=e.filter??Or,this.size=e.size??64,this.size>256)throw new Error("Max font size: 256");e.outline&&(this.outline={width:1,color:J(0,0,0)},typeof e.outline=="number"?this.outline.width=e.outline:typeof e.outline=="object"&&(e.outline.width&&(this.outline.width=e.outline.width),e.outline.color&&(this.outline.color=e.outline.color)))}};function an(t){if(!t)return an(h.globalOpt.font??Gi);if(typeof t=="string"){let e=cn(t),r=ln(t);if(e)return e.data??e;if(r)return r.data??r;if(document.fonts.check(`64px ${t}`))return t;if(st()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof Te)return t.data?t.data:t;return t}function ln(t){return h.assets.fonts.get(t)??null}function ia(t,e,r={}){let s=Re(e),n=new FontFace(t,typeof e=="string"?`url(${s})`:s);return document.fonts.add(n),h.assets.fonts.add(t,n.load().catch(i=>{throw new Error(`Failed to load font from "${s}": ${i}`)}).then(i=>new _t(i,r)))}function oa(t,e,r,s){let n=t.width/e,i={},o=s.split("").entries();for(let[u,l]of o)i[l]=new se(u%n*e,Math.floor(u/n)*r,e,r);return{tex:t,map:i,size:r}}function cn(t){return h.assets.bitmapFonts.get(t)??null}function aa(t,e,r,s,n={}){let i=Re(e);return h.assets.bitmapFonts.add(t,fr(i).then(o=>oa(Xe.fromImage(h.gfx.ggl,o,n),r,s,n.chars??Ws)))}function la(t,e){return e=Re(e),h.assets.sprites.add(t,new Promise(async r=>{let s=typeof e=="string"?await pr(e):e,n=await Promise.all(s.frames.map(fr)),i=document.createElement("canvas");i.width=s.width,i.height=s.height*s.frames.length;let o=i.getContext("2d");if(!o)throw new Error("Failed to create canvas context");n.forEach((l,a)=>{o.drawImage(l,0,a*s.height)});let u=await Ot(null,i,{sliceY:s.frames.length,anims:s.anims});r(u)}))}var ca=class{ctx;glProgram;constructor(t,e,r,s){this.ctx=t,t.onDestroy(()=>this.free());let n=t.gl,i=n.createShader(n.VERTEX_SHADER),o=n.createShader(n.FRAGMENT_SHADER);if(!i||!o)throw new Error("Failed to create shader");n.shaderSource(i,e),n.shaderSource(o,r),n.compileShader(i),n.compileShader(o);let u=n.createProgram();if(this.glProgram=u,n.attachShader(u,i),n.attachShader(u,o),s.forEach((l,a)=>n.bindAttribLocation(u,a,l)),n.linkProgram(u),!n.getProgramParameter(u,n.LINK_STATUS)){let l=n.getShaderInfoLog(i);if(l)throw new Error("VERTEX SHADER "+l);let a=n.getShaderInfoLog(o);if(a)throw new Error("FRAGMENT SHADER "+a)}n.deleteShader(i),n.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(t){let e=this.ctx.gl;for(let r in t){let s=t[r],n=e.getUniformLocation(this.glProgram,r);if(typeof s=="number")e.uniform1f(n,s);else if(s instanceof Ne)e.uniformMatrix4fv(n,!1,new Float32Array(s.m));else if(s instanceof X)e.uniform3f(n,s.r,s.g,s.b);else if(s instanceof P)e.uniform2f(n,s.x,s.y);else if(Array.isArray(s))s[0],eo(s)?e.uniform1fv(n,s):$i(s)?e.uniform2fv(n,s.map(i=>[i.x,i.y]).flat()):_i(s)&&e.uniform3fv(n,s.map(i=>[i.r,i.g,i.b]).flat());else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function ns(t,e=Dr,r=Br){let s=Wi.replace("{{user}}",e??Dr),n=Xi.replace("{{user}}",r??Br);try{return new ca(t,s,n,$r.map(i=>i.name))}catch(i){let o=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,u=io(i).match(o);if(!u?.groups)throw i;let l=Number(u.groups.line)-14,a=u.groups.msg.trim(),d=u.groups.type.toLowerCase();throw new Error(`${d} shader line ${l}: ${a}`)}}function ua(t){if(!t)return h.gfx.defShader;if(typeof t=="string"){let e=un(t);if(e)return e.data??e;if(st()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof Te)return t.data?t.data:t;return t}function un(t){return h.assets.shaders.get(t)??null}function ha(t,e,r){return h.assets.shaders.addLoaded(t,ns(h.gfx.ggl,e,r))}function da(t,e,r){e=Re(e),r=Re(r);let s=i=>i?Jo(i):Promise.resolve(null),n=Promise.all([s(e),s(r)]).then(([i,o])=>ns(h.gfx.ggl,i,o));return h.assets.shaders.add(t,n)}var Nt=class $t{buf;constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise((r,s)=>h.audio.ctx.decodeAudioData(e,r,s)).then(r=>new $t(r))}static fromURL(e){return $s(e)?$t.fromArrayBuffer(ro(e)):Qo(e).then(r=>$t.fromArrayBuffer(r))}};function pa(t){if(typeof t=="string"){let e=hn(t);if(e)return e;if(st()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof Nt)return Te.loaded(t);if(t instanceof Te)return t;throw new Error(`Invalid sound: ${t}`)}}function hn(t){return h.assets.sounds.get(t)??null}function fa(t,e){return e=Re(e),h.assets.sounds.add(t,typeof e=="string"?Nt.fromURL(e):Nt.fromArrayBuffer(e))}function ga(t,e){let r=Re(e),s=new Audio(r);return s.preload="auto",h.assets.music[t]=r}function dn(t,e){return t=Re(t),Ur(typeof e=="string"?new Promise((r,s)=>{pr(e).then(n=>{dn(t,n).then(r).catch(s)})}):Ze.from(t).then(r=>{let s={};for(let n in e){let i=e[n],o=r.frames[0],u=2048*o.w,l=2048*o.h,a=i.frames?i.frames.map(m=>new se(o.x+(i.x+m.x)/u*o.w,o.y+(i.y+m.y)/l*o.h,m.w/u*o.w,m.h/l*o.h)):on(i.sliceX||1,i.sliceY||1,o.x+i.x/u*o.w,o.y+i.y/l*o.h,i.width/u*o.w,i.height/l*o.h),d=new Ze(r.tex,a,i.anims);h.assets.sprites.addLoaded(n,d),s[n]=d}return s}))}function Je(t,e,r=!1,s,n,i={}){let o=s??h.gfx.defTex,u=n??h.gfx.defShader,l=ua(u);if(!l||l instanceof Te)return;let a=h.gfx.fixed||r?h.gfx.transform:h.game.cam.transform.mult(h.gfx.transform),d=[];for(let m of t){let c=jo(a.multVec2(m.pos));d.push(c.x,c.y,m.uv.x,m.uv.y,m.color.r/255,m.color.g/255,m.color.b/255,m.opacity)}h.gfx.renderer.push(h.gfx.ggl.gl.TRIANGLES,d,e,l,o,i)}function We(t){if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let e=t.pts.length;if(!(e<3)){if(Ce(),ne(t.pos),Ft(t.scale),mt(t.angle),ne(t.offset),t.fill!==!1){let r=t.color??X.WHITE,s=t.pts.map((i,o)=>({pos:new P(i.x,i.y),uv:t.uv?t.uv[o]:new P(0,0),color:t.colors&&t.colors[o]?t.colors[o].mult(r):r,opacity:t.opacity??1})),n;t.triangulate?n=js(t.pts).map(i=>i.map(o=>t.pts.indexOf(o))).flat():n=[...Array(e-2).keys()].map(i=>[0,i+1,i+2]).flat(),Je(s,t.indices??n,t.fixed,t.uv?t.tex:h.gfx.defTex,t.shader,t.uniform??void 0)}t.outline&&is({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity??t.outline.opacity}),xe()}}function pn(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(t.radiusX===0||t.radiusY===0)return;let e=t.start??0,r=t.end??360,s=wt(t.anchor??"center").scale(new P(-t.radiusX,-t.radiusY)),n=Ct(s,t.radiusX,t.radiusY,e,r,t.resolution);n.unshift(s);let i=Object.assign({},t,{pts:n,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(n.length-1).fill(t.gradient[1])]}:{}});if(r-e>=360&&t.outline){t.fill!==!1&&We(Object.assign({},i,{outline:null})),We(Object.assign({},i,{pts:n.slice(1),fill:!1}));return}We(i)}function At(t){if(typeof t.radius!="number")throw new Error('drawCircle() requires property "radius".');t.radius!==0&&pn(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}function It(t){let{p1:e,p2:r}=t;if(!e||!r)throw new Error('drawLine() requires properties "p1" and "p2".');let s=t.width||1,n=r.sub(e).unit().normal().scale(s*.5),i=[e.sub(n),e.add(n),r.add(n),r.sub(n)].map(o=>({pos:new P(o.x,o.y),uv:new P(0),color:t.color??X.WHITE,opacity:t.opacity??1}));Je(i,[0,1,3,1,2,3],t.fixed,h.gfx.defTex,t.shader,t.uniform??void 0)}function ma(t){let e=t.pts,r=[],s=(t.width||1)*.5,n=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),i=t.pos||E(0,0),o;n?o=e[0].sub(e[e.length-2]):o=e[1].sub(e[0]);let u=o.len(),l=o.normal().scale(-s/u),a,d=e[0];if(!n)switch(t.cap){case"square":{let p=o.scale(-s/u);r.push(d.add(p).add(l)),r.push(d.add(p).sub(l));break}case"round":{let p=Math.max(s,10),y=Math.PI/p,g=l.scale(-1),x=Math.cos(y),S=Math.sin(y);for(let C=0;C<p;C++)r.push(d),r.push(d.sub(g)),g=E(g.x*x-g.y*S,g.x*S+g.y*x)}}for(let p=1;p<e.length;p++){if(d===e[p]||d.eq(e[p]))continue;a=d,d=e[p];let y=d.sub(a),g=y.len(),x=y.normal().scale(-s/g),S=o.cross(y);if(Math.abs(S)/(u*g)<.05){r.push(a.add(l)),r.push(a.sub(l)),o.dot(y)<0&&(r.push(a.sub(l)),r.push(a.add(l))),o=y,u=g,l=x;continue}let C=x.sub(l).cross(y)/S,D=l.add(o.scale(C));S>0?(r.push(a.add(D)),r.push(a.sub(l)),r.push(a.add(D)),r.push(a.sub(x))):(r.push(a.add(l)),r.push(a.sub(D)),r.push(a.add(x)),r.push(a.sub(D))),o=y,u=g,l=x}if(!n)switch(r.push(d.add(l)),r.push(d.sub(l)),t.cap){case"square":{let p=o.scale(s/u);r.push(d.add(p).add(l)),r.push(d.add(p).sub(l));break}case"round":{let p=Math.max(s,10),y=Math.PI/p,g=l.scale(1),x=Math.cos(y),S=Math.sin(y);for(let C=0;C<p;C++)g=E(g.x*x-g.y*S,g.x*S+g.y*x),r.push(d),r.push(d.sub(g))}}if(r.length<4)return;let m=r.map(p=>({pos:i.add(p),uv:E(),color:t.color||X.WHITE,opacity:t.opacity??1})),c=[],f=0;for(let p=0;p<r.length-2;p+=2)c[f++]=p+1,c[f++]=p,c[f++]=p+2,c[f++]=p+2,c[f++]=p+3,c[f++]=p+1;n&&(c[f++]=r.length-1,c[f++]=r.length-2,c[f++]=0,c[f++]=0,c[f++]=1,c[f++]=r.length-1),Je(m,c,t.fixed,h.gfx.defTex,t.shader,t.uniform??void 0)}function ya(t){let e=t.pts,r=[],s=(t.width||1)*.5,n=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),i=t.pos||E(0,0),o;n?o=e[0].sub(e[e.length-2]):o=e[1].sub(e[0]);let u=o.len(),l=o.normal().scale(-s/u),a,d=e[0];if(!n)switch(t.cap){case"square":{let p=o.scale(-s/u);r.push(d.add(p).add(l)),r.push(d.add(p).sub(l));break}case"round":{let p=Math.max(s,10),y=Math.PI/p,g=l.scale(-1),x=Math.cos(y),S=Math.sin(y);for(let C=0;C<p;C++)r.push(d),r.push(d.sub(g)),g=E(g.x*x-g.y*S,g.x*S+g.y*x)}}for(let p=1;p<e.length;p++){if(d===e[p]||d.eq(e[p]))continue;a=d,d=e[p];let y=d.sub(a),g=y.len(),x=y.normal().scale(-s/g),S=o.cross(y);if(Math.abs(S)/(u*g)<.05){r.push(a.add(l)),r.push(a.sub(l)),o.dot(y)<0&&(r.push(a.sub(l)),r.push(a.add(l))),o=y,u=g,l=x;continue}let C=x.sub(l).cross(y)/S,D=l.add(o.scale(C));if(S>0){let b=a.add(D),A=Math.max(s,10),v=ae(l.angleBetween(x)/A),q=l,T=Math.cos(v),R=Math.sin(v);for(let O=0;O<A;O++)r.push(b),r.push(a.sub(q)),q=E(q.x*T-q.y*R,q.x*R+q.y*T)}else{let b=a.sub(D),A=Math.max(s,10),v=ae(l.angleBetween(x)/A),q=l,T=Math.cos(v),R=Math.sin(v);for(let O=0;O<A;O++)r.push(a.add(q)),r.push(b),q=E(q.x*T-q.y*R,q.x*R+q.y*T)}o=y,u=g,l=x}if(!n)switch(r.push(d.add(l)),r.push(d.sub(l)),t.cap){case"square":{let p=o.scale(s/u);r.push(d.add(p).add(l)),r.push(d.add(p).sub(l));break}case"round":{let p=Math.max(s,10),y=Math.PI/p,g=l.scale(1),x=Math.cos(y),S=Math.sin(y);for(let C=0;C<p;C++)g=E(g.x*x-g.y*S,g.x*S+g.y*x),r.push(d),r.push(d.sub(g))}}if(r.length<4)return;let m=r.map(p=>({pos:i.add(p),uv:E(),color:t.color||X.WHITE,opacity:t.opacity??1})),c=[],f=0;for(let p=0;p<r.length-2;p+=2)c[f++]=p+1,c[f++]=p,c[f++]=p+2,c[f++]=p+2,c[f++]=p+3,c[f++]=p+1;n&&(c[f++]=r.length-1,c[f++]=r.length-2,c[f++]=0,c[f++]=0,c[f++]=1,c[f++]=r.length-1),Je(m,c,t.fixed,h.gfx.defTex,t.shader,t.uniform??void 0)}function wa(t){let e=t.pts,r=[],s=(t.width||1)*.5,n=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),i=t.pos||E(0,0),o;n?o=e[0].sub(e[e.length-2]):o=e[1].sub(e[0]);let u=o.len(),l=o.normal().scale(-s/u),a,d=e[0];if(!n)switch(t.cap){case"square":{let p=o.scale(-s/u);r.push(d.add(p).add(l)),r.push(d.add(p).sub(l));break}case"round":{let p=Math.max(s,10),y=Math.PI/p,g=l.scale(-1),x=Math.cos(y),S=Math.sin(y);for(let C=0;C<p;C++)r.push(d),r.push(d.sub(g)),g=E(g.x*x-g.y*S,g.x*S+g.y*x)}}for(let p=1;p<e.length;p++){if(d===e[p]||d.eq(e[p]))continue;a=d,d=e[p];let y=d.sub(a),g=y.len(),x=y.normal().scale(-s/g),S=o.cross(y);if(Math.abs(S)/(u*g)<.05){r.push(a.add(l)),r.push(a.sub(l)),o.dot(y)<0&&(r.push(a.sub(l)),r.push(a.add(l))),o=y,u=g,l=x;continue}let C=x.sub(l).cross(y)/S,D=l.add(o.scale(C));r.push(a.add(D)),r.push(a.sub(D)),o=y,u=g,l=x}if(!n)switch(r.push(d.add(l)),r.push(d.sub(l)),t.cap){case"square":{let p=o.scale(s/u);r.push(d.add(p).add(l)),r.push(d.add(p).sub(l));break}case"round":{let p=Math.max(s,10),y=Math.PI/p,g=l.scale(1),x=Math.cos(y),S=Math.sin(y);for(let C=0;C<p;C++)g=E(g.x*x-g.y*S,g.x*S+g.y*x),r.push(d),r.push(d.sub(g))}}if(r.length<4)return;let m=r.map(p=>({pos:i.add(p),uv:E(),color:t.color||X.WHITE,opacity:t.opacity??1})),c=[],f=0;for(let p=0;p<r.length-2;p+=2)c[f++]=p+1,c[f++]=p,c[f++]=p+2,c[f++]=p+2,c[f++]=p+3,c[f++]=p+1;n&&(c[f++]=r.length-1,c[f++]=r.length-2,c[f++]=0,c[f++]=0,c[f++]=1,c[f++]=r.length-1),Je(m,c,t.fixed,h.gfx.defTex,t.shader,t.uniform??void 0)}function is(t){let e=t.pts,r=t.width??1;if(!e)throw new Error('drawLines() requires property "pts".');if(!(e.length<2)){if(e.length>2)switch(t.join){case"bevel":return ma(t);case"round":return ya(t);case"miter":return wa(t)}if(t.radius&&e.length>=3){It(Object.assign({},t,{p1:e[0],p2:e[1]}));for(let s=1;s<e.length-2;s++){let n=e[s],i=e[s+1];It(Object.assign({},t,{p1:n,p2:i}))}It(Object.assign({},t,{p1:e[e.length-2],p2:e[e.length-1]}))}else for(let s=0;s<e.length-1;s++)It(Object.assign({},t,{p1:e[s],p2:e[s+1]})),t.join!=="none"&&At(Object.assign({},t,{pos:e[s],radius:r/2}))}}function fn(t,e){let r=e.segments??16,s=[];for(let n=0;n<=r;n++)s.push(t(n/r));is({pts:s,width:e.width||1,pos:e.pos,color:e.color,opacity:e.opacity})}function Aa(t){fn(e=>_r(t.pt1,t.pt2,t.pt3,t.pt4,e),t)}var Xe=class gn{ctx;src=null;glTex;width;height;constructor(e,r,s,n={}){this.ctx=e;let i=e.gl,o=e.gl.createTexture();if(!o)throw new Error("Failed to create texture");this.glTex=o,e.onDestroy(()=>this.free()),this.width=r,this.height=s;let u={linear:i.LINEAR,nearest:i.NEAREST}[n.filter??e.opts.texFilter??"nearest"],l={repeat:i.REPEAT,clampToEdge:i.CLAMP_TO_EDGE}[n.wrap??"clampToEdge"];this.bind(),r&&s&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,r,s,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,l),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,l),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(e,r,s={}){let n=new gn(e,r.width,r.height,s);return n.update(r),n.src=r,n}update(e,r=0,s=0){let n=this.ctx.gl;this.bind(),n.texSubImage2D(n.TEXTURE_2D,0,r,s,n.RGBA,n.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},ir=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(t,e,r,s={}){this.ctx=t;let n=t.gl;t.onDestroy(()=>this.free()),this.tex=new Xe(t,e,r,s);let i=n.createFramebuffer(),o=n.createRenderbuffer();if(!i||!o)throw new Error("Failed to create framebuffer");this.glFramebuffer=i,this.glRenderbuffer=o,this.bind(),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.tex.glTex,0),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let t=this.ctx.gl,e=new Uint8ClampedArray(this.width*this.height*4);this.bind(),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,e),this.unbind();let r=this.width*4,s=new Uint8Array(r);for(let n=0;n<(this.height/2|0);n++){let i=n*r,o=(this.height-n-1)*r;s.set(e.subarray(i,i+r)),e.copyWithin(i,o,o+r),e.set(s,o)}return new ImageData(e,this.width,this.height)}toDataURL(){let t=document.createElement("canvas"),e=t.getContext("2d");if(t.width=this.width,t.height=this.height,!e)throw new Error("Failed to get 2d context");return e.putImageData(this.toImageData(),0,0),t.toDataURL()}clear(){let t=this.ctx.gl;t.clear(t.COLOR_BUFFER_BIT)}draw(t){this.bind(),t(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let t=this.ctx.gl;t.deleteFramebuffer(this.glFramebuffer),t.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},xa=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(t,e,r,s){let n=t.gl;this.vertexFormat=e,this.ctx=t,this.stride=e.reduce((o,u)=>o+u.size,0),this.maxVertices=r,this.maxIndices=s;let i=n.createBuffer();if(!i)throw new Error("Failed to create vertex buffer");this.glVBuf=i,t.pushArrayBuffer(this.glVBuf),n.bufferData(n.ARRAY_BUFFER,r*4,n.DYNAMIC_DRAW),t.popArrayBuffer(),this.glIBuf=n.createBuffer(),t.pushElementArrayBuffer(this.glIBuf),n.bufferData(n.ELEMENT_ARRAY_BUFFER,s*4,n.DYNAMIC_DRAW),t.popElementArrayBuffer()}push(t,e,r,s,n=null,i={}){(t!==this.curPrimitive||n!==this.curTex||s!==this.curShader||!ts(this.curUniform,i)||this.vqueue.length+e.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let u of e)this.vqueue.push(u);for(let u of r)this.iqueue.push(u+o);this.curPrimitive=t,this.curShader=s,this.curTex=n,this.curUniform=i}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let t=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),t.drawElements(this.curPrimitive,this.iqueue.length,t.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let t=this.ctx.gl;t.deleteBuffer(this.glVBuf),t.deleteBuffer(this.glIBuf)}};function $e(t){let e=[],r=i=>{e.push(i),t(i)},s=()=>{e.pop(),t(n()??null)},n=()=>e[e.length-1];return[r,s,n]}function va(t,e={}){let r=[];function s(b){r.push(b)}function n(){r.forEach(A=>A());let b=t.getExtension("WEBGL_lose_context");b&&b.loseContext()}let i=null;function o(b){if(ts(b,i))return;i=b;let A=b.reduce((v,q)=>v+q.size,0);b.reduce((v,q,T)=>(t.vertexAttribPointer(T,q.size,t.FLOAT,!1,A*4,v),t.enableVertexAttribArray(T),v+q.size*4),0)}let[u,l]=$e(b=>t.bindTexture(t.TEXTURE_2D,b)),[a,d]=$e(b=>t.bindBuffer(t.ARRAY_BUFFER,b)),[m,c]=$e(b=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,b)),[f,p]=$e(b=>t.bindFramebuffer(t.FRAMEBUFFER,b)),[y,g]=$e(b=>t.bindRenderbuffer(t.RENDERBUFFER,b)),[x,S]=$e(b=>{if(!b)return;let{x:A,y:v,w:q,h:T}=b;t.viewport(A,v,q,T)}),[C,D]=$e(b=>t.useProgram(b));return x({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:s,destroy:n,pushTexture2D:u,popTexture2D:l,pushArrayBuffer:a,popArrayBuffer:d,pushElementArrayBuffer:m,popElementArrayBuffer:c,pushFramebuffer:f,popFramebuffer:p,pushRenderbuffer:y,popRenderbuffer:g,pushViewport:x,popViewport:S,pushProgram:C,popProgram:D,setVertexFormat:o}}var Pr={};function Ss(t,e){if(e.override){Object.assign(t,e);return}e.pos&&(t.pos=t.pos.add(e.pos)),e.scale&&(t.scale=t.scale.scale(E(e.scale))),e.angle&&(t.angle+=e.angle),e.color&&t.ch.length===1&&(t.color=t.color.mult(e.color)),e.opacity!=null&&(t.opacity*=e.opacity)}function Lr(t){let e={},r="",s=[],n=String(t),i=o=>{s.length>0&&(e[r.length]=s.slice()),r+=o};for(;n!=="";){if(n[0]==="\\"){if(n.length===1)throw new Error("Styled text error: \\ at end of string");i(n[1]),n=n.slice(2);continue}if(n[0]==="["){let o=/^\[(\/)?(\w+?)\]/.exec(n);if(!o){i(n[0]),n=n.slice(1);continue}let[u,l,a]=o;if(l!==void 0){let d=s.pop();if(d!==a)throw d!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${d}], got [/${a}]`):new Error(`Styled text error: stray end tag [/${a}]`)}else s.push(a);n=n.slice(u.length);continue}i(n[0]),n=n.slice(1)}if(s.length>0)throw new Error(`Styled text error: unclosed tags ${s}`);return{charStyleMap:e,text:r}}function nt(t){if(t.text===void 0)throw new Error('formatText() requires property "text".');let e=an(t.font);if(!t.text||t.text===""||e instanceof Te||!e)return{width:0,height:0,chars:[],opt:t,renderedText:""};let{charStyleMap:r,text:s}=Lr(t.text+""),n=lo(s);if(e instanceof _t||typeof e=="string"){let C=e instanceof _t?e.fontface.family:e,D=e instanceof _t?{outline:e.outline,filter:e.filter}:{outline:null,filter:Or},b=Pr[C]??{font:{tex:new Xe(h.gfx.ggl,2048,2048,{filter:D.filter}),map:{},size:64},cursor:new P(0),maxHeight:0,outline:D.outline};Pr[C]||(Pr[C]=b),e=b.font;for(let A of n)if(!b.font.map[A]){let v=h.fontCacheC2d;if(!v)throw new Error("fontCacheC2d is not defined.");if(!h.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");v.clearRect(0,0,h.fontCacheCanvas.width,h.fontCacheCanvas.height),v.font=`${e.size}px ${C}`,v.textBaseline="top",v.textAlign="left",v.fillStyle="#ffffff";let q=v.measureText(A),T=Math.ceil(q.width);if(!T)continue;let R=Math.ceil(Math.abs(q.actualBoundingBoxAscent))+Math.ceil(Math.abs(q.actualBoundingBoxDescent));b.outline&&b.outline.width&&b.outline.color&&(v.lineJoin="round",v.lineWidth=b.outline.width*2,v.strokeStyle=b.outline.color.toHex(),v.strokeText(A,b.outline.width,b.outline.width),T+=b.outline.width*2,R+=b.outline.width*3),v.fillText(A,b.outline?.width??0,b.outline?.width??0);let O=v.getImageData(0,0,T,R);if(b.cursor.x+T>2048&&(b.cursor.x=0,b.cursor.y+=b.maxHeight,b.maxHeight=0,b.cursor.y>2048))throw new Error("Font atlas exceeds character limit");e.tex.update(O,b.cursor.x,b.cursor.y),e.map[A]=new se(b.cursor.x,b.cursor.y,T,R),b.cursor.x+=T+1,b.maxHeight=Math.max(b.maxHeight,R)}}let i=t.size||e.size,o=E(t.scale??1).scale(i/e.size),u=t.lineSpacing??0,l=t.letterSpacing??0,a=0,d=0,m=0,c=[],f=[],p=0,y=null,g=0,x;for(;p<n.length;){let C=n[p];if(C===`
`)m+=i+u,c.push({width:a-l,chars:f}),y=null,g=0,a=0,f=[],x=void 0;else{let D=e.map[C];if(D){let b=D.w*o.x;t.width&&a+b>t.width&&(m+=i+u,y!=null&&(p-=f.length-y,C=n[p],D=e.map[C],b=D.w*o.x,f=f.slice(0,y-1),a=g),y=null,g=0,c.push({width:a-l,chars:f}),a=x??0,f=[]),f.push({tex:e.tex,width:D.w,height:D.h,quad:new se(D.x/e.tex.width,D.y/e.tex.height,D.w/e.tex.width,D.h/e.tex.height),ch:C,pos:new P(a,m),opacity:t.opacity??1,color:t.color??X.WHITE,scale:E(o),angle:0}),C===" "&&(y=f.length,g=a),t.indentAll&&x===void 0&&/\S/.test(C)&&(x=a),a+=b,d=Math.max(d,a),a+=l}}p++}c.push({width:a-l,chars:f}),m+=i,t.width&&(d=t.width);let S=[];for(let C=0;C<c.length;C++){let D=(d-c[C].width)*Uo(t.align??"left");for(let b of c[C].chars){let A=e.map[b.ch],v=S.length+C;if(b.pos=b.pos.add(D,0).add(A.w*o.x*.5,A.h*o.y*.5),t.transform){let q=typeof t.transform=="function"?t.transform(v,b.ch):t.transform;q&&Ss(b,q)}if(r[v]){let q=r[v];for(let T of q){let R=t.styles?.[T],O=typeof R=="function"?R(v,b.ch):R;O&&Ss(b,O)}}S.push(b)}}return{width:d,height:m,chars:S,opt:t,renderedText:s}}function Ut(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,r=t.height,s=wt(t.anchor||dr).scale(new P(e,r).scale(-.5)),n=t.quad||new se(0,0,1,1),i=t.color||J(255,255,255),o=t.opacity??1,u=t.tex?.1/t.tex.width:0,l=t.tex?.1/t.tex.height:0,a=n.x+u,d=n.y+l,m=n.w-u*2,c=n.h-l*2;Ce(),ne(t.pos),mt(t.angle),Ft(t.scale),ne(s),Je([{pos:new P(-e/2,r/2),uv:new P(t.flipX?a+m:a,t.flipY?d:d+c),color:i,opacity:o},{pos:new P(-e/2,-r/2),uv:new P(t.flipX?a+m:a,t.flipY?d+c:d),color:i,opacity:o},{pos:new P(e/2,-r/2),uv:new P(t.flipX?a:a+m,t.flipY?d+c:d),color:i,opacity:o},{pos:new P(e/2,r/2),uv:new P(t.flipX?a:a+m,t.flipY?d:d+c),color:i,opacity:o}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform??void 0),xe()}function it(t){Ce(),ne(t.opt.pos),mt(t.opt.angle),ne(wt(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(e=>{Ut({tex:e.tex,width:e.width,height:e.height,pos:e.pos,scale:e.scale,angle:e.angle,color:e.color,opacity:e.opacity,quad:e.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),xe()}function Ie(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,r=t.height,s=wt(t.anchor||dr).add(1,1).scale(new P(e,r).scale(-.5)),n=[new P(0,0),new P(e,0),new P(e,r),new P(0,r)];if(t.radius){let i=Math.min(e,r)/2,o=Array.isArray(t.radius)?t.radius.map(u=>Math.min(i,u)):new Array(4).fill(Math.min(i,t.radius));n=[new P(o[0],0),...o[1]?Ct(new P(e-o[1],o[1]),o[1],o[1],270,360):[E(e,0)],...o[2]?Ct(new P(e-o[2],r-o[2]),o[2],o[2],0,90):[E(e,r)],...o[3]?Ct(new P(o[3],r-o[3]),o[3],o[3],90,180):[E(0,r)],...o[0]?Ct(new P(o[0],o[0]),o[0],o[0],180,270):[]]}We(Object.assign({},t,{offset:s,pts:n,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}function je(t){qe();let e=h.gfx.width,r=h.gfx.height;h.gfx.width=h.gfx.viewport.width,h.gfx.height=h.gfx.viewport.height,t(),qe(),h.gfx.width=e,h.gfx.height=r}function Ms(t,e){je(()=>{let r=E(8);Ce(),ne(t);let s=nt({text:e,font:sr,size:16,pos:r,color:J(255,255,255),fixed:!0}),n=s.width+r.x*2,i=s.height+r.x*2;t.x+n>=pe()&&ne(E(-n,0)),t.y+i>=fe()&&ne(E(0,-i)),Ie({width:n,height:i,color:J(0,0,0),radius:4,opacity:.8,fixed:!0}),it(s),xe()})}function mn(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return We(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}function ba(){if(h.debug.inspect){let t=null;for(let e of h.game.root.get("*",{recursive:!0}))if(e.has("area")&&e.isHovering()){t=e;break}if(h.game.root.drawInspect(),t){let e=[],r=t.inspect();for(let s in r)r[s]?e.push(`${r[s]}`):e.push(`${s}`);Ms(bo(h.k.mousePos()),e.join(`
`))}Ms(E(8),`FPS: ${h.debug.fps()}`)}h.debug.paused&&je(()=>{Ce(),ne(pe(),0),ne(-8,8);let t=32;Ie({width:t,height:t,anchor:"topright",color:J(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Ie({width:4,height:t*.6,anchor:"center",pos:E(-t/3*e,t*.5),color:J(255,255,255),radius:2,fixed:!0});xe()}),h.debug.timeScale!==1&&je(()=>{Ce(),ne(pe(),fe()),ne(-8,-8);let t=8,e=nt({text:h.debug.timeScale.toFixed(1),font:sr,size:16,color:J(255,255,255),pos:E(-t),anchor:"botright",fixed:!0});Ie({width:e.width+t*2+t*4,height:e.height+t*2,anchor:"botright",color:J(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=0;r<2;r++){let s=h.debug.timeScale<1;mn({p1:E(-e.width-t*(s?2:3.5),-t),p2:E(-e.width-t*(s?2:3.5),-t-e.height),p3:E(-e.width-t*(s?3.5:2),-t-e.height/2),pos:E(-r*t*1+(s?-t*.5:0),0),color:J(255,255,255),fixed:!0})}it(e),xe()}),h.debug.curRecording&&je(()=>{Ce(),ne(0,fe()),ne(24,-24),At({radius:12,color:J(255,0,0),opacity:Is(0,1,h.app.time()*4),fixed:!0}),xe()}),h.debug.showLog&&h.game.logs.length>0&&je(()=>{Ce(),ne(0,fe()),ne(8,-8);let t=8,e=[];for(let s of h.game.logs){let n="",i=s.msg instanceof Error?"error":"info";n+=`[time]${s.time.toFixed(2)}[/time]`,n+=" ",n+=`[${i}]${zr(s.msg)}[/${i}]`,e.push(n)}h.game.logs=h.game.logs.filter(s=>h.app.time()-s.time<(h.globalOpt.logTime||4));let r=nt({text:e.join(`
`),font:sr,pos:E(t,-t),anchor:"botleft",size:16,width:pe()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:J(127,127,127)},info:{color:J(255,255,255)},error:{color:J(255,0,127)}}});Ie({width:r.width+t*2,height:r.height+t*2,anchor:"botleft",color:J(0,0,0),radius:4,opacity:.8,fixed:!0}),it(r),xe()})}function zr(t,e=!1,r=new Set){if(r.has(t))return"<recursive>";var s="",n;return e&&typeof t=="string"&&(t=JSON.stringify(t)),Array.isArray(t)&&(s=["[",t.map(i=>zr(i,!0,r.union(new Set([t])))).join(", "),"]"].join(""),t=s),t===null?"null":(typeof t=="object"&&t.toString===Object.prototype.toString&&(t.constructor!==Object&&(s+=t.constructor.name+" "),s+=["{",(n=Object.getOwnPropertyNames(t).map(i=>`${/^\w+$/.test(i)?i:JSON.stringify(i)}: ${zr(t[i],!0,r.union(new Set([t])))}`).join(", "))?` ${n} `:"","}"].join(""),t=s),String(t).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\["))}function Ea(){let t=h.game.cam,e=P.fromAngle(ue(0,360)).scale(t.shake);t.shake=ve(t.shake,0,5*he()),t.transform=new Ne().translate(nr()).scale(t.scale).rotate(t.angle).translate((t.pos??nr()).scale(-1).add(e)),h.game.root.draw(),qe()}function Sa(){let t=st();h.game.events.numListeners("loading")>0?h.game.events.trigger("loading",t):je(()=>{let e=pe()/2,r=24,s=E(pe()/2,fe()/2).sub(E(e/2,r/2));Ie({pos:E(0),width:pe(),height:fe(),color:J(0,0,0)}),Ie({pos:s,width:e,height:r,fill:!1,outline:{width:4}}),Ie({pos:s,width:e*t,height:r})})}function yn(t,e,r){let s=h.gfx.ggl.gl;qe(),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST),s.stencilFunc(s.NEVER,1,255),s.stencilOp(s.REPLACE,s.REPLACE,s.REPLACE),e(),qe(),s.stencilFunc(r,1,255),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),t(),qe(),s.disable(s.STENCIL_TEST)}function Ma(t,e){let r=h.gfx.ggl.gl;yn(t,e,r.EQUAL)}function or(t){if(!t.tex)throw new Error('drawTexture() requires property "tex".');let e=t.quad??new se(0,0,1,1),r=t.tex.width*e.w,s=t.tex.height*e.h,n=new P(1);if(t.tiled){let i=wt(t.anchor||dr);(t.pos?.x||0)-(i.x+1)*.5*(t.width||r),(t.pos?.y||0)-(i.y+1)*.5*(t.height||s);let o=(t.width||r)/r,u=(t.height||s)/s,l=Math.floor(o),a=Math.floor(u),d=o-l,m=u-a,c=(l+d?1:0)*(a+m?1:0),f=new Array(c*6),p=new Array(c*4),y=0,g=(x,S,C,D,b)=>{f[y*6+0]=y*4+0,f[y*6+1]=y*4+1,f[y*6+2]=y*4+3,f[y*6+3]=y*4+1,f[y*6+4]=y*4+2,f[y*6+5]=y*4+3,p[y*4+0]={pos:new P(x-i.x,S-i.y),uv:new P(b.x,b.y),color:t.color||X.WHITE,opacity:t.opacity||1},p[y*4+1]={pos:new P(x+C-i.x,S-i.y),uv:new P(b.x+b.w,b.y),color:t.color||X.WHITE,opacity:t.opacity||1},p[y*4+2]={pos:new P(x+C-i.x,S+D-i.y),uv:new P(b.x+b.w,b.y+b.h),color:t.color||X.WHITE,opacity:t.opacity||1},p[y*4+3]={pos:new P(x-i.x,S+D-i.y),uv:new P(b.x,b.y+b.h),color:t.color||X.WHITE,opacity:t.opacity||1},y++};for(let x=0;x<a;x++){for(let S=0;S<l;S++)g(S*r,x*s,r,s,e);d&&g(l*r,x*s,r*d,s,new se(e.x,e.y,e.w*d,e.h))}if(m){for(let x=0;x<l;x++)g(x*r,a*s,r,s*m,new se(e.x,e.y,e.w,e.h*m));d&&g(l*r,a*s,r*d,s*m,new se(e.x,e.y,e.w*d,e.h*m))}Je(p,f,t.fixed,t.tex,t.shader,t.uniform??void 0)}else t.width&&t.height?(n.x=t.width/r,n.y=t.height/s):t.width?(n.x=t.width/r,n.y=n.x):t.height&&(n.y=t.height/s,n.x=n.y),Ut(Object.assign({},t,{scale:n.scale(t.scale||new P(1)),tex:t.tex,quad:e,width:r,height:s}))}function Pa(t){if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let e=Qt(t.sprite);if(!e||!e.data)return;let r=e.data.frames[t.frame??0];if(!r)throw new Error(`Frame not found: ${t.frame??0}`);or(Object.assign({},t,{tex:e.data.tex,quad:r.scale(t.quad??new se(0,0,1,1))}))}function Ca(t,e){let r=h.gfx.ggl.gl;yn(t,e,r.NOTEQUAL)}function Ps(t){it(nt(t))}var qa=(t,e)=>{let r=ns(e,Dr,Br),s=t.pixelDensity??1,n=t.scale??1,{gl:i}=e,o=Xe.fromImage(e,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),u=t.width&&t.height?new ir(e,t.width*s*n,t.height*s*n):new ir(e,i.drawingBufferWidth,i.drawingBufferHeight),l=null,a=1;t.background&&(typeof t.background=="string"?l=J(t.background):(l=J(...t.background),a=t.background[3]??1),i.clearColor(l.r/255,l.g/255,l.b/255,a??1)),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);let d=new xa(e,$r,Yi,ji),m=Xe.fromImage(e,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:e,defShader:r,defTex:o,frameBuffer:u,postShader:null,postShaderUniform:null,renderer:d,transform:new Ne,transformStack:[],bgTex:m,bgColor:l,bgAlpha:a,width:t.width??i.drawingBufferWidth/s/n,height:t.height??i.drawingBufferHeight/s/n,viewport:{x:0,y:0,width:i.drawingBufferWidth,height:i.drawingBufferHeight,scale:1},fixed:!1}};function tt(t){return t.fixed?!0:t.parent?tt(t.parent):!1}function ot(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}function Ia(t,e={}){return{id:"circle",radius:t,draw(){At(Object.assign(ot(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new ee(new P(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}function wn(...t){return{id:"color",color:J(...t),inspect(){return`color: ${this.color.toString()}`}}}function Ra(t){return{add(){this.canvas=t}}}function Ta(t=1){let e,r=0,s=!1;return{require:["opacity"],add(){e=this.opacity,this.opacity=0},update(){s||(r+=he(),this.opacity=ke(r,0,t,0,e),r>=t&&(this.opacity=e,s=!0))}}}function Oa(t="intersect"){return{id:"mask",mask:t}}function An(t){return{id:"opacity",opacity:t??1,fadeIn(e=1,r=h.k.easings.linear){return h.game.root.tween(0,this.opacity,e,s=>this.opacity=s,r)},fadeOut(e=1,r=h.k.easings.linear){return h.game.root.tween(this.opacity,0,e,s=>this.opacity=s,r)},inspect(){return`opacity: ${kr(this.opacity,1)}`}}}function Da(t=1,e=J(0,0,0),r=1,s="miter",n=10,i="butt"){return{id:"outline",outline:{width:t,color:e,opacity:r,join:s,miterLimit:n,cap:i},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}var Ba=class{pos=E(0);vel=E(0);acc=E(0);angle=0;angularVelocity=0;damping=0;t;lt=null;gc;constructor(){this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function ka(t,e){let r=e.lifetime,s=[],n=t.colors||[X.WHITE],i=t.opacities||[1],o=t.quads||[new se(0,0,1,1)],u=t.scales||[1],l=t.lifeTime,a=e.direction,d=e.spread,m=t.speed||[0,0],c=t.angle||[0,0],f=t.angularVelocity||[0,0],p=t.acceleration||[E(0),E(0)],y=t.damping||[0,0],g=[],x=new Array(t.max),S=0,C=0;for(let A=0;A<t.max;A++){g[A*6+0]=A*4+0,g[A*6+1]=A*4+1,g[A*6+2]=A*4+3,g[A*6+3]=A*4+1,g[A*6+4]=A*4+2,g[A*6+5]=A*4+3;for(let v=0;v<4;v++)x[A*4+v]={pos:new P(0,0),uv:new P(0,0),color:J(255,255,255),opacity:1};s[A]=new Ba}let D=new me;function b(A=0){for(;A<t.max;){if(s[A].gc)return A;A++}return null}return{id:"particles",emit(A){let v=0;for(let q=0;q<A;q++){if(v=b(v),v==null)return;let T=ue(a-d,a+d),R=P.fromAngle(T).scale(ue(m[0],m[1])),O=ue(c[0],c[1]),N=ue(f[0],f[1]),L=E(ue(p[0].x,p[1].x),ue(p[0].y,p[1].y)),K=ue(y[0],y[1]),Y=l?ue(l[0],l[1]):null,k=e.shape?e.shape.random():E(),F=s[v];F.lt=Y,F.pos=k,F.vel=R,F.acc=L,F.angle=O,F.angularVelocity=N,F.damping=K,F.angularVelocity=N,F.gc=!1}S+=A},update(){if(r!==void 0&&r<=0)return;let A=he();for(let v of s)if(!v.gc){if(v.t+=A,v.lt&&v.t>=v.lt){v.gc=!0,S--;continue}v.vel=v.vel.add(v.acc.scale(A)).scale(1-v.damping*A),v.pos=v.pos.add(v.vel.scale(A)),v.angle+=v.angularVelocity*A}for(r!==void 0&&(r-=A,r<=0&&D.trigger()),C+=A;S<t.max&&e.rate&&C>e.rate;)this.emit(1),S++,C-=e.rate},draw(){if(!(r!==void 0&&r<=0)){for(let A=0;A<s.length;A++){let v=s[A];if(v.gc)continue;let q=v.progress,T=Math.floor(v.progress*n.length),R=T<n.length-1?ve(n[T],n[T+1],ke(q,T/n.length,(T+1)/n.length,0,1)):n[T],O=Math.floor(v.progress*i.length),N=O<i.length-1?ve(i[O],i[O+1],ke(q,O/i.length,(O+1)/i.length,0,1)):i[O],L=Math.floor(v.progress*o.length),K=o[L],Y=Math.floor(v.progress*u.length),k=u[Y],F=Math.cos(v.angle*Math.PI/180),_=Math.sin(v.angle*Math.PI/180),W=(t.texture?t.texture.width:10)*K.w/2,Q=(t.texture?t.texture.height:10)*K.h/2,de=A*4,G=x[de];G.pos.x=v.pos.x+-W*k*F- -Q*k*_,G.pos.y=v.pos.y+-W*k*_+-Q*k*F,G.uv.x=K.x,G.uv.y=K.y,G.color.r=R.r,G.color.g=R.g,G.color.b=R.b,G.opacity=N,G=x[de+1],G.pos.x=v.pos.x+W*k*F- -Q*k*_,G.pos.y=v.pos.y+W*k*_+-Q*k*F,G.uv.x=K.x+K.w,G.uv.y=K.y,G.color.r=R.r,G.color.g=R.g,G.color.b=R.b,G.opacity=N,G=x[de+2],G.pos.x=v.pos.x+W*k*F-Q*k*_,G.pos.y=v.pos.y+W*k*_+Q*k*F,G.uv.x=K.x+K.w,G.uv.y=K.y+K.h,G.color.r=R.r,G.color.g=R.g,G.color.b=R.b,G.opacity=N,G=x[de+3],G.pos.x=v.pos.x+-W*k*F-Q*k*_,G.pos.y=v.pos.y+-W*k*_+Q*k*F,G.uv.x=K.x,G.uv.y=K.y+K.h,G.color.r=R.r,G.color.g=R.g,G.color.b=R.b,G.opacity=N}Je(x,g,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(A){return D.add(A)},inspect(){return`count: ${S}/${t.max}`}}}function Fa(t,e={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){We(Object.assign(ot(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new ye(this.pts)},inspect(){return`polygon: ${this.pts.map(r=>`[${r.x},${r.y}]`).join(",")}`}}}function xn(t,e,r){let s;return h.game.root.get("area").forEach(n=>{if(r&&r.some(o=>n.is(o)))return;let i=n.worldArea().raycast(t,e);i&&(s?i.fraction<s.fraction&&(s=i,s.object=n):(s=i,s.object=n))}),s}function vn(t,e,r={}){return{id:"rect",width:t,height:e,radius:r.radius||0,draw(){Ie(Object.assign(ot(this),{width:this.width,height:this.height,radius:this.radius,fill:r.fill}))},renderArea(){return new ee(E(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}function Na(t,e){return{id:"shader",shader:t,...typeof e=="function"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}function Ua(t,e){if(!e.tileWidth||!e.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let r=h.game.root.add([ar(e.pos??E(0))]),s=t.length,n=0,i=null,o=null,u=null,l=null,a=A=>A.x+A.y*n,d=A=>E(Math.floor(A%n),Math.floor(A/n)),m=()=>{i=[];for(let A of r.children)c(A)},c=A=>{let v=a(A.tilePos);i[v]?i[v].push(A):i[v]=[A]},f=A=>{let v=a(A.tilePos);if(i[v]){let q=i[v].indexOf(A);q>=0&&i[v].splice(q,1)}},p=()=>{let A=!1;for(let v of r.children){let q=r.pos2Tile(v.pos);(v.tilePos.x!=q.x||v.tilePos.y!=q.y)&&(A=!0,f(v),v.tilePos.x=q.x,v.tilePos.y=q.y,c(v))}A&&r.trigger("spatialMapChanged")},y=()=>{let A=r.getSpatialMap(),v=r.numRows()*r.numColumns();o?o.length=v:o=new Array(v),o.fill(1,0,v);for(let q=0;q<A.length;q++){let T=A[q];if(T){let R=0;for(let O of T)if(O.isObstacle){R=1/0;break}else R+=O.cost;o[q]=R||1}}},g=()=>{let A=r.getSpatialMap(),v=r.numRows()*r.numColumns();u?u.length=v:u=new Array(v),u.fill(15,0,v);for(let q=0;q<A.length;q++){let T=A[q];if(T){let R=T.length,O=15;for(let N=0;N<R;N++)O|=T[N].edgeMask;u[q]=O}}},x=()=>{let A=r.numRows()*r.numColumns(),v=(T,R)=>{let O=[];for(O.push(T);O.length>0;){let N=O.pop();D(N).forEach(L=>{l[L]<0&&(l[L]=R,O.push(L))})}};l?l.length=A:l=new Array(A),l.fill(-1,0,A);let q=0;for(let T=0;T<o.length;T++){if(l[T]>=0){q++;continue}v(T,q),q++}},S=(A,v)=>o[v],C=(A,v)=>{let q=d(A),T=d(v);return q.dist(T)},D=(A,v)=>{let q=[],T=Math.floor(A%n),R=T>0&&u[A]&1&&o[A-1]!==1/0,O=A>=n&&u[A]&2&&o[A-n]!==1/0,N=T<n-1&&u[A]&4&&o[A+1]!==1/0,L=A<n*s-n-1&&u[A]&8&&o[A+n]!==1/0;return v?(R&&(O&&q.push(A-n-1),q.push(A-1),L&&q.push(A+n-1)),O&&q.push(A-n),N&&(O&&q.push(A-n+1),q.push(A+1),L&&q.push(A+n+1)),L&&q.push(A+n)):(R&&q.push(A-1),O&&q.push(A-n),N&&q.push(A+1),L&&q.push(A+n)),q},b={id:"level",tileWidth(){return e.tileWidth},tileHeight(){return e.tileHeight},spawn(A,...v){let q=E(...v),T=(()=>{if(typeof A=="string"){if(e.tiles[A]){if(typeof e.tiles[A]!="function")throw new Error("Level symbol def must be a function returning a component list");return e.tiles[A](q)}else if(e.wildcardTile)return e.wildcardTile(A,q)}else{if(Array.isArray(A))return A;throw new Error("Expected a symbol or a component list")}})();if(!T)return null;let R=!1,O=!1;for(let L of T)L.id==="tile"&&(O=!0),L.id==="pos"&&(R=!0);R||T.push(ar(this.tile2Pos(q))),O||T.push(Ln());let N=r.add(T);return R&&(N.tilePosOffset=N.pos.clone()),N.tilePos=q,N.transform=Tt(N),i&&(c(N),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),N},numColumns(){return n},numRows(){return s},levelWidth(){return n*this.tileWidth()},levelHeight(){return s*this.tileHeight()},tile2Pos(...A){return E(...A).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...A){let v=E(...A);return E(Math.floor(v.x/this.tileWidth()),Math.floor(v.y/this.tileHeight()))},getSpatialMap(){return i||m(),i},removeFromSpatialMap:f,insertIntoSpatialMap:c,onSpatialMapChanged(A){return this.on("spatialMapChanged",A)},onNavigationMapInvalid(A){return this.on("navigationMapInvalid",A)},getAt(A){i||m();let v=a(A);return i[v]||[]},raycast(A,v){let q=this.toWorld(A),T=this.toWorld(A.add(v)).sub(q),R=1/this.tileWidth(),O=A.scale(R),N=yi(O,v,L=>{let K=this.getAt(L);if(K.some(k=>k.isObstacle))return!0;let Y=null;for(let k of K)if(k.has("area")){let F=k.worldArea().raycast(q,T);F&&(Y?F.fraction<Y.fraction&&(Y=F,Y.object=k):(Y=F,Y.object=k))}return Y&&(Y.point=this.fromWorld(Y.point).scale(R)),Y||!1},64);return N&&(N.point=N.point.scale(this.tileWidth())),N},update(){i&&p()},invalidateNavigationMap(){o=null,u=null,l=null},onNavigationMapChanged(A){return this.on("navigationMapChanged",A)},getTilePath(A,v,q={}){if(o||y(),u||g(),l||x(),A.x<0||A.x>=n||A.y<0||A.y>=s||v.x<0||v.x>=n||v.y<0||v.y>=s)return null;let T=a(A),R=a(v);if(o[R]===1/0)return null;if(T===R)return[];if(l[T]!=-1&&l[T]!==l[R])return null;let O=new Qs((F,_)=>F.cost<_.cost);O.insert({cost:0,node:T});let N=new Map;N.set(T,T);let L=new Map;for(L.set(T,0);O.length!==0;){let F=O.remove()?.node;if(F===R)break;let _=D(F,q.allowDiagonals);for(let W of _){let Q=(L.get(F)||0)+S(F,W)+C(W,R);(!L.has(W)||Q<L.get(W))&&(L.set(W,Q),O.insert({cost:Q,node:W}),N.set(W,F))}}let K=[],Y=R,k=d(Y);for(K.push(k);Y!==T;){let F=N.get(Y);if(F===void 0)throw new Error("Bug in pathfinding algorithm");Y=F;let _=d(Y);K.push(_)}return K.reverse()},getPath(A,v,q={}){let T=this.tileWidth(),R=this.tileHeight(),O=this.getTilePath(this.pos2Tile(A),this.pos2Tile(v),q);return O?[A,...O.slice(1,-1).map(N=>N.scale(T,R).add(T/2,R/2)),v]:null}};return r.use(b),r.onNavigationMapInvalid(()=>{r.invalidateNavigationMap(),r.trigger("navigationMapChanged")}),t.forEach((A,v)=>{let q=A.split("");n=Math.max(q.length,n),q.forEach((T,R)=>{r.spawn(T,E(R,v))})}),r}function Se(t,e,r){return h.game.objEvents.registers[t]||(h.game.objEvents.registers[t]=new Zs),h.game.objEvents.on(t,(s,...n)=>{s.is(e)&&r(s,...n)})}var La=(t,e,...r)=>{for(let s of h.game.root.children)s.is(e)&&s.trigger(t,r)},za=te(t=>{let e=h.game.root.add([{fixedUpdate:t}]);return{get paused(){return e.paused},set paused(r){e.paused=r},cancel:()=>e.destroy()}},(t,e)=>Se("fixedUpdate",t,e)),bn=te(t=>{let e=h.game.root.add([{update:t}]);return{get paused(){return e.paused},set paused(r){e.paused=r},cancel:()=>e.destroy()}},(t,e)=>Se("update",t,e)),Ka=te(t=>{let e=h.game.root.add([{draw:t}]);return{get paused(){return e.hidden},set paused(r){e.hidden=r},cancel:()=>e.destroy()}},(t,e)=>Se("draw",t,e)),En=te(t=>h.game.events.on("add",t),(t,e)=>Se("add",t,e)),Ga=te(t=>h.game.events.on("destroy",t),(t,e)=>Se("destroy",t,e)),Ha=te(t=>h.game.events.on("use",t),(t,e)=>Se("use",t,e)),Ya=te(t=>h.game.events.on("unuse",t),(t,e)=>Se("unuse",t,e)),Sn=te(t=>h.game.events.on("tag",t),(t,e)=>Se("tag",t,e)),ja=te(t=>h.game.events.on("untag",t),(t,e)=>Se("untag",t,e));function Wa(t,e,r){return Se("collide",t,(s,n,i)=>n.is(e)&&r(s,n,i))}function Xa(t,e,r){return Se("collideUpdate",t,(s,n,i)=>n.is(e)&&r(s,n,i))}function Va(t,e,r){return Se("collideEnd",t,(s,n,i)=>n.is(e)&&r(s,n,i))}function gr(t,e){h.game.root.get(t,{recursive:!0}).forEach(e),En(t,e),Sn((r,s)=>{s===t&&e(r)})}var Za=te(t=>h.app.onMousePress(t),(t,e)=>{let r=[];return gr(t,s=>{if(!s.area)throw new Error("onClick() requires the object to have area() component");r.push(s.onClick(()=>e(s)))}),at.join(r)});function Ja(t,e){let r=[];return gr(t,s=>{if(!s.area)throw new Error("onHover() requires the object to have area() component");r.push(s.onHover(()=>e(s)))}),at.join(r)}function Qa(t,e){let r=[];return gr(t,s=>{if(!s.area)throw new Error("onHoverUpdate() requires the object to have area() component");r.push(s.onHoverUpdate(()=>e(s)))}),at.join(r)}function _a(t,e){let r=[];return gr(t,s=>{if(!s.area)throw new Error("onHoverEnd() requires the object to have area() component");r.push(s.onHoverEnd(()=>e(s)))}),at.join(r)}function $a(t){h.game.events.on("loading",t)}function el(t){h.app.onResize(t)}function tl(t){h.game.events.on("error",t)}function os(t){h.assets.loaded?t():h.game.events.on("load",t)}function rl(t){if(h.assets.loaded)sn().forEach(e=>t(...e));else return h.game.events.on("loadError",t)}function Mn(...t){h.game.cam.pos=E(...t)}function Pn(){return h.game.cam.pos?h.game.cam.pos.clone():nr()}function Cn(...t){h.game.cam.scale=E(...t)}function qn(){return h.game.cam.scale.clone()}function In(t){h.game.cam.angle=t}function Rn(){return h.game.cam.angle}function sl(){return h.game.cam.transform.clone()}function Tn(t=J(255,255,255),e=1){let r=h.game.root.add([vn(pe(),fe()),wn(t),An(1),Gn()]),s=r.fadeOut(e);return s.onEnd(()=>Un(r)),s}function nl(){return h.game.cam.transform.clone()}function il(t=12){h.game.cam.shake+=t}function Kr(t){return h.game.cam.transform.multVec2(t)}function On(t){return h.game.cam.transform.invert().multVec2(t)}function ol(...t){return yt("camPos","setCamPos / getCamPos"),t.length>0&&Mn(...t),Pn()}function al(...t){return yt("camScale","setCamScale / getCamScale"),t.length>0&&Cn(...t),qn()}function ll(t){return yt("camRot","setCamRot / getCamRot"),t!==void 0&&In(t),Rn()}function cl(t=J(255,255,255),e=1){return yt("camFlash","flash"),Tn(t,e)}function as(t=[]){let e=new Map,r=[],s={},n=new Bt,i=[],o=new Set("*"),u=h.globalOpt.tagsAsComponents,l=null,a=!1,d={id:xo(),hidden:!1,transform:new Ne,children:[],parent:null,set paused(c){if(c!==a){a=c;for(let f of i)f.paused=c}},get paused(){return a},get tags(){return Array.from(o)},add(c){let f=Array.isArray(c)?as(c):c;if(f.parent)throw new Error("Cannot add a game obj that already has a parent.");return f.parent=this,f.transform=Tt(f),this.children.push(f),f.trigger("add",f),h.game.events.trigger("add",f),f},readd(c){let f=this.children.indexOf(c);return f!==-1&&(this.children.splice(f,1),this.children.push(c)),c},remove(c){let f=this.children.indexOf(c);if(f!==-1){c.parent=null,this.children.splice(f,1);let p=y=>{y.trigger("destroy"),h.game.events.trigger("destroy",y),y.children.forEach(g=>p(g))};p(c)}},removeAll(c){if(c)this.get(c).forEach(f=>this.remove(f));else for(let f of[...this.children])this.remove(f)},fixedUpdate(){this.paused||(this.children.forEach(c=>c.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(c=>c.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(qe(),this.canvas.bind());let c=h.gfx.fixed;this.fixed&&(h.gfx.fixed=!0),Ce(),ne(this.pos),Ft(this.scale),mt(this.angle);let f=this.children.sort((p,y)=>{let g=p.layerIndex??h.game.defaultLayerIndex,x=y.layerIndex??h.game.defaultLayerIndex;return g-x||(p.z??0)-(y.z??0)});if(this.mask){let p={intersect:h.k.drawMasked,subtract:h.k.drawSubtracted}[this.mask];if(!p)throw new Error(`Invalid mask func: "${this.mask}"`);p(()=>{f.forEach(y=>y.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),f.forEach(p=>p.draw());xe(),h.gfx.fixed=c,this.canvas&&(qe(),this.canvas.unbind())},drawInspect(){this.hidden||(Ce(),ne(this.pos),Ft(this.scale),mt(this.angle),this.children.forEach(c=>c.drawInspect()),this.trigger("drawInspect"),xe())},use(c){if(typeof c=="string")return o.add(c);if(!c||typeof c!="object")throw new Error(`You can only pass a component or a string to .use(), you passed a "${typeof c}"`);let f=[];c.id?(this.unuse(c.id),s[c.id]=[],f=s[c.id],e.set(c.id,c),u&&o.add(c.id)):r.push(c);for(let y in c){if(Vi.has(y))continue;let g=Object.getOwnPropertyDescriptor(c,y);if(g)if(typeof g.value=="function"&&(c[y]=c[y].bind(this)),g.set&&Object.defineProperty(c,y,{set:g.set.bind(this)}),g.get&&Object.defineProperty(c,y,{get:g.get.bind(this)}),Zi.has(y)){let x=y==="add"?()=>{l=S=>f.push(S),c[y]?.(),l=null}:c[y];f.push(this.on(y,x).cancel)}else if(this[y]===void 0)Object.defineProperty(this,y,{get:()=>c[y],set:x=>c[y]=x,configurable:!0,enumerable:!0}),f.push(()=>delete this[y]);else{let x=e.values().find(S=>S[y]!==void 0)?.id;throw new Error(`Duplicate component property: "${y}" while adding component "${c.id}"`+(x?` (originally added by "${x}")`:""))}}let p=()=>{if(c.require){for(let y of c.require)if(!this.c(y))throw new Error(`Component "${c.id}" requires component "${y}"`)}};c.destroy&&f.push(c.destroy.bind(this)),this.exists()?(p(),c.add&&(l=y=>f.push(y),c.add.call(this),l=null),c.id&&(this.trigger("use",c.id),h.game.events.trigger("use",this,c.id))):c.require&&f.push(this.on("add",p).cancel)},unuse(c){if(e.has(c)){for(let f of e.values())if(f.require&&f.require.includes(c))throw new Error(`Can't unuse. Component "${f.id}" requires component "${c}"`);e.delete(c),this.trigger("unuse",c),h.game.events.trigger("unuse",this,c)}else u&&o.has(c)&&o.delete(c);s[c]&&(s[c].forEach(f=>f()),delete s[c])},c(c){return e.get(c)??null},get(c,f={}){let p=(g,x)=>f.only==="comps"?g.has(x):f.only==="tags"?g.is(x):g.is(x)||g.has(x),y=f.recursive?this.children.flatMap(function g(x){return[x,...x.children.flatMap(g)]}):this.children;if(y=y.filter(g=>c?p(g,c):!0),f.liveUpdate){let g=S=>f.recursive?this.isAncestorOf(S):S.parent===this,x=[];x.push(h.k.onAdd(S=>{g(S)&&p(S,c)&&y.push(S)})),x.push(h.k.onDestroy(S=>{if(g(S)&&p(S,c)){let C=y.findIndex(D=>D.id===S.id);C!==-1&&y.splice(C,1)}})),this.onDestroy(()=>{for(let S of x)S.cancel()})}return y},query(c){let f=c.hierarchy||"children",p=c.include,y=c.exclude,g=[];switch(f){case"children":g=this.children;break;case"siblings":g=this.parent?this.parent.children.filter(S=>S!==this):[];break;case"ancestors":let x=this.parent;for(;x;)g.push(x),x=x.parent;break;case"descendants":g=this.children.flatMap(function S(C){return[C,...C.children.flatMap(S)]});break}if(p&&((c.includeOp||"and")==="and"||!Array.isArray(c.include)?g=g.filter(x=>x.is(p)):g=g.filter(x=>c.include.some(S=>x.is(S)))),y&&((c.includeOp||"and")==="and"||!Array.isArray(c.include)?g=g.filter(x=>!x.is(y)):g=g.filter(x=>!c.exclude.some(S=>x.is(S)))),c.visible===!0&&(g=g.filter(x=>x.visible)),c.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let x=c.distanceOp||"near",S=c.distance*c.distance;x==="near"?g=g.filter(C=>C.pos&&this.pos.sdist(C.pos)<=S):g=g.filter(C=>C.pos&&this.pos.sdist(C.pos)>S)}return c.name&&(g=g.filter(x=>x.name===c.name)),g},isAncestorOf(c){return c.parent?c.parent===this||this.isAncestorOf(c.parent):!1},exists(){return h.game.root.isAncestorOf(this)},is(c,f="and"){return Array.isArray(c)?f==="and"?c.every(p=>o.has(p)):c.some(p=>o.has(p)):o.has(c)},tag(c){if(Array.isArray(c))for(let f of c)o.add(f),this.trigger("tag",f),h.game.events.trigger("tag",this,f);else o.add(c),this.trigger("tag",c),h.game.events.trigger("tag",this,c)},untag(c){if(Array.isArray(c))for(let f of c)o.delete(f),this.trigger("untag",f),h.game.events.trigger("untag",this,f);else o.delete(c),this.trigger("untag",c),h.game.events.trigger("untag",this,c)},has(c,f="and"){return Array.isArray(c)?f==="and"?c.every(p=>e.has(p)):c.some(p=>e.has(p)):e.has(c)},on(c,f){let p=n.on(c,f.bind(this));return l&&l(()=>p.cancel()),p},trigger(c,...f){n.trigger(c,...f),h.game.objEvents.trigger(c,this,...f)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let c={};for(let[f,p]of e)c[f]=p.inspect?.()??null;for(let[f,p]of r.entries()){if(p.inspect){c[f]=p.inspect();continue}for(let[y,g]of Object.entries(p))typeof g!="function"&&(c[y]=`${y}: ${g}`)}return c},onAdd(c){return this.on("add",c)},onFixedUpdate(c){return this.on("fixedUpdate",c)},onUpdate(c){return this.on("update",c)},onDraw(c){return this.on("draw",c)},onDestroy(c){return this.on("destroy",c)},onUse(c){return this.on("use",c)},onUnuse(c){return this.on("unuse",c)},clearEvents(){n.clear()}},m=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let c of m)d[c]=(...f)=>{let p=h.app[c]?.(...f);return i.push(p),d.onDestroy(()=>p.cancel()),d.on("sceneEnter",()=>{i.splice(i.indexOf(p),1);let y=h.app[c]?.(...f);at.replace(p,y),i.push(p)}),p};for(let c of t)d.use(c);return d}var ul=()=>({events:new Bt,objEvents:new Bt,root:as([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new P(1),angle:0,shake:0,transform:new Ne}});function hl(t){h.game.gravity=t?(h.game.gravity||E(0,1)).unit().scale(t):null}function dl(){return h.game.gravity?h.game.gravity.len():0}function pl(t){h.game.gravity=t.unit().scale(h.game.gravity?h.game.gravity.len():1)}function Dt(){return h.game.gravity?h.game.gravity.unit():E(0,1)}var fl=Vn("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"),gl=()=>(()=>{let t=new(window.AudioContext||window.webkitAudioContext),e=t.createGain();e.connect(t.destination);let r=new Nt(Lo(t));return t.decodeAudioData(fl.buffer.slice(0)).then(s=>{r.buf=s}).catch(s=>{console.error("Failed to load burp: ",s)}),{ctx:t,masterNode:e,burpSnd:r}})();function ml(t,e={}){let r=new me,s=new Audio(t);s.crossOrigin="anonymous",s.loop=!!e.loop,h.audio.ctx.createMediaElementSource(s).connect(h.audio.masterNode);function n(){h.debug.paused||h.app.isHidden()&&!h.globalOpt.backgroundAudio||h.audio.ctx.resume()}function i(){n(),s.play()}return e.paused||i(),s.onended=()=>r.trigger(),{play(){i()},seek(o){s.currentTime=o},stop(){s.pause(),this.seek(0)},set loop(o){s.loop=o},get loop(){return s.loop},set paused(o){o?s.pause():i()},get paused(){return s.paused},time(){return s.currentTime},duration(){return s.duration},set volume(o){s.volume=Fe(o,0,1)},get volume(){return s.volume},set speed(o){s.playbackRate=Math.max(o,0)},get speed(){return s.playbackRate},set detune(o){},get detune(){return 0},onEnd(o){return r.add(o)},then(o){return this.onEnd(o)}}}function yl(t,e={}){if(typeof t=="string"&&h.assets.music[t])return ml(h.assets.music[t],e);let r=h.audio.ctx,s=e.paused??!1,n=r.createBufferSource(),i=new me,o=r.createGain(),u=r.createStereoPanner(),l=e.seek??0,a=0,d=0,m=!1;n.loop=!!e.loop,n.detune.value=e.detune??0,n.playbackRate.value=e.speed??1,n.connect(u),n.onended=()=>{p()>=(n.buffer?.duration??Number.POSITIVE_INFINITY)&&i.trigger()},u.pan.value=e.pan??0,u.connect(o),o.connect(h.audio.masterNode),o.gain.value=e.volume??1;let c=g=>{n.buffer=g.buf,s||(a=r.currentTime,n.start(0,l),m=!0)},f=pa(t);f instanceof Te&&f.onLoad(c);let p=()=>{if(!n.buffer)return 0;let g=s?d-a:r.currentTime-a,x=n.buffer.duration;return n.loop?g%x:Math.min(g,x)},y=g=>{let x=r.createBufferSource();return x.buffer=g.buffer,x.loop=g.loop,x.playbackRate.value=g.playbackRate.value,x.detune.value=g.detune.value,x.onended=g.onended,x.connect(u),x};return{stop(){this.paused=!0,this.seek(0)},set paused(g){if(s!==g)if(s=g,g)m&&(n.stop(),m=!1),d=r.currentTime;else{n=y(n);let x=d-a;n.start(0,x),m=!0,a=r.currentTime-x,d=0}},get paused(){return s},play(g=0){this.seek(g),this.paused=!1},seek(g){n.buffer?.duration&&(g>n.buffer.duration||(s?(n=y(n),a=d-g):(n.stop(),n=y(n),a=r.currentTime-g,n.start(0,g),m=!0,d=0)))},set speed(g){n.playbackRate.value=g},get speed(){return n.playbackRate.value},set detune(g){n.detune.value=g},get detune(){return n.detune.value},set volume(g){o.gain.value=Math.max(g,0)},get volume(){return o.gain.value},set pan(g){u.pan.value=g},get pan(){return u.pan.value},set loop(g){n.loop=g},get loop(){return n.loop},duration(){return n.buffer?.duration??0},time(){return p()%this.duration()},onEnd(g){return i.add(g)},then(g){return this.onEnd(g)}}}function Dn(t){return h.k.play(h.audio.burpSnd,t)}function Bn(t){h.audio.masterNode.gain.value=t}function kn(){return h.audio.masterNode.gain.value}function wl(t){return yt("volume","setVolume / getVolume"),t!==void 0&&Bn(t),kn()}function Fn(){h.app.onHide(()=>{h.globalOpt.backgroundAudio||h.audio.ctx.suspend()}),h.app.onShow(()=>{!h.globalOpt.backgroundAudio&&!h.debug.paused&&h.audio.ctx.resume()}),h.app.onResize(()=>{if(h.app.isFullscreen())return;let t=h.globalOpt.width&&h.globalOpt.height;t&&!h.globalOpt.stretch&&!h.globalOpt.letterbox||(h.canvas.width=h.canvas.offsetWidth*h.pixelDensity,h.canvas.height=h.canvas.offsetHeight*h.pixelDensity,en(),t||(h.gfx.frameBuffer.free(),h.gfx.frameBuffer=new ir(h.gfx.ggl,h.gfx.ggl.gl.drawingBufferWidth,h.gfx.ggl.gl.drawingBufferHeight),h.gfx.width=h.gfx.ggl.gl.drawingBufferWidth/h.pixelDensity/h.gscale,h.gfx.height=h.gfx.ggl.gl.drawingBufferHeight/h.pixelDensity/h.gscale))}),h.globalOpt.debug!==!1&&(h.app.onKeyPress(h.globalOpt.debugKey??"f1",()=>h.debug.inspect=!h.debug.inspect),h.app.onKeyPress("f2",()=>h.debug.clearLog()),h.app.onKeyPress("f8",()=>h.debug.paused=!h.debug.paused),h.app.onKeyPress("f7",()=>{h.debug.timeScale=kr(Fe(h.debug.timeScale-.2,0,2),1)}),h.app.onKeyPress("f9",()=>{h.debug.timeScale=kr(Fe(h.debug.timeScale+.2,0,2),1)}),h.app.onKeyPress("f10",()=>h.debug.stepFrame())),h.globalOpt.burp&&h.app.onKeyPress("b",()=>Dn())}function Al(t,e={}){let r=h.game.root.add([ar(t),Kn()]),s=(e.speed||1)*5,n=e.scale||1;r.add([Gr(h.boomSprite),lr(0),jr("center"),qs(s,n),...e.comps??[]]);let i=r.add([Gr(h.kaSprite),lr(0),jr("center"),Hr(),...e.comps??[]]);return i.wait(.4/s,()=>i.use(qs(s,n))),i.onDestroy(()=>r.destroy()),r}function Nn(t,e){if(h.game.layers)throw Error("Layers can only be assigned once.");let r=t.indexOf(e);if(r==-1)throw Error("The default layer name should be present in the layers list.");h.game.layers=t,h.game.defaultLayerIndex=r}function xl(){return h.game.layers}function vl(){return h.game.layers?.[h.game.defaultLayerIndex]??null}function bl(t,e){yt("layers","setLayers"),Nn(t,e)}function Un(t){t.destroy()}function El(){return h.game.root}function Sl(t,e){h.game.scenes[t]=e}function Ml(t,...e){if(!h.game.scenes[t])throw new Error(`Scene not found: ${t}`);h.game.events.onOnce("frameEnd",()=>{h.game.events.trigger("sceneLeave",t),h.app.events.clear(),h.game.events.clear(),h.game.objEvents.clear(),[...h.game.root.children].forEach(r=>{!r.stay||r.scenesToStay&&!r.scenesToStay.includes(t)?h.game.root.remove(r):r.trigger("sceneEnter",t)}),h.game.root.clearEvents(),Fn(),h.game.cam={pos:null,scale:E(1),angle:0,shake:0,transform:new Ne},h.game.scenes[t](...e)}),h.game.currentScene=t}function Pl(t){return h.game.events.on("sceneLeave",t)}function Cl(){return h.game.currentScene}function Gr(t,e={}){let r=null,s=null,n=null,i=new me;if(!t)throw new Error("Please pass the resource name or data to sprite()");let o=(a,d,m,c)=>{let f=E(1,1);return m&&c?(f.x=m/(a.width*d.w),f.y=c/(a.height*d.h)):m?(f.x=m/(a.width*d.w),f.y=f.x):c&&(f.y=c/(a.height*d.h),f.x=f.y),f},u=(a,d)=>{if(!d)return;let m=d.frames[0].clone();e.quad&&(m=m.scale(e.quad));let c=o(d.tex,m,e.width,e.height);if(a.width=d.tex.width*m.w*c.x,a.height=d.tex.height*m.h*c.y,d.anims)for(let f in d.anims){let p=d.anims[f];typeof p!="number"&&(p.frames=l(p))}r=d,i.trigger(r),e.anim&&a.play(e.anim)},l=a=>{if(a.frames)return a.frames;let d=[];if(a.from===void 0||a.to===void 0)throw new Error("Sprite anim 'from' and 'to' must be defined if 'frames' is not defined");let m=Math.abs(a.to-a.from)+1;for(let c=0;c<m;c++)d.push(a.from+c*Math.sign(a.to-a.from));if(a.pingpong)for(let c=m-2;c>0;c--)d.push(d[c]);return d};return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new se(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},set sprite(a){let d=Qt(a);d&&d.onLoad(m=>u(this,m))},get animFrame(){if(!r||!s||n===null)return this.frame;let a=r.anims[s.name];return typeof a=="number"?a:a.from===void 0||a.to===void 0?s.frameIndex:this.frame-Math.min(a.from,a.to)},draw(){if(!r)return;let a=r.frames[this.frame??0];if(!a)throw new Error(`Frame not found: ${this.frame??0}`);if(r.slice9){let{left:d,right:m,top:c,bottom:f}=r.slice9,p=r.tex.width*a.w,y=r.tex.height*a.h,g=this.width-d-m,x=this.height-c-f,S=d/p,C=m/p,D=1-S-C,b=c/y,A=f/y,v=1-b-A,q=[oe(0,0,S,b),oe(S,0,D,b),oe(S+D,0,C,b),oe(0,b,S,v),oe(S,b,D,v),oe(S+D,b,C,v),oe(0,b+v,S,A),oe(S,b+v,D,A),oe(S+D,b+v,C,A),oe(0,0,d,c),oe(d,0,g,c),oe(d+g,0,m,c),oe(0,c,d,x),oe(d,c,g,x),oe(d+g,c,m,x),oe(0,c+x,d,f),oe(d,c+x,g,f),oe(d+g,c+x,m,f)];for(let T=0;T<9;T++){let R=q[T],O=q[T+9];or(Object.assign(ot(this),{pos:O.pos(),tex:r.tex,quad:a.scale(R),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:O.w,height:O.h}))}}else or(Object.assign(ot(this),{tex:r.tex,quad:a.scale(this.quad??new se(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let a=Qt(t);a?a.onLoad(d=>u(this,d)):os(()=>u(this,Qt(t).data))},update(){if(!r||!s||n===null)return;let a=r.anims[s.name];if(typeof a=="number"){this.frame=a;return}if(a.speed===0)throw new Error("Sprite anim speed cannot be 0");if(s.timer+=he()*this.animSpeed,s.timer>=1/s.speed){s.timer=0,s.frameIndex+=n;let d=a.frames;if(s.frameIndex>=d.length)if(s.pingpong&&!a.pingpong)n=-1,s.frameIndex=d.length-2;else if(s.loop)s.frameIndex=0;else{this.frame=d.at(-1),s.onEnd(),this.stop();return}else if(s.frameIndex<0)if(s.pingpong&&s.loop)n=1,s.frameIndex=1;else if(s.loop)s.frameIndex=d.length-1;else{this.frame=d[0],s.onEnd(),this.stop();return}this.frame=d[s.frameIndex]}},play(a,d={}){if(!r){i.add(()=>this.play(a,d));return}let m=r.anims[a];if(m===void 0)throw new Error(`Anim not found: ${a}`);s&&this.stop(),s=typeof m=="number"?{name:a,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:()=>{}}:{name:a,timer:0,loop:d.loop??m.loop??!1,pingpong:d.pingpong??m.pingpong??!1,speed:d.speed??m.speed??10,frameIndex:0,onEnd:d.onEnd??(()=>{})},n=typeof m=="number"?null:1,this.frame=typeof m=="number"?m:m.frames[0],this.trigger("animStart",a)},stop(){if(!s)return;let a=s.name;s=null,this.trigger("animEnd",a)},numFrames(){return r?.frames.length??0},getCurAnim(){return s},curAnim(){return s?.name},getAnim(a){return r?.anims[a]??null},hasAnim(a){return!!this.getAnim(a)},onAnimEnd(a){return this.on("animEnd",a)},onAnimStart(a){return this.on("animStart",a)},renderArea(){return new ee(E(0),this.width,this.height)},inspect(){return typeof t=="string"?`sprite: "${t}"`:null}}}function ql(t,e={}){function r(n){let i=nt(Object.assign(ot(n),{text:n.text+"",size:n.textSize,font:n.font,width:e.width&&n.width,align:n.align,letterSpacing:n.letterSpacing,lineSpacing:n.lineSpacing,transform:n.textTransform,styles:n.textStyles,indentAll:e.indentAll}));return e.width||(n.width=i.width/(n.scale?.x||1)),n.height=i.height/(n.scale?.y||1),i}let s={id:"text",set text(n){t=n,r(this),this.renderedText=Lr(t).text},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,renderedText:t?Lr(t).text:"",add(){os(()=>r(this))},draw(){it(r(this))},renderArea(){return new ee(E(0),this.width,this.height)}};return r(s),s}function Il(t,e){return{id:"rect",width:t,height:e,draw(){Ut(Object.assign(ot(this),{width:this.width,height:this.height}))},renderArea(){return new ee(E(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}function Rl(t={}){let e=null,r=null,s=null,n=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return r&&s?r[s]:null},getPath(){return r?r.slice():null},getTarget(){return e},isNavigationFinished(){return r?s===null:!0},isTargetReachable(){return r!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(i){e=i,r=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),s=r?0:null,r&&s!==null?(n||(n=this.getLevel().onNavigationMapChanged(()=>{e&&r&&s!==null&&(r=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),r?(s=0,this.trigger("navigationNext",this,r[s])):(s=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>n?.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,r[s])):this.trigger("navigationEnded",this)},update(){if(e&&r&&s!==null){if(this.pos.sdist(r[s])<2)if(s===r.length-1){this.pos=e.clone(),s=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else s++,this.trigger("navigationNext",this,r[s]);this.moveTo(r[s],this.agentSpeed)}},onNavigationStarted(i){return this.on("navigationStarted",i)},onNavigationNext(i){return this.on("navigationNext",i)},onNavigationEnded(i){return this.on("navigationEnded",i)},onTargetReached(i){return this.on("targetReached",i)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(r)})}}}function Tl(t){let e=t.graph;return{id:"pathfinder",require:["pos"],navigateTo(r){return this.graph?.getWaypointPath(this.pos,r,t.navigationOpt)},get graph(){if(e)return e;let r=this.parent;for(;r;){if(r.has("pathfinderMap"))return r.graph;r=r.parent}},set graph(r){e=r}}}function Ol(t={}){let e=t.waypoints,r=t.speed||100,s=t.endBehavior||"stop",n=0,i=e!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return r},set patrolSpeed(o){r=o},get waypoints(){return e},set waypoints(o){e=o,n=0,i=!1},get nextLocation(){return e?e[n]:void 0},update(){let o=this.nextLocation;if(!(!e||!o||i)&&(this.moveTo(o,r),this.pos.sdist(o)<9))switch(s){case"loop":n=(n+1)%e.length;break;case"ping-pong":n=n+1,n==e.length&&(e.reverse(),n=0);break;case"stop":n<e.length-1?n+=1:i||(i=!0,this.trigger("patrolFinished",this));break}},onPatrolFinished(o){return this.on("patrolFinished",o)}}}function Dl(t,e={}){let r=typeof t=="function"?t:()=>h.game.root.query(t),s=e.checkFrequency||1,n=typeof e.direction=="number"?P.fromAngle(e.direction):e.direction,i=0;return{id:"sentry",require:["pos"],direction:typeof e.direction=="number"?P.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(o){this.direction=o!==void 0?P.fromAngle(o):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(o,u,l){let a=(typeof u=="number"?P.fromAngle(u):u)||n,d=l||e.fieldOfView;if(!a||!d||d>=360)return!0;let m=d/2;return o.pos&&a.angleBetween(o.pos.sub(this.pos))<=m},hasLineOfSight(o){let u=xn(this.pos,o.pos.sub(this.pos),e.raycastExclude);return u!=null&&u.object===o},update(){if(i+=he(),i>s){i-=s;let o=r();if(o.length&&n&&this.fieldOfView&&this.fieldOfView<360){let u=this.fieldOfView/2;o=o.filter(l=>l.pos&&n.angleBetween(l.pos.sub(this.pos))<=u)}o.length&&e.lineOfSight&&(o=o.filter(u=>u.pos&&this.hasLineOfSight(u))),o.length>0&&(this.spotted=o,this.trigger("objectSpotted",o))}},onObjectsSpotted(o){return this.on("objectSpotted",o)}}}function Ln(t={}){let e=E(0),r=t.isObstacle??!1,s=t.cost??0,n=t.edges??[],i=()=>{let u={left:1,top:2,right:4,bottom:8};return n.map(l=>u[l]||0).reduce((l,a)=>l|a,0)},o=i();return{id:"tile",tilePosOffset:t.offset??E(0),set tilePos(u){let l=this.getLevel();e=u.clone(),this.pos=E(this.tilePos.x*l.tileWidth(),this.tilePos.y*l.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(u){r!==u&&(r=u,this.getLevel().invalidateNavigationMap())},get isObstacle(){return r},set cost(u){s!==u&&(s=u,this.getLevel().invalidateNavigationMap())},get cost(){return s},set edges(u){n=u,o=i(),this.getLevel().invalidateNavigationMap()},get edges(){return n},get edgeMask(){return o},getLevel(){return this.parent},tileMove(u){let l=this.getLevel();l.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(u),l.insertIntoSpatialMap(this),l.trigger("spatialMapChanged")},moveLeft(){this.tileMove(E(-1,0))},moveRight(){this.tileMove(E(1,0))},moveUp(){this.tileMove(E(0,-1))},moveDown(){this.tileMove(E(0,1))}}}var ls=class{name;duration;loops;direction;easing;interpolation;isFinished;timing;easings;relative;constructor(t,e,r){this.name=t,this.duration=e.duration,this.loops=e.loops||0,this.direction=e.direction||"forward",this.easing=e.easing||kt.linear,this.interpolation=e.interpolation||"linear",this.isFinished=!1,this.timing=e.timing,this.easings=e.easings,this.relative=r}update(t,e){return!0}getLowerKeyIndexAndRelativeTime(t,e,r){let s=e-1,n=t/this.duration;if(this.loops!==0&&n>=this.loops)return[s,0,!0];let i=Math.trunc(n);if(n-=i,(this.direction=="reverse"||this.direction=="ping-pong"&&i&1)&&(n=1-n),r){let o=0;for(;r[o+1]!==void 0&&r[o+1]<n;)o++;return o>=s?[s,0,!0]:[o,(n-r[o])/(r[o+1]-r[o]),!1]}else{let o=Math.floor((e-1)*n);return[o,(n-o/s)*s,!1]}}setValue(t,e,r){if(this.relative)switch(e){case"pos":t.pos=t.base.pos.add(r);break;case"angle":t.angle=t.base.angle+r;break;case"scale":t.scale=t.base.scale.scale(r);break;case"opacity":t.opacity=t.base.opacity*r;break;default:t[e]=r}else t[e]=r}serialize(){let t={duration:this.duration,keys:[]};return this.loops&&(t.loops=this.loops),this.direction!=="forward"&&(t.direction=this.direction),this.easing!=kt.linear&&(t.easing=this.easing.name),this.interpolation!=="linear"&&(t.interpolation=this.interpolation),this.timing&&(t.timing=this.timing),this.easings&&(t.easings=this.easings.map(e=>this.easing.name)),t}};function Cs(t,e){return e.add(e.sub(t))}var Bl=class extends ls{keys;constructor(t,e,r,s){super(t,r,s),this.keys=e}update(t,e){let[r,s,n]=this.getLowerKeyIndexAndRelativeTime(e,this.keys.length,this.timing);if(s==0||this.interpolation==="none")this.setValue(t,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;this.setValue(t,this.name,ve(this.keys[r],this.keys[r+1],i(s)))}return n}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},kl=class extends ls{keys;curves;dcurves;constructor(e,r,s,n,i){if(super(e,s,n),this.keys=r,this.interpolation==="spline"){this.curves=[],i&&(this.dcurves=[]);for(let o=0;o<this.keys.length-1;o++){let u=this.keys[o],l=o+1,a=this.keys[l],d=o>0?this.keys[o-1]:Cs(a,u),m=l<this.keys.length-1?this.keys[l+1]:Cs(u,a);this.curves.push(rr(d,u,a,m)),i&&this.dcurves?.push(rr(d,u,a,m,Ri))}}}update(e,r){let[s,n,i]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[s]);else{let o=this.easings?this.easings[s]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],o(n)));break;case"slerp":this.setValue(e,this.name,this.keys[s].slerp(this.keys[s+1],o(n)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[s](o(n))),this.dcurves&&this.setValue(e,"angle",this.dcurves[s](o(n)).angle());break}}}return i}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},Fl=class extends ls{keys;constructor(t,e,r,s){super(t,r,s),this.keys=e}update(t,e){let[r,s,n]=this.getLowerKeyIndexAndRelativeTime(e,this.keys.length,this.timing);if(s==0||this.interpolation=="none")this.setValue(t,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;this.setValue(t,this.name,this.keys[r].lerp(this.keys[r+1],i(s)))}return n}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}};function Nl(t={}){let e=[],r=0,s=!1;return{id:"animate",require:t.followMotion?["rotate"]:void 0,base:{pos:E(0,0),angle:0,scale:E(1,1),opacity:1},animation:{paused:!1,seek(n){r=Fe(n,0,this.duration),e.forEach(i=>{i.isFinished=!1}),s=!1},get duration(){return e.reduce((n,i)=>Math.max(i.duration,n),0)}},add(){t.relative&&(this.has("pos")&&(this.base.pos=this.pos.clone()),this.has("rotate")&&(this.base.angle=this.angle),this.has("scale")&&(this.base.scale=this.scale),this.has("opacity")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let n=!0,i;r+=he();for(let o of e)i=o.update(this,r),i&&!o.isFinished&&(o.isFinished=!0,this.trigger("animateChannelFinished",o.name)),n&&=i;n&&!s&&(s=!0,this.trigger("animateFinished"))},animate(n,i,o){s=!1,this.unanimate(n),typeof i[0]=="number"?e.push(new Bl(n,i,o,t.relative||!1)):i[0]instanceof P?e.push(new kl(n,i,o,t.relative||!1,n==="pos"&&(t.followMotion||!1))):i[0]instanceof X&&e.push(new Fl(n,i,o,t.relative||!1))},unanimate(n){let i=e.findIndex(o=>o.name===n);i>=0&&e.splice(i,1)},unanimateAll(){e.splice(0,e.length)},onAnimateFinished(n){return this.on("animateFinished",n)},onAnimateChannelFinished(n){return this.on("animateChannelFinished",n)},serializeAnimationChannels(){return e.reduce((n,i)=>(n[i.name]=i.serialize(),n),{})},serializeAnimationOptions(){let n={};return t.followMotion&&(n.followMotion=!0),t.relative&&(n.relative=!0),n}}}function zn(t,e){let r={name:t.name};return t.has("animate")&&(r.channels=t.serializeAnimationChannels(),Object.assign(r,t.serializeAnimationOptions())),t.children.length>0&&(r.children=t.children.filter(s=>s.has("named")).map(s=>zn(s,s.name))),r}function qs(t=2,e=1){let r=0;return{require:["scale"],update(){let s=Math.sin(r*t)*e;s<0&&this.destroy(),this.scale=E(s),r+=he()}}}function Ul(t,e){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(r=1){this.setHP(t-r),this.trigger("hurt",r)},heal(r=1){let s=t;this.setHP(t+r),this.trigger("heal",t-s)},hp(){return t},maxHP(){return e??null},setMaxHP(r){e=r},setHP(r){t=e?Math.min(e,r):r,t<=0&&this.trigger("death")},onHurt(r){return this.on("hurt",r)},onHeal(r){return this.on("heal",r)},onDeath(r){return this.on("death",r)},inspect(){return`health: ${t}`}}}function Ll(t,e={}){if(t==null)throw new Error("lifespan() requires time");let r=e.fade??0;return{id:"lifespan",require:["opacity"],add(){h.game.root.wait(t,()=>{this.opacity=this.opacity??1,r>0?h.game.root.tween(this.opacity,0,r,s=>this.opacity=s,kt.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}function zl(t){return{id:"named",name:t}}function Kl(t,e,r){if(!t)throw new Error("state() requires an initial state");let s={};function n(l){s[l]||(s[l]={enter:new me,end:new me,update:new me,draw:new me})}function i(l,a,d){return n(a),s[a][l].add(d)}function o(l,a,...d){n(a),s[a][l].trigger(...d)}let u=!1;return{id:"state",state:t,enterState(l,...a){if(u=!0,e&&!e.includes(l))throw new Error(`State not found: ${l}`);let d=this.state;if(r){if(!r?.[d])return;let m=typeof r[d]=="string"?[r[d]]:r[d];if(!m.includes(l))throw new Error(`Cannot transition state from "${d}" to "${l}". Available transitions: ${m.map(c=>`"${c}"`).join(", ")}`)}o("end",d,...a),this.state=l,o("enter",l,...a),o("enter",`${d} -> ${l}`,...a)},onStateTransition(l,a,d){return i("enter",`${l} -> ${a}`,d)},onStateEnter(l,a){return i("enter",l,a)},onStateUpdate(l,a){return i("update",l,a)},onStateDraw(l,a){return i("draw",l,a)},onStateEnd(l,a){return i("end",l,a)},update(){u||(o("enter",t),u=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return`state: ${this.state}`}}}function Kn(t){return{id:"stay",stay:!0,scenesToStay:t}}function Gl(t=!0,e){let r,s;return{id:"textInput",hasFocus:t,require:["text"],typedText:"",add(){let n=()=>{this.text=this.typedText.replace(/([\[\\])/g,"\\$1")};r=h.k.onCharInput(i=>{this.hasFocus&&(!e||this.typedText.length<e)&&(h.k.isKeyDown("shift")?this.typedText+=i.toUpperCase():this.typedText+=i,n())}),s=h.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1),n())})},destroy(){r.cancel(),s.cancel()}}}function Hr(t=1e3){return{id:"timer",maxLoopsPerFrame:t,loop(e,r,s=1/0,n=!1){let i=n?0:e,o=new me,u=this.onUpdate(()=>{i+=h.app.state.dt;for(let l=0;i>=e&&l<this.maxLoopsPerFrame;l++)if(s--,r(),i-=e,s<=0){u.cancel(),o.trigger();return}});return{get paused(){return u.paused},set paused(l){u.paused=l},cancel:u.cancel,onEnd(l){o.add(l)},then(l){return o.add(l),this}}},wait(e,r){return this.loop(e,r??(()=>{}),1,!0)},tween(e,r,s,n,i=kt.linear){let o=0,u=[],l=this.onUpdate(()=>{o+=h.app.state.dt;let a=Math.min(o/s,1);n(ve(e,r,i(a))),a===1&&(l.cancel(),n(r),u.forEach(d=>d()))});return{get paused(){return l.paused},set paused(a){l.paused=a},onEnd(a){u.push(a)},then(a){return this.onEnd(a),this},cancel(){l.cancel()},finish(){l.cancel(),n(r),u.forEach(a=>a())}}}}}var Yr=0;function Hl(){return Yr>0}function Yl(t={}){let e={},r=new Set,s=[];return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){Yr++,this.area.cursor&&s.push(this.onHover(()=>h.app.setCursor(this.area.cursor))),s.push(this.onCollideUpdate((n,i)=>{if(!n.id)throw new Error("area() requires the object to have an id");e[n.id]||this.trigger("collide",n,i),i&&(e[n.id]=i,r.add(n.id))}))},destroy(){Yr--;for(let n of s)n.cancel()},fixedUpdate(){for(let n in e)r.has(Number(n))||(this.trigger("collideEnd",e[n].target),delete e[n]);r.clear()},drawInspect(){let n=this.localArea();Ce(),ne(this.area.offset);let i={outline:{width:4/tn(),color:J(0,0,255)},anchor:this.anchor,fill:!1,fixed:tt(this)};n instanceof ee?Ie({...i,pos:n.pos,width:n.width*this.area.scale.x,height:n.height*this.area.scale.y}):n instanceof ye?We({...i,pts:n.pts,scale:this.area.scale}):n instanceof be&&At({...i,pos:n.center,radius:n.radius}),xe()},area:{shape:t.shape??null,scale:t.scale?E(t.scale):E(1),offset:t.offset??E(0),cursor:t.cursor??null},isClicked(){return h.app.isMousePressed()&&this.isHovering()},isHovering(){let n=tt(this)?h.k.mousePos():h.k.toWorld(h.k.mousePos());return this.hasPoint(n)},checkCollision(n){if(!n.id)throw new Error("checkCollision() requires the object to have an id");return e[n.id]??null},getCollisions(){return Object.values(e)},isColliding(n){if(!n.id)throw new Error("isColliding() requires the object to have an id");return!!e[n.id]},isOverlapping(n){if(!n.id)throw new Error("isOverlapping() requires the object to have an id");let i=e[n.id];return i&&i.hasOverlap()},onClick(n,i="left"){let o=this.onMousePress(i,()=>{this.isHovering()&&n()});return s.push(o),o},onHover(n){let i=!1;return this.onUpdate(()=>{i?i=this.isHovering():this.isHovering()&&(i=!0,n())})},onHoverUpdate(n){return this.onUpdate(()=>{this.isHovering()&&n()})},onHoverEnd(n){let i=!1;return this.onUpdate(()=>{i?this.isHovering()||(i=!1,n()):i=this.isHovering()})},onCollide(n,i){if(typeof n=="function"&&i===void 0)return this.on("collide",n);if(typeof n=="string")return this.onCollide((o,u)=>{o.is(n)&&i?.(o,u)});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(n,i){if(typeof n=="function"&&i===void 0)return this.on("collideUpdate",n);if(typeof n=="string")return this.on("collideUpdate",(o,u)=>o.is(n)&&i?.(o,u));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(n,i){if(typeof n=="function"&&i===void 0)return this.on("collideEnd",n);if(typeof n=="string")return this.on("collideEnd",o=>o.is(n)&&i?.(o));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(n){return Ve(this.worldArea(),n)},resolveCollision(n){let i=this.checkCollision(n);i&&!i.resolved&&(this.pos=this.pos.add(i.displacement),i.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let n=this.localArea();if(!(n instanceof ye||n instanceof ee))throw new Error("Only support polygon and rect shapes for now");let i=this.transform.clone().translate(this.area.offset).scale(E(this.area.scale??1));if(n instanceof ee){let o=wt(this.anchor||dr).add(1,1).scale(-.5).scale(n.width,n.height);i.translate(o)}return n.transform(i)},screenArea(){let n=this.worldArea();return tt(this)?n:n.transform(h.game.cam.transform)},inspect(){return this.area.scale?.x==this.area.scale?.y?`area: ${this.area.scale?.x?.toFixed(1)}x`:`area: (${this.area.scale?.x?.toFixed(1)}x, ${this.area.scale.y?.toFixed(1)}y)`}}}function jl(t={}){let e=null,r=null,s=!1,n=E(0),i=null,o=null,u;return{id:"body",require:["pos"],vel:E(0),drag:t.drag??0,jumpForce:t.jumpForce??Ji,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(i=this.pos.clone(),o=this.pos.clone(),u=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.has("area")&&(this.onCollideUpdate((l,a)=>{if(!a||!l.has("body")||a.resolved)return;this.trigger("beforePhysicsResolve",a);let d=a.reverse();if(l.trigger("beforePhysicsResolve",d),!(a.resolved||d.resolved)&&!(this.isStatic&&l.isStatic)){if(!this.isStatic&&!l.isStatic){let m=this.mass+l.mass;this.pos=this.pos.add(a.displacement.scale(l.mass/m)),l.pos=l.pos.add(a.displacement.scale(-this.mass/m)),this.transform=Tt(this),l.transform=Tt(l)}else{let m=!this.isStatic&&l.isStatic?a:a.reverse();m.source.pos=m.source.pos.add(m.displacement),m.source.transform=Tt(m.source)}a.resolved=!0,this.trigger("physicsResolve",a),l.trigger("physicsResolve",a.reverse())}}),this.onPhysicsResolve(l=>{if(h.game.gravity)if(l.isBottom()&&this.isFalling()){this.vel=this.vel.reject(h.game.gravity.unit());let a=e;e=l.target,a!=e&&(r=l.target.pos),s?s=!1:a||(this.trigger("ground",e),l.target.trigger("land",this))}else l.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(h.game.gravity.unit()),this.trigger("headbutt",l.target),l.target.trigger("headbutted",this))}))},update(){e&&this.isColliding(e)&&e.exists()&&e.has("body")&&(r&&!e.pos.eq(r)&&t.stickToPlatform!==!1&&this.moveBy(e.pos.sub(r)),r=e.pos);let l=Nr();l&&(this.pos.x==u.x&&(this.pos.x=ve(i.x,o.x,l/Fr()),u.x=this.pos.x),this.pos.y==u.y&&(this.pos.y=ve(i.y,o.y,l/Fr()),u.y=this.pos.y))},fixedUpdate(){if(i&&(this.pos.x==u.x&&(this.pos.x=i.x),this.pos.y==u.y&&(this.pos.y=i.y),i=null),h.game.gravity&&!this.isStatic){s&&(e=null,r=null,this.trigger("fallOff"),s=!1),e&&(!this.isColliding(e)||!e.exists()||!e.has("body"))&&(s=!0);let l=this.vel.clone();this.vel=this.vel.add(h.game.gravity.scale(this.gravityScale*he()));let a=t.maxVelocity??Qi;this.vel.slen()>a*a&&(this.vel=this.vel.unit().scale(a)),l.dot(h.game.gravity)<0&&this.vel.dot(h.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=n.x*he(),this.vel.y+=n.y*he(),this.vel.x*=1-this.drag*he(),this.vel.y*=1-this.drag*he(),this.move(this.vel),Nr()){i=this.pos.clone();let l=this.vel.add(n.scale(he()));o=this.pos.add(l.scale(he())),u=this.pos.clone()}n.x=0,n.y=0},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return e},isGrounded(){return e!==null},isFalling(){return this.vel.dot(Dt())>0},isJumping(){return this.vel.dot(Dt())<0},applyImpulse(l){this.isStatic||(this.vel=this.vel.add(l))},addForce(l){this.isStatic||(n.x+=l.x/this.mass,n.y+=l.y/this.mass)},jump(l){this.isStatic||(e=null,r=null,this.vel=Dt().scale(-l||-this.jumpForce))},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)},onLand(l){return this.on("land",l)},onHeadbutted(l){return this.on("headbutted",l)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}function Wl(t=2){let e=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(r){e<=0||(e<this.numJumps&&this.trigger("doubleJump"),e--,this.jump(r))},onDoubleJump(r){return this.on("doubleJump",r)},inspect(){return`jumpsLeft: ${e}`}}}function Xl(t){return{id:"surfaceEffector",require:["area"],speed:t.speed,speedVariation:t.speedVariation??0,forceScale:t.speedVariation??.9,add(){this.onCollideUpdate("body",(e,r)=>{let s=r?.normal.normal(),n=e.vel.project(s),i=s?.scale(this.speed)?.sub(n);e.addForce(i?.scale(e.mass*this.forceScale))})}}}function Vl(t){return{id:"areaEffector",require:["area"],useGlobalAngle:t.useGlobalAngle||!1,forceAngle:t.forceAngle,forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,linearDrag:t.linearDrag??0,add(){this.onCollideUpdate("body",(e,r)=>{if(!e.has("body"))return;let s=P.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(s),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Zl(t){return{id:"pointEffector",require:["area","pos"],forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,distanceScale:t.distanceScale??1,forceMode:t.forceMode||"inverseLinear",linearDrag:t.linearDrag??0,add(){this.onCollideUpdate("body",(e,r)=>{let s=this.pos.sub(e.pos),n=s.len(),i=n*this.distanceScale/10,o=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/i:1/i**2,u=s.scale(this.forceMagnitude*o/n);e.addForce(u),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Jl(t){return{id:"constantForce",require:["body"],force:t.force,update(){this.force&&this.addForce(this.force)}}}function Ql(t){return{id:"platformEffector",require:["area","body"],surfaceArc:t.surfaceArc??180,useOneWay:t.useOneWay??!1,add(){this.onBeforePhysicsResolve(e=>{let r=e.target.vel,s=Dt().scale(-1).angleBetween(r);Math.abs(s)>this.surfaceArc/2&&e.preventResolution()})}}}function _l(t){return{id:"buoyancyEffector",require:["area"],surfaceLevel:t.surfaceLevel,density:t.density??1,linearDrag:t.linearDrag??1,angularDrag:t.angularDrag??.2,flowAngle:t.flowAngle??0,flowMagnitude:t.flowMagnitude??0,flowVariation:t.flowVariation??0,add(){this.onCollideUpdate("body",(e,r)=>{let s=e,n=s.worldArea(),[i,o]=n.cut(E(-100,this.surfaceLevel),E(100,this.surfaceLevel));i&&(this.applyBuoyancy(s,i),this.applyDrag(s,i)),this.flowMagnitude&&s.addForce(P.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,r){let s=this.density*r.area(),n=E(0,1).scale(-s);e.addForce(n)},applyDrag(e,r){let s=e.vel,n=this.density*this.linearDrag,i=s.scale(-n);e.addForce(i)}}}function jr(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}function Gn(){return{id:"fixed",fixed:!0}}function $l(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:e??E(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function ec(t){let e=h.game.layers?.indexOf(t);return{id:"layer",get layerIndex(){return e??null},get layer(){return e?h.game.layers?.[e]??null:null},set layer(r){if(e=h.game.layers?.indexOf(r),e==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}function tc(t,e){let r=typeof t=="number"?P.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(e))}}}function rc(t={}){let e=!1,r=new ee(E(0),pe(),fe()),s=new ee(E(0),0,0),n=i=>{i.isOffScreen()?(e||(i.trigger("exitView"),e=!0),t.hide&&(i.hidden=!0),t.pause&&(i.paused=!0),t.destroy&&i.destroy()):(e&&(i.trigger("enterView"),e=!1),t.hide&&(i.hidden=!1),t.pause&&(i.paused=!1))};return{id:"offscreen",require:["pos"],offscreenDistance:t.distance??gs,isOffScreen(){let i=this.screenPos();if(!i)return!1;if(r.width=pe(),r.height=fe(),!this.offscreenDistance&&this.width&&this.height)return s.width=this.width,s.height=this.height,s.pos=this.pos,s.collides(r);let o=this.offscreenDistance?this.offscreenDistance:gs;return!cr(r,i)&&r.sdistToPoint(i)>o*o},onExitScreen(i){return this.on("exitView",i)},onEnterScreen(i){return this.on("enterView",i)},add(){t.pause&&t.unpause?bn(()=>n(this)):this.onUpdate(()=>n(this))}}}function ar(...t){return{id:"pos",pos:E(...t),moveBy(...e){this.pos=this.pos.add(E(...e))},move(...e){this.moveBy(E(...e).scale(he()))},moveTo(...e){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.moveTo(E(e[0],e[1]),e[2]);let r=e[0],s=e[1];if(s===void 0){this.pos=E(r);return}let n=r.sub(this.pos);if(n.len()<=s*he()){this.pos=E(r);return}this.move(n.unit().scale(s))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(e){return this.parent?this.parent.transform.multVec2(this.pos.add(e)):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.invert().multVec2(e).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let r=this.worldPos();return r?tt(this)?r:Kr(r):null}},toScreen(e){let r=this.toWorld(e);return tt(this)?r:Kr(r)},fromScreen(e){return tt(this)?this.fromWorld(e):this.fromWorld(On(e))},toOther(e,r){return e.fromWorld(this.toWorld(r))},fromOther(e,r){return e.toOther(this,r)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){At({color:J(255,0,0),radius:4/tn()})}}}function sc(t){return{id:"rotate",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}function lr(...t){if(t.length===0)return lr(1);let e=E(...t);return{id:"scale",set scale(r){if(!(r instanceof P))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");e=E(r)},get scale(){return e},scaleTo(...r){e=E(...r)},scaleBy(...r){e=e.scale(E(...r))},inspect(){return e.x==e.y?`scale: ${e.x.toFixed(1)}x`:`scale: (${e.x.toFixed(1)}x, ${e.y.toFixed(1)}y)`}}}function nc(t){return{id:"z",z:t,inspect(){return`z: ${this.z}`}}}var ic="data:image/png;base64,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",oc="data:image/png;base64,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",ac=Zn.version,h={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},lc=(t={tagsAsComponents:!0})=>{h.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),h.k.quit()),h.globalOpt=t;let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=t.canvas??e.appendChild(document.createElement("canvas"));h.canvas=r;let s=t.scale??1;h.gscale=s;let n=t.width&&t.height&&!t.stretch&&!t.letterbox;n?(r.width=t.width*s,r.height=t.height*s):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let i=["outline: none","cursor: default"];if(n){let U=r.width,H=r.height;i.push(`width: ${U}px`),i.push(`height: ${H}px`)}else i.push("width: 100%"),i.push("height: 100%");t.crisp&&(i.push("image-rendering: pixelated"),i.push("image-rendering: crisp-edges")),r.style.cssText=i.join(";");let o=t.pixelDensity||1;h.pixelDensity=o,r.width*=o,r.height*=o,r.tabIndex=0;let u=document.createElement("canvas");u.width=256,u.height=256,h.fontCacheCanvas=u;let l=u.getContext("2d",{willReadFrequently:!0});h.fontCacheC2d=l;let a=qo({canvas:r,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons});h.app=a;let d=[],m=a.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!m)throw new Error("WebGL not supported");let c=m,f=va(c,{texFilter:t.texFilter}),p=qa(t,f);h.gfx=p;let y=gl();h.audio=y;let g=ta(f,t.spriteAtlasPadding??0);h.assets=g;let x=ul();h.game=x,x.root.use(Hr());function S(U,H){let j=new ir(f,U,H);return{clear:()=>j.clear(),free:()=>j.free(),toDataURL:()=>j.toDataURL(),toImageData:()=>j.toImageData(),width:j.width,height:j.height,draw:$=>{qe(),j.bind(),$(),qe(),j.unbind()},get fb(){return j}}}function C(){c.clear(c.COLOR_BUFFER_BIT),p.frameBuffer.bind(),c.clear(c.COLOR_BUFFER_BIT),p.bgColor||je(()=>{Ut({width:pe(),height:fe(),quad:new se(0,0,pe()/64,fe()/64),tex:p.bgTex,fixed:!0})}),p.renderer.numDraws=0,p.fixed=!1,p.transformStack.length=0,p.transform=new Ne}function D(U,H){p.postShader=U,p.postShaderUniform=H??null}function b(){qe(),p.lastDrawCalls=p.renderer.numDraws,p.frameBuffer.unbind(),c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);let U=p.width,H=p.height;p.width=c.drawingBufferWidth/o,p.height=c.drawingBufferHeight/o,or({flipY:!0,tex:p.frameBuffer.tex,pos:new P(p.viewport.x,p.viewport.y),width:p.viewport.width,height:p.viewport.height,shader:p.postShader,uniform:typeof p.postShaderUniform=="function"?p.postShaderUniform():p.postShaderUniform,fixed:!0}),qe(),p.width=U,p.height=H}let A=!1,v={inspect:!1,set timeScale(U){h.app.state.timeScale=U},get timeScale(){return h.app.state.timeScale},showLog:!0,fps:()=>a.fps(),numFrames:()=>a.numFrames(),stepFrame:ct,drawCalls:()=>p.lastDrawCalls,clearLog:()=>x.logs=[],log:(...U)=>{let H=t.logMax??8,j=U.length>1?U.concat(" ").join(" "):U[0];x.logs.unshift({msg:j,time:a.time()}),x.logs.length>H&&(x.logs=x.logs.slice(0,H))},error:U=>v.log(new Error(U.toString?U.toString():U)),curRecording:null,numObjects:()=>k("*",{recursive:!0}).length,get paused(){return A},set paused(U){A=U,U?y.ctx.suspend():y.ctx.resume()}};h.debug=v;function q(U,H){try{return JSON.parse(window.localStorage[U])}catch{return H?(T(U,H),H):null}}function T(U,H){window.localStorage[U]=JSON.stringify(H)}function R(U,...H){let j=U(Oe),$;typeof j=="function"?$=j(...H)(Oe):$=j;for(let le in $)Oe[le]=$[le],t.global!==!1&&(window[le]=$[le]);return Oe}function O(U){let H=a.canvas.captureStream(U),j=y.ctx.createMediaStreamDestination();y.masterNode.connect(j);let $=new MediaRecorder(H),le=[];return $.ondataavailable=V=>{V.data.size>0&&le.push(V.data)},$.onerror=()=>{y.masterNode.disconnect(j),H.getTracks().forEach(V=>V.stop())},$.start(),{resume(){$.resume()},pause(){$.pause()},stop(){return $.stop(),y.masterNode.disconnect(j),H.getTracks().forEach(V=>V.stop()),new Promise(V=>{$.onstop=()=>{V(new Blob(le,{type:"video/mp4"}))}})},download(V="kaboom.mp4"){this.stop().then(ge=>ms(V,ge))}}}function N(){return document.activeElement===a.canvas}let L=x.root.add.bind(x.root),K=x.root.readd.bind(x.root),Y=x.root.removeAll.bind(x.root),k=x.root.get.bind(x.root),F=x.root.wait.bind(x.root),_=x.root.loop.bind(x.root),W=x.root.query.bind(x.root),Q=x.root.tween.bind(x.root),de=Ot(null,oc),G=Ot(null,ic);h.kaSprite=de,h.boomSprite=G;function Qe(){x.root.fixedUpdate()}function ct(){x.root.update()}class xt{source;target;normal;distance;resolved=!1;constructor(H,j,$,le,V=!1){this.source=H,this.target=j,this.normal=$,this.distance=le,this.resolved=V}get displacement(){return this.normal.scale(this.distance)}reverse(){return new xt(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(x.gravity||E(0,1))>0}isRight(){return this.displacement.cross(x.gravity||E(0,1))<0}isTop(){return this.displacement.dot(x.gravity||E(0,1))>0}isBottom(){return this.displacement.dot(x.gravity||E(0,1))<0}preventResolution(){this.resolved=!0}}function Kt(){if(!Hl())return;let U={},H=t.hashGridSize||64,j=new Ne,$=[];function le(V){if($.push(j.clone()),V.pos&&j.translate(V.pos),V.scale&&j.scale(V.scale),V.angle&&j.rotate(V.angle),V.transform=j.clone(),V.c("area")&&!V.paused){let ge=V,He=ge.worldArea().bbox(),wr=Math.floor(He.pos.x/H),Ar=Math.floor(He.pos.y/H),xr=Math.ceil((He.pos.x+He.width)/H),vr=Math.ceil((He.pos.y+He.height)/H),Yt=new Set;for(let De=wr;De<=xr;De++)for(let Ye=Ar;Ye<=vr;Ye++)if(!U[De])U[De]={},U[De][Ye]=[ge];else if(!U[De][Ye])U[De][Ye]=[ge];else{let jt=U[De][Ye];e:for(let we of jt){if(we.paused||!we.exists()||Yt.has(we.id))continue;for(let Ue of ge.collisionIgnore)if(we.is(Ue))continue e;for(let Ue of we.collisionIgnore)if(ge.is(Ue))continue e;let vt=Fi(ge.worldArea(),we.worldArea());if(vt){let Ue=new xt(ge,we,vt.normal,vt.distance);ge.trigger("collideUpdate",we,Ue);let Wt=Ue.reverse();Wt.resolved=Ue.resolved,we.trigger("collideUpdate",ge,Wt)}Yt.add(we.id)}jt.push(ge)}}V.children.forEach(le),j=$.pop()}le(x.root)}function Gt(U){console.error(U),y.ctx.suspend();let H=U.message??String(U)??"Unknown error, check console for more info";a.run(()=>{},()=>{C(),je(()=>{let j=pe(),$=fe(),le={size:36,width:j-64,letterSpacing:4,lineSpacing:4,font:sr,fixed:!0};Ie({width:j,height:$,color:J(0,0,255),fixed:!0});let V=nt({...le,text:"Error",pos:E(32),color:J(255,128,0),fixed:!0});it(V),Ps({...le,text:H,pos:E(32,32+V.height+16),fixed:!0}),xe(),x.events.trigger("error",U)}),b()})}function mr(U){d.push(U)}function yr(){x.events.onOnce("frameEnd",()=>{a.quit(),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);let U=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);for(let H=0;H<U;H++)c.activeTexture(c.TEXTURE0+H),c.bindTexture(c.TEXTURE_2D,null),c.bindTexture(c.TEXTURE_CUBE_MAP,null);c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null),f.destroy(),d.forEach(H=>H())})}let ut=!0;a.run(()=>{try{g.loaded&&(v.paused||Qe(),Kt())}catch(U){Gt(U)}},(U,H)=>{try{U(),g.loaded||st()===1&&!ut&&(g.loaded=!0,sn().forEach(j=>x.events.trigger("loadError",...j)),x.events.trigger("load")),!g.loaded&&t.loadingScreen!==!1||ut?(C(),Sa(),b()):(v.paused||ct(),Kt(),C(),Ea(),t.debug!==!1&&ba(),b()),ut&&(ut=!1),x.events.trigger("frameEnd"),H()}catch(j){Gt(j)}}),en(),Fn();let Oe={_k:h,VERSION:ac,loadRoot:_o,loadProgress:st,loadSprite:Ot,loadSpriteAtlas:dn,loadSound:fa,loadMusic:ga,loadBitmapFont:aa,loadFont:ia,loadShader:ha,loadShaderURL:da,loadAseprite:na,loadPedit:la,loadBean:sa,loadJSON:$o,load:Ur,getSound:hn,getFont:ln,getBitmapFont:cn,getSprite:nn,getShader:un,getAsset:ea,Asset:Te,SpriteData:Ze,SoundData:Nt,width:pe,height:fe,center:nr,dt:he,fixedDt:Fr,restDt:Nr,time:a.time,screenshot:a.screenshot,record:O,isFocused:N,setCursor:a.setCursor,getCursor:a.getCursor,setCursorLocked:a.setCursorLocked,isCursorLocked:a.isCursorLocked,setFullscreen:a.setFullscreen,isFullscreen:a.isFullscreen,isTouchscreen:a.isTouchscreen,onLoad:os,onLoadError:rl,onLoading:$a,onResize:el,onGamepadConnect:a.onGamepadConnect,onGamepadDisconnect:a.onGamepadDisconnect,onError:tl,onCleanup:mr,flash:Tn,setCamPos:Mn,getCamPos:Pn,setCamRot:In,getCamRot:Rn,setCamScale:Cn,getCamScale:qn,getCamTransform:sl,camPos:ol,camScale:al,camFlash:cl,camRot:ll,camTransform:nl,shake:il,toScreen:Kr,toWorld:On,setGravity:hl,getGravity:dl,setGravityDirection:pl,getGravityDirection:Dt,setBackground:Wo,getBackground:Xo,getGamepads:a.getGamepads,getTreeRoot:El,add:L,make:as,destroy:Un,destroyAll:Y,get:k,query:W,readd:K,pos:ar,scale:lr,rotate:sc,color:wn,opacity:An,anchor:jr,area:Yl,sprite:Gr,text:ql,polygon:Fa,rect:vn,circle:Ia,uvquad:Il,outline:Da,particles:ka,body:jl,platformEffector:Ql,surfaceEffector:Xl,areaEffector:Vl,pointEffector:Zl,buoyancyEffector:_l,constantForce:Jl,doubleJump:Wl,shader:Na,textInput:Gl,timer:Hr,fixed:Gn,stay:Kn,health:Ul,lifespan:Ll,named:zl,state:Kl,z:nc,layer:ec,move:tc,offscreen:rc,follow:$l,fadeIn:Ta,mask:Oa,drawon:Ra,raycast:xn,tile:Ln,animate:Nl,serializeAnimation:zn,agent:Rl,sentry:Dl,patrol:Ol,pathfinder:Tl,trigger:La,on:Se,onFixedUpdate:za,onUpdate:bn,onDraw:Ka,onAdd:En,onDestroy:Ga,onTag:Sn,onUntag:ja,onUse:Ha,onUnuse:Ya,onClick:Za,onCollide:Wa,onCollideUpdate:Xa,onCollideEnd:Va,onHover:Ja,onHoverUpdate:Qa,onHoverEnd:_a,onKeyDown:a.onKeyDown,onKeyPress:a.onKeyPress,onKeyPressRepeat:a.onKeyPressRepeat,onKeyRelease:a.onKeyRelease,onMouseDown:a.onMouseDown,onMousePress:a.onMousePress,onMouseRelease:a.onMouseRelease,onMouseMove:a.onMouseMove,onCharInput:a.onCharInput,onTouchStart:a.onTouchStart,onTouchMove:a.onTouchMove,onTouchEnd:a.onTouchEnd,onScroll:a.onScroll,onHide:a.onHide,onShow:a.onShow,onGamepadButtonDown:a.onGamepadButtonDown,onGamepadButtonPress:a.onGamepadButtonPress,onGamepadButtonRelease:a.onGamepadButtonRelease,onGamepadStick:a.onGamepadStick,onButtonPress:a.onButtonPress,onButtonDown:a.onButtonDown,onButtonRelease:a.onButtonRelease,mousePos:a.mousePos,mouseDeltaPos:a.mouseDeltaPos,isKeyDown:a.isKeyDown,isKeyPressed:a.isKeyPressed,isKeyPressedRepeat:a.isKeyPressedRepeat,isKeyReleased:a.isKeyReleased,isMouseDown:a.isMouseDown,isMousePressed:a.isMousePressed,isMouseReleased:a.isMouseReleased,isMouseMoved:a.isMouseMoved,isGamepadButtonPressed:a.isGamepadButtonPressed,isGamepadButtonDown:a.isGamepadButtonDown,isGamepadButtonReleased:a.isGamepadButtonReleased,getGamepadStick:a.getGamepadStick,isButtonPressed:a.isButtonPressed,isButtonDown:a.isButtonDown,isButtonReleased:a.isButtonReleased,setButton:a.setButton,getButton:a.getButton,pressButton:a.pressButton,releaseButton:a.releaseButton,getLastInputDeviceType:a.getLastInputDeviceType,charInputted:a.charInputted,loop:_,wait:F,play:yl,setVolume:Bn,getVolume:kn,volume:wl,burp:Dn,audioCtx:y.ctx,Line:Ee,Rect:ee,Circle:be,Ellipse:Ge,Point:wi,Polygon:ye,Vec2:P,Color:X,Mat4:Ne,Quad:se,RNG:Rs,rand:ue,randi:Ts,randSeed:ei,vec2:E,rgb:J,hsl2rgb:Jn,quad:oe,choose:si,chooseMultiple:ri,shuffle:Os,chance:ti,lerp:ve,tween:Q,easings:kt,map:ke,mapc:Qn,wave:Is,deg2rad:ae,rad2deg:rt,clamp:Fe,evaluateQuadratic:xi,evaluateQuadraticFirstDerivative:vi,evaluateQuadraticSecondDerivative:bi,evaluateBezier:_r,evaluateBezierFirstDerivative:Ei,evaluateBezierSecondDerivative:Si,evaluateCatmullRom:Mi,evaluateCatmullRomFirstDerivative:Pi,curveLengthApproximation:Gs,normalizedCurve:Ci,hermite:zt,cardinal:Hs,catmullRom:rr,bezier:qi,kochanekBartels:Ii,easingSteps:ki,easingLinear:Di,easingCubicBezier:Bi,testLineLine:Wr,testRectRect:Ds,testRectLine:Xr,testRectPoint:cr,testCirclePolygon:hr,testLinePoint:Vr,testLineCircle:Lt,isConvex:Ki,triangulate:js,NavMesh:Yo,drawSprite:Pa,drawText:Ps,formatText:nt,drawRect:Ie,drawLine:It,drawLines:is,drawTriangle:mn,drawCircle:At,drawEllipse:pn,drawUVQuad:Ut,drawPolygon:We,drawCurve:fn,drawBezier:Aa,drawFormattedText:it,drawMasked:Ma,drawSubtracted:Ca,pushTransform:Ce,popTransform:xe,pushTranslate:ne,pushScale:Ft,pushRotate:mt,pushMatrix:Vo,usePostEffect:D,makeCanvas:S,debug:v,scene:Sl,getSceneName:Cl,go:Ml,onSceneLeave:Pl,layers:bl,getLayers:xl,setLayers:Nn,getDefaultLayer:vl,addLevel:Ua,getData:q,setData:T,download:es,downloadJSON:so,downloadText:_s,downloadBlob:ms,plug:R,ASCII_CHARS:Ws,canvas:a.canvas,addKaboom:Al,LEFT:P.LEFT,RIGHT:P.RIGHT,UP:P.UP,DOWN:P.DOWN,RED:X.RED,GREEN:X.GREEN,BLUE:X.BLUE,YELLOW:X.YELLOW,MAGENTA:X.MAGENTA,CYAN:X.CYAN,WHITE:X.WHITE,BLACK:X.BLACK,quit:yr,KEvent:me,KEventHandler:Bt,KEventController:at,cancel:()=>Vs};h.k=Oe;let Ht=t.plugins;if(Ht&&Ht.forEach(R),t.global!==!1)for(let U in Oe)window[U]=Oe[U];return t.focus!==!1&&a.canvas.focus(),Oe},cc=lc;function uc(t,e){let r=0,s=!1,n="",i="",o=null;if(!t||t.length===0)return;const u=300,l=add([rect(width()-100,u),pos(50,height()-u-50),fixed(),color(0,0,0),outline(4,rgb(255,255,255)),opacity(.8),z(1e3),"dialogue_ui"]),a=add([text("",{size:56,font:"monospace"}),pos(80,height()-u-30),fixed(),color(255,255,0),z(1001),"dialogue_ui"]),d=add([text("",{size:42,width:width()-160,lineSpacing:12}),pos(80,height()-u+30),fixed(),color(255,255,255),z(1001),"dialogue_ui"]),m=add([text("Spacja >>",{size:24}),pos(width()-200,height()-80),fixed(),opacity(0),z(1001),"dialogue_ui"]);function c(){o&&clearInterval(o),o=null,d.text=i,s=!1,m.opacity=1;const g=loop(.5,()=>{m.exists()?m.opacity=m.opacity===1?.5:1:g.cancel()})}function f(g){if(o&&clearInterval(o),g>=t.length){destroyAll("dialogue_ui");return}const x=t;a.text=x?.char,i=x?.text,d.text="",n="",s=!0,m.opacity=0;let S=0;o=setInterval(()=>{if(!i||S>=i.length){c();return}const C=i[S];C!==void 0?(n+=C,d.text=n,S++):c()},30)}const p=onKeyPress("space",()=>{l.exists()&&(destroy(l),destroy(d),destroy(a),destroy(m),s?c():(r++,f(r)))}),y=onUpdate(()=>{l.exists()===!1&&(o&&clearInterval(o),p.cancel(),y.cancel())});f(0)}function hc(){setGravity(0);const t=300,e=300;let r=!1,s=!1;scene("lvl1",()=>{loadSound("game","sprites/gameplaymus.mp3");const n=play("game",{volume:.4,loop:!0});loadSprite("bg","sprites/levels/lvl1.png"),loadSprite("elevator","sprites/winda.png",{sliceX:5,sliceY:1,anims:{closed:{from:0,to:0,loop:!1},open:{from:4,to:4,loop:!1},oppening:{from:0,to:4,loop:!1},closing:{from:4,to:0,loop:!1}}});const i=add([sprite("elevator"),pos(2385,600),scale(8),area()]);loadSprite("player","sprites/player.png",{sliceX:5,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:4,loop:!0,speed:10}}}),add([sprite("bg"),pos(208,-808),scale(8),z(-100)]),add([rect(20,height()),pos(3650,600),area(),body({isStatic:!0}),opacity(0)]);const o=add([sprite("player"),pos(3400,995),scale(12),area(),body(),anchor("bot"),"player"]);add([rect(20,20),pos(2800,805),opacity(0),area(),"colider"]),add([rect(20,20),pos(2400,800),opacity(0),area(),"elevcolider"]),add([rect(20,height()),pos(350,0),area(),body({isStatic:!0}),opacity(0)]),onCollide("player","elevcolider",()=>{if(s==!0){const u=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,l=>u.opacity=l,easings.linear).onEnd(()=>{n.stop(),go("lvl2")})}}),onCollide("player","colider",()=>{r=!0,o.play("idle"),uc({char:"Mr. Hacker",text:"Kurde... Chyba nie wjade po tych schodach... jad na wind. (Gr kontrolujemy strzakami, a interakcje w grach za pomoc space oraz enter. Na kocu kadego poziomu jest winda na pin. Po wykonaniu zada odradzasz si na pocztku, wic pilnuj by nie wykona tej samej misji kilka razy!)"}),i.play("oppening"),wait(8,()=>{s=!0,r=!1,pressButton("space")})}),o.play("idle"),camPos(o.pos.x,center().y),o.onUpdate(()=>{const u=camPos();o.pos.x>u.x+e&&camPos(o.pos.x-e,u.y),o.pos.x<u.x-e&&camPos(o.pos.x+e,u.y),camPos().x<center().x&&camPos(center().x,camPos().y)}),o.onUpdate(()=>{if(r){o.vel.x=0;return}isKeyDown("left")?(o.vel.x=-t,o.flipX=!1,o.curAnim()!=="walk"&&o.play("walk")):isKeyDown("right")?(o.vel.x=t,o.flipX=!0,o.curAnim()!=="walk"&&o.play("walk")):(o.vel.x=0,o.curAnim()!=="idle"&&o.play("idle"))})})}function dc(){scene("mgame1",()=>{loadSound("mgames","sprites/mgamesmus.mp3");const t=play("mgames",{volume:.4,loop:!0});t.play();const e=rgb(0,255,100),r=rgb(255,50,50),s=rgb(255,255,0),n=rgb(10,10,15),i=rgb(20,20,25),o=["sudo","ping","root","exec","init","kill","void","sync","exit","boot"],u=5,l=2;let a=u,d=0,m=0,c=choose(o),f="",p=!0;add([rect(width(),height()),color(n),fixed()]),add([rect(1200,800,{radius:16}),pos(center()),anchor("center"),color(i),outline(8,e)]);const y=add([text("PKT: 00/10",{size:48,font:"monospace"}),pos(center().x-400,center().y-300),color(e)]),g=add([text(`BDY: 0/${l}`,{size:48,font:"monospace"}),pos(center().x+200,center().y-300),color(r)]),x=add([text("WPISZ KOMENDE",{size:52,font:"monospace"}),pos(center().x,center().y-200),anchor("center"),color(100,100,100)]),S=add([text(c,{size:120,font:"monospace"}),pos(center().x,center().y-20),anchor("center"),color(e)]),C=add([text("",{size:80,font:"monospace"}),pos(center().x,center().y+120),anchor("center"),color(255,255,255)]),D=1e3,b=20,A=add([rect(D,b),pos(center().x,center().y+250),anchor("center"),color(50,50,50)]),v=add([rect(D,b),pos(center().x,center().y+250),anchor("center"),color(e)]);function q(O){m++,g.text=`BDY: ${m}/${l}`,shake(20),f="",C.text="_",C.color=rgb(255,255,255),m>=l&&T()}function T(){d=0,m=0,a=u,y.text="PKT: 00/10",g.text=`BDY: 0/${l}`,x.text="SYSTEM ZRESETOWANY!",x.color=r,c=choose(o),S.text=c,shake(40),wait(1,()=>{x.text="STATUS: OCZEKIWANIE NA KOMEND...",x.color=rgb(100,100,100)})}onCharInput(O=>{if(!p)return;const N=c[f.length];if(O===N)f+=O,C.text=f+"_",C.color=rgb(255,255,255);else{C.color=r,q();return}f===c&&(f="",C.text="",d++,a=u,d>=10?R():(c=choose(o),S.text=c,y.text=`PKT: ${d.toString().padStart(2,"0")}/10`,shake(5),S.scale=vec2(1.5),tween(S.scale,vec2(1),.2,L=>S.scale=L,easings.easeOutQuad)))}),onUpdate(()=>{if(!p)return;a-=dt();const O=a/u;if(v.width=D*O,O<.3){const N=wave(0,1,time()*10)>.5?r:rgb(255,100,100);v.color=r,S.color=N}else v.color=e,S.color=e;a<=0&&(a=u,q())});function R(){p=!1,y.text="PKT: 10/10",destroy(S),destroy(C),destroy(v),destroy(A),destroy(y),destroy(g),destroy(x),add([text("DOSTP PRZYZNANY",{size:80,font:"monospace"}),pos(center().x,center().y-100),anchor("center"),color(e)]),add([text("PIN DO WINDY:",{size:40,font:"monospace"}),pos(center().x,center().y+50),anchor("center"),color(255,255,255)]),add([text("7359",{size:120,font:"monospace"}),pos(center().x,center().y+150),anchor("center"),color(s)]),wait(3,()=>{t.stop(),go("lvl2")})}})}function pc(){loadSprite("virus","sprites/wirus.png"),loadSprite("kursor","sprites/kursor.png"),loadSprite("tarcza","sprites/tarcza.png"),scene("mgame2",()=>{loadSound("mgames","sprites/mgamesmus.mp3");const t=play("mgames",{volume:.4,loop:!0}),e=900,r=400,s=350,n=.8,i=1.5,o=10;let u=0,l=!1;add([rect(width(),height()),color(10,10,20),fixed()]);for(let c=0;c<width();c+=40)add([rect(1,height()),pos(c,0),color(0,50,0),opacity(.3)]);add([text("ZBIERAJ TARCZE I UNIKAJ WIRUSW",{size:32,font:"monospace"}),pos(center().x,30),anchor("center"),color(0,255,255)]);const a=add([text("DANE: 0/10",{size:24,font:"monospace"}),pos(20,20),color(0,255,100)]);add([text("STEROWANIE: STRZAKI < > | UNIKAJ CZERWONEGO",{size:24,font:"monospace"}),pos(center().x,height()-20),anchor("center"),color(150,150,150)]);const d=add([sprite("kursor"),scale(3),pos(center().x,height()-90),anchor("center"),area(),"player",{dir:0}]);loop(n,()=>{if(l)return;const c=rand(20,width()-20);add([sprite("virus"),scale(2.5),pos(c,-40),anchor("center"),area(),move(DOWN,r),offscreen({destroy:!0}),"virus"])}),loop(i,()=>{if(l)return;const c=rand(20,width()-20);add([sprite("tarcza"),pos(c,-40),anchor("center"),area(),scale(3.5),move(DOWN,s),offscreen({destroy:!0}),"data"])}),onKeyDown("left",()=>{d.pos.x>50&&d.move(-e,0)}),onKeyDown("right",()=>{d.pos.x<width()-50&&d.move(e,0)}),d.onCollide("virus",c=>{destroy(c),shake(10),u=0,a.text=`DANE: ${u}/${o}`,a.color=rgb(255,0,0),wait(.2,()=>{a&&(a.color=rgb(0,255,100))}),add([rect(width(),height()),pos(0,0),color(255,0,0),opacity(.4),lifespan(.2,{fade:.5}),fixed(),z(100)]),add([text("WIRUS WYKRYTY!",{size:24}),pos(center()),anchor("center"),color(255,0,0),lifespan(1),opacity(1),move(vec2(0,-1),50)])}),d.onCollide("data",c=>{destroy(c),u++,a.text=`DANE: ${u}/${o}`,add([rect(width(),height()),color(0,255,100),opacity(.1),lifespan(.1),fixed()]),u>=o&&m()});function m(){l=!0,destroyAll("virus"),destroyAll("data"),add([rect(500,200,{radius:10}),pos(center()),anchor("center"),color(0,0,0),outline(4,rgb(0,255,0))]),add([text("FIREWALL ZABEZPIECZONY",{size:28}),pos(center().x,center().y-40),anchor("center"),color(0,255,0)]),add([text("POOWA PINU:",{size:20}),pos(center().x,center().y+20),anchor("center"),color(255,255,255)]),add([text("90..",{size:48}),pos(center().x,center().y+60),anchor("center"),color(255,255,0)]),wait(3,()=>{t.stop(),go("lvl3")})}})}function fc(){scene("mgame3",()=>{loadSound("mgames","sprites/mgamesmus.mp3");const t=play("mgames",{volume:.4,loop:!0}),e="CZARNY",r=6,s=6,n=rgb(0,0,0),i=rgb(0,100,0),o=rgb(0,255,255),u=rgb(0,255,0),l=rgb(255,255,0),a=rgb(50,50,50),d=rgb(255,255,255);let m=0,c=0,f=!1,p=!1;const y=[];add([rect(width(),height()),color(10,10,20),fixed()]),add([text("WORDLE (PODPOWIED, KSYWKA WANEJ OSOBISTOCI)",{size:50,font:"monospace"}),pos(center().x,60),anchor("center"),color(0,255,255)]),add([text("WPISZ HASO I ZATWIERD (ENTER)",{size:36,font:"monospace"}),pos(center().x,height()-40),anchor("center"),color(150,150,150)]);const g=80,x=15,S=r*(g+x)-x,C=center().x-S/2+g/2,D=160;for(let R=0;R<s;R++){y[R]=[];for(let O=0;O<r;O++){const N=C+O*(g+x),L=D+R*(g+x),K=add([rect(g,g,{radius:8}),pos(N,L),anchor("center"),outline(3,i),color(n),scale(1)]),Y=add([text("",{size:50,font:"monospace"}),pos(N,L),anchor("center"),color(d)]);y[R][O]={bg:K,text:Y,char:""}}}const b=add([rect(g+6,g+6,{radius:8,fill:!1}),pos(0,0),anchor("center"),outline(5,o),opacity(0),z(10)]);function A(){if(m<s&&c<r&&!f&&!p){const R=y[m][c].bg.pos;b.pos=R,b.opacity=1}else b.opacity=0}loop(.5,()=>{b.opacity>0&&(b.hidden=!b.hidden)}),A(),onCharInput(R=>{if(f||p)return;const O=R.toUpperCase();if("ABCDEFGHIJKLMNOPQRSTUVWXYZ".includes(O)&&c<r){const L=y[m][c];L.char=O,L.text.text=O,L.bg.scale=vec2(1.1),tween(L.bg.scale,vec2(1),.1,K=>L.bg.scale=K,easings.easeOutQuad),c++,A()}}),onKeyPress("backspace",()=>{if(!(f||p)&&c>0){c--;const R=y[m][c];R.char="",R.text.text="",R.bg.scale=vec2(.9),tween(R.bg.scale,vec2(1),.1,O=>R.bg.scale=O),A()}}),onKeyPress("enter",()=>{if(!(f||p)){if(c<r){shake(5),add([text("ZA KRTKIE!",{size:40,font:"monospace"}),pos(center()),anchor("center"),color(255,50,50),lifespan(1),move(vec2(0,-1),50)]);return}v()}});function v(){p=!0,b.opacity=0;const R=y[m],O=R.map(k=>k.char);let N=e.split(""),L=Array(r).fill("ABSENT");for(let k=0;k<r;k++)O[k]===N[k]&&(L[k]="CORRECT",N[k]=null,O[k]=null);for(let k=0;k<r;k++)if(O[k]!==null){const F=N.indexOf(O[k]);F>-1&&(L[k]="PRESENT",N[F]=null)}let K=0,Y=0;for(let k=0;k<r;k++){const F=R[k],_=L[k];wait(k*.3,()=>{tween(F.bg.scale,vec2(1,0),.15,W=>F.bg.scale=W,easings.easeInQuad).then(()=>{_==="CORRECT"?(F.bg.color=u,F.bg.outline=null,F.text.color=rgb(0,0,0),Y++):_==="PRESENT"?(F.bg.color=l,F.bg.outline=null,F.text.color=rgb(0,0,0)):(F.bg.color=a,F.bg.outline=null),tween(F.bg.scale,vec2(1,1),.15,W=>F.bg.scale=W,easings.easeOutQuad).then(()=>{K++,K===r&&(Y===r?q():(m++,c=0,p=!1,A(),m>=s&&T()))})})})}}function q(){f=!0,wait(.5,()=>{add([rect(700,400,{radius:12}),pos(center()),anchor("center"),color(0,0,0),outline(6,u),z(100)]),add([text("HASO ZAMANE",{size:48,font:"monospace"}),pos(center().x,center().y-80),anchor("center"),color(u),z(101)]),add([text("DRUGA POOWA PINU:",{size:32,font:"monospace"}),pos(center().x,center().y+20),anchor("center"),color(255,255,255),z(101)]),add([text("..42",{size:80,font:"monospace"}),pos(center().x,center().y+100),anchor("center"),color(255,255,0),z(101)]),add([text("(ESC) WYJCIE",{size:24,font:"monospace"}),pos(center().x,center().y+160),anchor("center"),color(100,100,100),z(101)])}),wait(3,()=>{t.stop(),go("lvl3")})}function T(){f=!0,wait(.5,()=>{add([text("ODMOWA DOSTPU, R - Restart",{size:48,font:"monospace"}),pos(center().x,center().y-80),anchor("center"),color(255,0,0),z(101)])})}onKeyPress("r",()=>{f&&(t.stop(),go("mgame3"))})})}function gc(){loadSound("mgames","sprites/mgamesmus.mp3");const t=play("mgames",{volume:.4,loop:!0});loadSprite("cookie","sprites/cookie.png"),loadSprite("wall","sprites/szlaban.png"),scene("mgame4",()=>{let l=0,a=!1;setGravity(3200),add([rect(width(),height()),color(10,10,20),fixed()]),loop(.5,()=>{a||add([rect(8,height()),pos(width(),0),color(0,50,0),opacity(.3),move(LEFT,400*.5),offscreen({destroy:!0})])}),add([text("OBRO PLIK COOKIE",{size:40,font:"monospace"}),pos(center().x,50),anchor("center"),color(0,255,255),z(10)]);const d=add([text("ZABEZPIECZENIA: 0/10",{size:32,font:"monospace"}),pos(30,30),color(0,255,100),z(10)]);add([text("SPACJA / KLIK = SKOK",{size:42,font:"monospace"}),pos(center().x,height()-40),anchor("center"),color(150,150,150),z(10)]);const m=add([sprite("cookie"),scale(5),pos(200,center().y),anchor("center"),area({scale:.7}),body(),"player"]);function c(){if(a)return;const g=height()-400,x=rand(80,g-80),S=height()-x-400,C=20;add([sprite("wall",{tiled:!0,width:80,height:x+C}),pos(width(),-C),area(),move(LEFT,400),offscreen({destroy:!0}),"pipe"]),add([sprite("wall",{tiled:!0,width:80,height:S+C}),pos(width(),x+400),area(),move(LEFT,400),offscreen({destroy:!0}),"pipe",{passed:!1}])}loop(1.5,c);function f(){a||m.jump(800)}onKeyPress("space",f),onMousePress(f),m.onCollide("pipe",()=>{p()}),m.onUpdate(()=>{(m.pos.y>height()||m.pos.y<-50)&&p()}),onUpdate("pipe",g=>{g.pos.x+80<m.pos.x&&g.passed===!1&&(g.passed=!0,l++,d.text=`ZABEZPIECZENIA: ${l}/10`,add([text("+1",{size:40}),pos(m.pos),color(0,255,0),move(vec2(0,-1),150),opacity(.8),lifespan(.5),z(100)]),l>=10&&y())});function p(){a||(a=!0,shake(20),add([text("KOLIZJA! RESET SYSTEMU...",{size:48}),pos(center()),anchor("center"),color(255,0,0),z(100)]),wait(1,()=>{t.stop(),go("mgame4")}))}function y(){a||(a=!0,destroyAll("pipe"),setGravity(0),add([rect(700,300,{radius:12}),pos(center()),anchor("center"),color(0,0,0),outline(6,rgb(0,255,0)),z(100)]),add([text("OBRONIE CIASTECZKO",{size:48}),pos(center().x,center().y-60),anchor("center"),color(0,255,0),z(101)]),add([text("OSTATNIA CZ PINU:",{size:32}),pos(center().x,center().y+20),anchor("center"),color(255,255,255),z(101)]),add([text("..63",{size:64}),pos(center().x,center().y+80),anchor("center"),color(255,255,0),z(101)]),add([text("(ENTER) WYJCIE",{size:24}),pos(center().x,center().y+140),anchor("center"),color(150,150,150),z(101)]))}onKeyPress("enter",()=>{a&&(t.stop(),go("lvl4"))})})}function mc(){setGravity(0);const t=800,e=300;scene("lvl2",()=>{loadSound("game","sprites/gameplaymus.mp3");const r=play("game",{volume:.4,loop:!0});loadSprite("bg","sprites/levels/lvl2.png"),loadSprite("button","sprites/button_anim.png",{sliceX:12,sliceY:1,anims:{open:{from:0,to:11,loop:!1},show:{from:11,to:11,loop:!1},close:{from:11,to:0,loop:!1}}}),loadSprite("elevator","sprites/winda.png",{sliceX:5,sliceY:1,anims:{closed:{from:0,to:0,loop:!1},open:{from:4,to:4,loop:!1,speed:9},oppening:{from:0,to:4,loop:!1},closing:{from:4,to:0,loop:!1,speed:9}}});let s=add([sprite("button"),pos(1800,650),scale(6),area(),"button"]),n=add([sprite("button"),pos(4790,650),scale(4),area(),"exit"]);n.play("show"),add([sprite("elevator"),pos(590,600),scale(8),area()]).play("open"),loadSprite("player","sprites/player.png",{sliceX:5,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:4,loop:!0,speed:10}}}),add([rect(600,20),pos(1650,805),opacity(0),area(),"buttoncollider"]),add([rect(600,20),pos(4550,805),opacity(0),area(),"exitcollider"]),add([rect(1e4,1e4),pos(0,-700),color(0,0,0),z(-200)]),add([sprite("bg"),pos(208,-680),scale(8),z(-100)]),add([rect(20,height()),pos(350,0),area(),body({isStatic:!0}),opacity(0)]),add([rect(20,height()),pos(5300,0),area(),body({isStatic:!0}),opacity(0)]);const o=add([sprite("player"),pos(700,995),scale(12),area(),body(),anchor("bot"),"player"]);o.flipX=!0,onCollide("player","buttoncollider",()=>{s.play("open"),onKeyPress("enter",()=>{const u=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,l=>u.opacity=l,easings.linear).onEnd(()=>{r.stop(),go("mgame1")}),onClick("button",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame1")})})}),onCollideEnd("player","buttoncollider",()=>{s.play("close")}),onCollide("player","exitcollider",()=>{n.play("open"),onClick("exit",()=>{const u=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,l=>u.opacity=l,easings.linear).onEnd(()=>{r.stop(),go("elev1")})}),onKeyPress("enter",()=>{const u=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,l=>u.opacity=l,easings.linear).onEnd(()=>{r.stop(),go("elev1")})})}),onCollideEnd("player","exitcollider",()=>{n.play("close")})}),o.play("idle"),camPos(o.pos.x,center().y),o.onUpdate(()=>{const u=camPos();o.pos.x>u.x+e&&camPos(o.pos.x-e,u.y),o.pos.x<u.x-e&&camPos(o.pos.x+e,u.y),camPos().x<center().x&&camPos(center().x,camPos().y)}),o.onUpdate(()=>{isKeyDown("left")?(o.vel.x=-t,o.flipX=!1,o.curAnim()!=="walk"&&o.play("walk")):isKeyDown("right")?(o.vel.x=t,o.flipX=!0,o.curAnim()!=="walk"&&o.play("walk")):(o.vel.x=0,o.curAnim()!=="idle"&&o.play("idle"))})})}function yc(){scene("mgame5",()=>{setGravity(0);const t=3;loadSound("mgames","sprites/mgamesmus.mp3");const e=play("mgames",{volume:.4,loop:!0}),r=[{speed:140,size:60},{speed:200,size:40},{speed:300,size:30}];let s=0,n=!0,i=0,o=!1,u=rand(45,315);add([rect(width(),height()),color(10,10,20),fixed()]),add([text("AMANIE ZABEZPIECZE",{size:32,font:"monospace"}),pos(center().x,50),anchor("center"),color(0,255,255)]);const l=add([text("NACINIJ (SPACJA) W ZIELONEJ STREFIE",{size:20,font:"monospace"}),pos(center().x,height()-50),anchor("center"),color(150,150,150)]),a=add([text(`POZIOM ZABEZPIECZE: 1/${t}`,{size:24,font:"monospace"}),pos(center().x,100),anchor("center"),color(0,255,100)]),d=150,m=add([pos(center()),rotate(0),anchor("center"),"lock"]);m.add([circle(d),color(20,20,30),outline(4,rgb(100,100,100)),anchor("center")]);const c=m.add([pos(0,0),rotate(u),anchor("center"),{draw(){if(s>=r.length)return;const C=r[s].size,D=[vec2(0,0)],b=20,A=-C/2,v=C/2;for(let q=0;q<=b;q++){const T=A+(v-A)*(q/b),R=deg2rad(T);D.push(vec2(Math.cos(R)*d,Math.sin(R)*d))}drawPolygon({pts:D,color:rgb(0,200,0),opacity:.6})}}]);m.add([circle(20),color(50,50,50),outline(2,rgb(200,200,200)),anchor("center")]),add([polygon([vec2(-15,-20),vec2(15,-20),vec2(0,10)]),pos(center().x,center().y-d-20),color(255,255,0),outline(2,rgb(0,0,0)),anchor("center"),z(10)]),onUpdate(()=>{if(n&&!o){if(s>=r.length)return;const S=r[s].speed;i+=S*dt(),i>=360&&(i-=360),m.angle=i}}),onKeyPress("space",()=>{!n||o||f()}),onMousePress(()=>{!n||o||f()});function f(){const S=(i+u)%360;let D=Math.abs(S-270);if(D>180&&(D=360-D),s>=r.length)return;const b=r[s].size/2;D<=b?p():y()}function p(){n=!1,shake(5),add([circle(d),pos(center()),anchor("center"),color(0,255,0),opacity(.3),lifespan(.3)]),s++,s>=t?wait(.5,()=>{destroy(m),x()}):(l.text="DOBRZE! PRZYGOTUJ SI...",l.color=rgb(0,255,0),wait(1,()=>{g()}))}function y(){n=!1,o=!0,shake(20),add([circle(d),pos(center()),anchor("center"),color(255,0,0),opacity(.5),lifespan(.5)]),wait(.5,()=>{add([rect(600,300,{radius:12}),pos(center()),anchor("center"),color(0,0,0),outline(6,rgb(255,0,0)),z(100)]),add([text("BD KRYTYCZNY",{size:40,font:"monospace"}),pos(center().x,center().y-40),anchor("center"),color(255,0,0),z(101)]),add([text("(R) SPRBUJ PONOWNIE",{size:24,font:"monospace"}),pos(center().x,center().y+40),anchor("center"),color(255,255,255),z(101)])})}function g(){n=!0,u=rand(45,315),c.angle=u,i=0,m.angle=0,a.text=`POZIOM ZABEZPIECZE: ${s+1}/${t}`,l.text="TRAF W ZIELONE!",l.color=rgb(150,150,150)}function x(){o=!0,add([rect(600,300,{radius:12}),pos(center()),anchor("center"),color(0,0,0),outline(6,rgb(0,255,0)),z(100)]),add([text("ZABEZPIECZENIA ZAMANE",{size:36,font:"monospace"}),pos(center().x,center().y-50),anchor("center"),color(0,255,0),z(101)]),add([text("PIERWSZA ZE PINU:",{size:24,font:"monospace"}),pos(center().x,center().y+20),anchor("center"),color(255,255,255),z(101)]),add([text("88..",{size:64,font:"monospace"}),pos(center().x,center().y+80),anchor("center"),color(255,255,0),z(101)]),add([text("(ENTER) WYJCIE",{size:20,font:"monospace"}),pos(center().x,center().y+130),anchor("center"),color(100,100,100),z(101)])}onKeyPress("r",()=>{o&&s<t&&(e.stop(),go("mgame5"))}),onKeyPress("enter",()=>{o&&(e.stop(),go("lvl4"))})})}function wc(){scene("elev1",()=>{const t="7359";let r="",s=!1;add([rect(width(),height()),color(10,10,15),opacity(.9),fixed()]),add([rect(400,650,{radius:16}),pos(center()),anchor("center"),color(40,40,50),outline(4,rgb(100,100,120))]);const n=add([rect(320,80,{radius:4}),pos(center().x,center().y-220),anchor("center"),color(10,10,10),outline(2,rgb(0,255,255))]),i=add([text("",{size:48,font:"monospace"}),pos(center().x,center().y-220),anchor("center"),color(0,255,255)]),o=add([text("WPROWAD KOD DOSTPU",{size:20,font:"monospace"}),pos(center().x,center().y-150),anchor("center"),color(150,150,150)]),u=["1","2","3","4","5","6","7","8","9","<-","0","OK"],l=center().x-100,a=center().y-50,d=80,m=20;u.forEach((y,g)=>{const x=Math.floor(g/3),S=g%3,C=l+S*(d+m),D=a+x*(d+m);let b=rgb(60,60,70);y==="<-"&&(b=rgb(100,40,40)),y==="OK"&&(b=rgb(40,100,40));const A=add([rect(d,d,{radius:8}),pos(C,D),anchor("center"),color(b),outline(2,rgb(30,30,30)),area(),scale(1),"key_btn",{value:y,baseColor:b}]);add([text(y,{size:32,font:"monospace"}),pos(C,D),anchor("center"),color(255,255,255)]),A.onHover(()=>{s||(A.color=A.baseColor.lighten(50),A.scale=vec2(1.1),document.body.style.cursor="pointer")}),A.onHoverEnd(()=>{A.color=A.baseColor,A.scale=vec2(1),document.body.style.cursor="default"}),A.onClick(()=>{s||(c(y),A.scale=vec2(.95),wait(.1,()=>A.scale=vec2(1.1)))})});function c(y){if(y==="X")r=r.slice(0,-1);else if(y==="OK"){p();return}else r.length<4&&(r+=y);f()}function f(){i.text=r+"_",i.color=rgb(0,255,255),n.outline.color=rgb(0,255,255)}function p(){if(s=!0,r===t){o.text="DOSTP PRZYZNANY",o.color=rgb(0,255,0),i.text="OPEN",i.color=rgb(0,255,0),n.outline.color=rgb(0,255,0);const y=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,g=>y.opacity=g,easings.linear).onEnd(()=>{go("lvl3")})}else o.text="OFFLINE",o.color=rgb(255,0,0),i.color=rgb(255,0,0),n.outline.color=rgb(255,0,0),shake(10),wait(1,()=>{r="",o.text="WPROWAD KOD DOSTPU",o.color=rgb(150,150,150),f(),s=!1})}onCharInput(y=>{s||y>="0"&&y<="9"&&c(y)}),onKeyPress("backspace",()=>{s||c("X")}),onKeyPress("enter",()=>{s||c("OK")}),onKeyPress("escape",()=>{go("lvl2")})})}function Ac(){setGravity(0);const t=800,e=300;scene("lvl3",()=>{loadSound("game","sprites/gameplaymus.mp3");const r=play("game",{volume:.4,loop:!0});loadSprite("bg","sprites/levels/lvl3.png"),loadSprite("button","sprites/button_anim.png",{sliceX:12,sliceY:1,anims:{open:{from:0,to:11,loop:!1},show:{from:11,to:11,loop:!1},close:{from:11,to:0,loop:!1}}}),loadSprite("elevator","sprites/winda.png",{sliceX:5,sliceY:1,anims:{closed:{from:0,to:0,loop:!1},open:{from:4,to:4,loop:!1,speed:9},oppening:{from:0,to:4,loop:!1},closing:{from:4,to:0,loop:!1,speed:9}}});let s=add([sprite("button"),pos(1500,650),scale(6),area(),"button1"]),n=add([sprite("button"),pos(3600,650),scale(6),area(),"button2"]),i=add([sprite("button"),pos(4790,650),scale(4),area(),"exit"]);i.play("show"),add([sprite("elevator"),pos(590,600),scale(8),area()]).play("open"),loadSprite("player","sprites/player.png",{sliceX:5,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:4,loop:!0,speed:10}}}),add([rect(600,20),pos(1350,805),opacity(0),area(),"button1collider"]),add([rect(600,20),pos(3450,805),opacity(0),area(),"button2collider"]),add([rect(600,20),pos(4550,805),opacity(0),area(),"exitcollider"]),add([rect(1e4,1e4),pos(0,-700),color(0,0,0),z(-200)]),add([sprite("bg"),pos(208,-680),scale(8),z(-100)]),add([rect(20,height()),pos(350,0),area(),body({isStatic:!0}),opacity(0)]),add([rect(20,height()),pos(5350,0),area(),body({isStatic:!0}),opacity(0)]);const u=add([sprite("player"),pos(700,995),scale(12),area(),body(),anchor("bot"),"player"]);u.flipX=!0,onCollide("player","button1collider",()=>{s.play("open"),onClick("button1",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame2")})}),onKeyPress("enter",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame2")})})}),onCollideEnd("player","button1collider",()=>{s.play("close")}),onCollide("player","button2collider",()=>{n.play("open"),onClick("button2",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame3")})}),onKeyPress("enter",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame3")})})}),onCollideEnd("player","button2collider",()=>{n.play("close")}),onCollide("player","exitcollider",()=>{i.play("open"),onClick("exit",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("elev2")})}),onKeyPress("enter",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("elev2")})})}),onCollideEnd("player","exitcollider",()=>{i.play("close")}),u.play("idle"),camPos(u.pos.x,center().y),u.onUpdate(()=>{const l=camPos();u.pos.x>l.x+e&&camPos(u.pos.x-e,l.y),u.pos.x<l.x-e&&camPos(u.pos.x+e,l.y),camPos().x<center().x&&camPos(center().x,camPos().y)}),u.onUpdate(()=>{isKeyDown("left")?(u.vel.x=-t,u.flipX=!1,u.curAnim()!=="walk"&&u.play("walk")):isKeyDown("right")?(u.vel.x=t,u.flipX=!0,u.curAnim()!=="walk"&&u.play("walk")):(u.vel.x=0,u.curAnim()!=="idle"&&u.play("idle"))})})}function xc(){loadSprite("logo","sprites/logo.png"),scene("menu",()=>{loadSound("game","sprites/gameplaymus.mp3");const t=play("game",{volume:.4,loop:!0});add([rect(width(),height()),color(10,10,20),fixed()]),loop(.1,()=>{add([rect(width(),2),pos(0,rand(0,height())),color(0,255,255),opacity(.1),move(DOWN,50),lifespan(2)])}),add([sprite("logo"),pos(center().x,center().y-100),anchor("center"),scale(4)]);const e=add([text("NACISNIJ BY ZACZ.",{size:32,font:"monospace"}),pos(center().x,center().y+50),anchor("center"),color(0,255,100)]);loop(.8,()=>{e.hidden=!e.hidden}),add([rect(width(),50),pos(0,height()-50),color(0,0,0),opacity(.8)]),add([text(" UWAGA: ABY GRA DZIAAA POPRAWNIE, USTAW PRZYBLIENIE STRONY NA 50% ",{size:30,font:"monospace"}),pos(center().x,height()-330),anchor("center"),color(255,50,50)]);function r(){const s=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,n=>s.opacity=n,easings.linear).onEnd(()=>{t.stop(),go("lvl1")})}onKeyPress(r),onMousePress(r),onTouchStart(r)})}function vc(){scene("elev2",()=>{const t="9042";let r="",s=!1;add([rect(width(),height()),color(10,10,15),opacity(.9),fixed()]),add([rect(400,650,{radius:16}),pos(center()),anchor("center"),color(40,40,50),outline(4,rgb(100,100,120))]);const n=add([rect(320,80,{radius:4}),pos(center().x,center().y-220),anchor("center"),color(10,10,10),outline(2,rgb(0,255,255))]),i=add([text("",{size:48,font:"monospace"}),pos(center().x,center().y-220),anchor("center"),color(0,255,255)]),o=add([text("WPROWAD KOD DOSTPU",{size:20,font:"monospace"}),pos(center().x,center().y-150),anchor("center"),color(150,150,150)]),u=["1","2","3","4","5","6","7","8","9","<-","0","OK"],l=center().x-100,a=center().y-50,d=80,m=20;u.forEach((y,g)=>{const x=Math.floor(g/3),S=g%3,C=l+S*(d+m),D=a+x*(d+m);let b=rgb(60,60,70);y==="<-"&&(b=rgb(100,40,40)),y==="OK"&&(b=rgb(40,100,40));const A=add([rect(d,d,{radius:8}),pos(C,D),anchor("center"),color(b),outline(2,rgb(30,30,30)),area(),scale(1),"key_btn",{value:y,baseColor:b}]);add([text(y,{size:32,font:"monospace"}),pos(C,D),anchor("center"),color(255,255,255)]),A.onHover(()=>{s||(A.color=A.baseColor.lighten(50),A.scale=vec2(1.1),document.body.style.cursor="pointer")}),A.onHoverEnd(()=>{A.color=A.baseColor,A.scale=vec2(1),document.body.style.cursor="default"}),A.onClick(()=>{s||(c(y),A.scale=vec2(.95),wait(.1,()=>A.scale=vec2(1.1)))})});function c(y){if(y==="X")r=r.slice(0,-1);else if(y==="OK"){p();return}else r.length<4&&(r+=y);f()}function f(){i.text=r+"_",i.color=rgb(0,255,255),n.outline.color=rgb(0,255,255)}function p(){if(s=!0,r===t){o.text="DOSTP PRZYZNANY",o.color=rgb(0,255,0),i.text="OPEN",i.color=rgb(0,255,0),n.outline.color=rgb(0,255,0);const y=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,g=>y.opacity=g,easings.linear).onEnd(()=>{go("lvl4")})}else o.text="OFFLINE",o.color=rgb(255,0,0),i.color=rgb(255,0,0),n.outline.color=rgb(255,0,0),shake(10),wait(1,()=>{r="",o.text="WPROWAD KOD DOSTPU",o.color=rgb(150,150,150),f(),s=!1})}onCharInput(y=>{s||y>="0"&&y<="9"&&c(y)}),onKeyPress("backspace",()=>{s||c("X")}),onKeyPress("enter",()=>{s||c("OK")}),onKeyPress("escape",()=>{go("lvl3")})})}function bc(){scene("elev3",()=>{const t="8863";let r="",s=!1;add([rect(width(),height()),color(10,10,15),opacity(.9),fixed()]),add([rect(400,650,{radius:16}),pos(center()),anchor("center"),color(40,40,50),outline(4,rgb(100,100,120))]);const n=add([rect(320,80,{radius:4}),pos(center().x,center().y-220),anchor("center"),color(10,10,10),outline(2,rgb(0,255,255))]),i=add([text("",{size:48,font:"monospace"}),pos(center().x,center().y-220),anchor("center"),color(0,255,255)]),o=add([text("WPROWAD KOD DOSTPU",{size:20,font:"monospace"}),pos(center().x,center().y-150),anchor("center"),color(150,150,150)]),u=["1","2","3","4","5","6","7","8","9","<-","0","OK"],l=center().x-100,a=center().y-50,d=80,m=20;u.forEach((y,g)=>{const x=Math.floor(g/3),S=g%3,C=l+S*(d+m),D=a+x*(d+m);let b=rgb(60,60,70);y==="<-"&&(b=rgb(100,40,40)),y==="OK"&&(b=rgb(40,100,40));const A=add([rect(d,d,{radius:8}),pos(C,D),anchor("center"),color(b),outline(2,rgb(30,30,30)),area(),scale(1),"key_btn",{value:y,baseColor:b}]);add([text(y,{size:32,font:"monospace"}),pos(C,D),anchor("center"),color(255,255,255)]),A.onHover(()=>{s||(A.color=A.baseColor.lighten(50),A.scale=vec2(1.1),document.body.style.cursor="pointer")}),A.onHoverEnd(()=>{A.color=A.baseColor,A.scale=vec2(1),document.body.style.cursor="default"}),A.onClick(()=>{s||(c(y),A.scale=vec2(.95),wait(.1,()=>A.scale=vec2(1.1)))})});function c(y){if(y==="X")r=r.slice(0,-1);else if(y==="OK"){p();return}else r.length<4&&(r+=y);f()}function f(){i.text=r+"_",i.color=rgb(0,255,255),n.outline.color=rgb(0,255,255)}function p(){if(s=!0,r===t){o.text="DOSTP PRZYZNANY",o.color=rgb(0,255,0),i.text="OPEN",i.color=rgb(0,255,0),n.outline.color=rgb(0,255,0);const y=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,g=>y.opacity=g,easings.linear).onEnd(()=>{go("end_menu")})}else o.text="OFFICE",o.color=rgb(255,0,0),i.color=rgb(255,0,0),n.outline.color=rgb(255,0,0),shake(10),wait(1,()=>{r="",o.text="WPROWAD KOD DOSTPU",o.color=rgb(150,150,150),f(),s=!1})}onCharInput(y=>{s||y>="0"&&y<="9"&&c(y)}),onKeyPress("backspace",()=>{s||c("X")}),onKeyPress("enter",()=>{s||c("OK")}),onKeyPress("escape",()=>{go("lvl4")})})}function Ec(){scene("end_menu",()=>{add([rect(width(),height()),color(5,5,10),fixed()]),loop(.2,()=>{add([rect(4,4),pos(rand(0,width()),0),color(0,255,0),move(DOWN,rand(50,200)),opacity(.5),lifespan(3)])}),add([text("MISJA ZAKOCZONA",{size:48,font:"monospace",letterSpacing:4}),pos(center().x,height()/2-180),anchor("center"),color(0,255,100)]),add([text("SYSTEM PRZEJTY POMYLNIE",{size:20,font:"monospace"}),pos(center().x,height()/2-130),anchor("center"),color(0,150,50)]),add([text("STWORZONE PRZEZ:",{size:16,font:"monospace"}),pos(center().x,height()/2-50),anchor("center"),color(100,100,100)]);const t=["Filip Paderecki","Olaf yowski","Gabriel Bujakowski","Jamina Koniska"];let e=height()/2;for(const s of t)add([text(s,{size:24,font:"monospace"}),pos(center().x,e),anchor("center"),color(255,255,255)]),e+=35;const r=add([text("[ SPACJA ] ZAGRAJ PONOWNIE",{size:20,font:"monospace"}),pos(center().x,height()-50),anchor("center"),color(0,255,255)]);loop(.8,()=>{r.hidden=!r.hidden}),onKeyPress("space",()=>{go("menu")}),onKeyPress("enter",()=>{go("menu")}),onClick(()=>{go("menu")})})}function Sc(){setGravity(0);const t=800,e=300;scene("lvl4",()=>{loadSound("game","sprites/gameplaymus.mp3");const r=play("game",{volume:.4,loop:!0});loadSprite("bg","sprites/levels/lvl4.png"),loadSprite("button","sprites/button_anim.png",{sliceX:12,sliceY:1,anims:{open:{from:0,to:11,loop:!1},show:{from:11,to:11,loop:!1},close:{from:11,to:0,loop:!1}}}),loadSprite("elevator","sprites/winda.png",{sliceX:5,sliceY:1,anims:{closed:{from:0,to:0,loop:!1},open:{from:4,to:4,loop:!1,speed:9},oppening:{from:0,to:4,loop:!1},closing:{from:4,to:0,loop:!1,speed:9}}});let s=add([sprite("button"),pos(2700,650),scale(6),area(),"button1"]),n=add([sprite("button"),pos(3850,650),scale(6),area(),"button2"]),i=add([sprite("button"),pos(4790,650),scale(4),area(),"exit"]);i.play("show"),add([sprite("elevator"),pos(590,600),scale(8),area()]).play("open"),loadSprite("player","sprites/player.png",{sliceX:5,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:4,loop:!0,speed:10}}}),add([rect(500,20),pos(2550,805),opacity(0),area(),"button1collider"]),add([rect(500,20),pos(3750,805),opacity(0),area(),"button2collider"]),add([rect(600,20),pos(4550,805),opacity(0),area(),"exitcollider"]),add([rect(1e4,1e4),pos(0,-700),color(0,0,0),z(-200)]),add([sprite("bg"),pos(208,-800),scale(8),z(-100)]),add([rect(20,height()),pos(350,0),area(),body({isStatic:!0}),opacity(0)]),add([rect(20,height()),pos(5350,0),area(),body({isStatic:!0}),opacity(0)]);const u=add([sprite("player"),pos(700,995),scale(12),area(),body(),anchor("bot"),"player"]);u.flipX=!0,onCollide("player","button1collider",()=>{s.play("open"),onClick("button1",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame4")})}),onKeyPress("enter",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame4")})})}),onCollideEnd("player","button1collider",()=>{s.play("close")}),onCollide("player","button2collider",()=>{n.play("open"),onClick("button2",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame5")})}),onKeyPress("enter",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("mgame5")})})}),onCollideEnd("player","button2collider",()=>{n.play("close")}),onCollide("player","exitcollider",()=>{i.play("open"),onClick("exit",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("elev3")})}),onKeyPress("enter",()=>{const l=add([rect(width(),height()),color(0,0,0),pos(0,0),fixed(),opacity(0),z(9999)]);tween(0,1,1,a=>l.opacity=a,easings.linear).onEnd(()=>{r.stop(),go("elev3")})})}),onCollideEnd("player","exitcollider",()=>{i.play("close")}),u.play("idle"),camPos(u.pos.x,center().y),u.onUpdate(()=>{const l=camPos();u.pos.x>l.x+e&&camPos(u.pos.x-e,l.y),u.pos.x<l.x-e&&camPos(u.pos.x+e,l.y),camPos().x<center().x&&camPos(center().x,camPos().y)}),u.onUpdate(()=>{isKeyDown("left")?(u.vel.x=-t,u.flipX=!1,u.curAnim()!=="walk"&&u.play("walk")):isKeyDown("right")?(u.vel.x=t,u.flipX=!0,u.curAnim()!=="walk"&&u.play("walk")):(u.vel.x=0,u.curAnim()!=="idle"&&u.play("idle"))})})}cc({width:1920,height:1080,font:"sans-serif",canvas:document.querySelector("#mycanvas"),background:[255,255,255],global:!0,buttons:{left:{keyboard:["a","left"]},right:{keyboard:["d","right"]},space:{keyboard:["space"]}}});loadBean();hc();dc();pc();fc();gc();yc();mc();wc();Ac();xc();vc();Ec();Sc();bc();go("menu");
